For some LLaMA-based models, initializing the fast tokenizer may take a long time. To eliminate the initialization time, consider using 'hf-internal-testing/llama-tokenizer' instead of the original tokenizer.
llama-7b: 12.06 GB
peak working mem for (bs=20, seqlen=512): 0.70 GB
peak working mem for (bs=100, seqlen=512): 3.52 GB
all adapters (11) estimated size: 0.17 GB
avg adapter estimated size: 16.00 MB
INFO:     127.0.0.1:40976 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40990 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40994 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38962 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38974 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38984 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51318 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51328 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51338 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51348 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51360 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51364 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:36412 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:36428 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:36440 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:36444 - "POST /generate_stream HTTP/1.1" 200 OK
cost load scan: 0.012159347534179688
load 1 adapters, 1 in total
Function load_lora_A took 1.2714862823486328 ms to run.
Function load_lora_B took 1.1947154998779297 ms to run.
cost realload: 6.136178970336914
Function load_adapters took 6.162405014038086 ms to run.
Avg tokens(prompt+generate) throughput:   10.281 tokens/s
Avg prompt tokens throughput:             10.281 tokens/s
Avg generate tokens throughput:            0.000 tokens/s
cost load scan: 0.009059906005859375
load 1 adapters, 2 in total
Function load_lora_A took 1.2254714965820312 ms to run.
Function load_lora_B took 1.2454986572265625 ms to run.
cost realload: 2.9761791229248047
Function load_adapters took 2.9997825622558594 ms to run.
current batch size: 2 token used ratio: 0.005383333333333334
cost load scan: 0.008821487426757812
load 1 adapters, 3 in total
Function load_lora_A took 1.1832714080810547 ms to run.
Function load_lora_B took 1.2085437774658203 ms to run.
cost realload: 2.8226375579833984
Function load_adapters took 2.847433090209961 ms to run.
current batch size: 3 token used ratio: 0.008533333333333334
current batch size: 3 token used ratio: 0.009783333333333333
cost load scan: 0.009298324584960938
load 1 adapters, 4 in total
Function load_lora_A took 1.1739730834960938 ms to run.
Function load_lora_B took 1.220703125 ms to run.
cost realload: 2.8076171875
Function load_adapters took 2.830028533935547 ms to run.
current batch size: 4 token used ratio: 0.012966666666666666
cost load scan: 0.009059906005859375
load 1 adapters, 5 in total
Function load_lora_A took 1.1518001556396484 ms to run.
Function load_lora_B took 1.2319087982177734 ms to run.
cost realload: 2.8045177459716797
Function load_adapters took 2.830028533935547 ms to run.
cost offload scan: 0.1933574676513672
offload 1 adapters, 4 remains
cost offload cat: 0.03528594970703125
cost offload free mem manager: 0.051021575927734375
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 21.64292335510254
Function offload_adapters took 22.28856086730957 ms to run.
current batch size: 4 token used ratio: 0.012275
cost offload scan: 0.08440017700195312
offload 1 adapters, 3 remains
cost offload cat: 0.0324249267578125
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.023603439331054688
cost offload a_loc update: 0.10538101196289062
Function offload_adapters took 0.5788803100585938 ms to run.
current batch size: 3 token used ratio: 0.009225
cost offload scan: 0.08749961853027344
offload 1 adapters, 2 remains
cost offload cat: 0.03147125244140625
cost offload free mem manager: 0.0438690185546875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10442733764648438
Function offload_adapters took 0.5772113800048828 ms to run.
current batch size: 2 token used ratio: 0.006075
current batch size: 2 token used ratio: 0.006908333333333333
cost offload scan: 0.08106231689453125
offload 1 adapters, 1 remains
cost offload cat: 0.03552436828613281
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.11372566223144531
Function offload_adapters took 0.579833984375 ms to run.
current batch size: 1 token used ratio: 0.0037083333333333334
offload 1 adapters, 0 remains
Function offload_adapters took 0.09298324584960938 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.011682510375976562 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 1 in total
Function load_lora_A took 1.2087821960449219 ms to run.
Function load_lora_B took 1.2326240539550781 ms to run.
cost realload: 2.9518604278564453
Function load_adapters took 2.9785633087158203 ms to run.
Avg tokens(prompt+generate) throughput:  204.168 tokens/s
Avg prompt tokens throughput:            105.593 tokens/s
Avg generate tokens throughput:           98.575 tokens/s
current batch size: 1 token used ratio: 0.00255
current batch size: 1 token used ratio: 0.0029666666666666665
current batch size: 1 token used ratio: 0.0033833333333333332
current batch size: 1 token used ratio: 0.0038
offload 1 adapters, 0 remains
Function offload_adapters took 0.10704994201660156 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost load scan: 0.009775161743164062
load 1 adapters, 1 in total
Function load_lora_A took 1.264810562133789 ms to run.
Function load_lora_B took 1.2514591217041016 ms to run.
cost realload: 3.016948699951172
Function load_adapters took 3.042459487915039 ms to run.
current batch size: 1 token used ratio: 0.002266666666666667
cost load scan: 0.010013580322265625
load 1 adapters, 2 in total
Function load_lora_A took 1.1887550354003906 ms to run.
Function load_lora_B took 1.216888427734375 ms to run.
cost realload: 2.8090476989746094
Function load_adapters took 2.8328895568847656 ms to run.
current batch size: 2 token used ratio: 0.004958333333333334
cost load scan: 0.010967254638671875
load 1 adapters, 3 in total
Function load_lora_A took 1.194000244140625 ms to run.
Function load_lora_B took 1.2290477752685547 ms to run.
cost realload: 2.8543472290039062
Function load_adapters took 2.8765201568603516 ms to run.
current batch size: 3 token used ratio: 0.007825
cost load scan: 0.00858306884765625
load 1 adapters, 4 in total
Function load_lora_A took 1.2061595916748047 ms to run.
Function load_lora_B took 1.2140274047851562 ms to run.
cost realload: 2.83050537109375
Function load_adapters took 2.8557777404785156 ms to run.
current batch size: 4 token used ratio: 0.011116666666666667
cost load scan: 0.007867813110351562
load 0 adapters, 4 in total
cost realload: 0.2999305725097656
Function load_adapters took 0.3249645233154297 ms to run.
Avg tokens(prompt+generate) throughput:  179.547 tokens/s
Avg prompt tokens throughput:            119.332 tokens/s
Avg generate tokens throughput:           60.215 tokens/s
cost load scan: 0.008344650268554688
load 1 adapters, 5 in total
Function load_lora_A took 1.1818408966064453 ms to run.
Function load_lora_B took 1.1944770812988281 ms to run.
cost realload: 2.7735233306884766
Function load_adapters took 2.794981002807617 ms to run.
current batch size: 6 token used ratio: 0.017716666666666665
offload 0 adapters, 5 remains
Function offload_adapters took 0.013828277587890625 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 5 in total
cost realload: 0.2899169921875
Function load_adapters took 0.31566619873046875 ms to run.
current batch size: 6 token used ratio: 0.01835
offload 0 adapters, 5 remains
Function offload_adapters took 0.0133514404296875 ms to run.
current batch size: 5 token used ratio: 0.016525
cost load scan: 0.011682510375976562
load 1 adapters, 6 in total
Function load_lora_A took 1.2269020080566406 ms to run.
Function load_lora_B took 1.1820793151855469 ms to run.
cost realload: 2.840280532836914
Function load_adapters took 2.866029739379883 ms to run.
cost offload scan: 0.31065940856933594
offload 1 adapters, 5 remains
cost offload cat: 0.03337860107421875
cost offload free mem manager: 0.04744529724121094
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.11396408081054688
Function offload_adapters took 0.8254051208496094 ms to run.
cost load scan: 0.010013580322265625
load 1 adapters, 6 in total
Function load_lora_A took 1.2204647064208984 ms to run.
Function load_lora_B took 1.2211799621582031 ms to run.
cost realload: 2.8421878814697266
Function load_adapters took 2.8641223907470703 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 6 in total
cost realload: 0.29206275939941406
Function load_adapters took 0.31685829162597656 ms to run.
current batch size: 7 token used ratio: 0.021491666666666666
cost offload scan: 0.08678436279296875
offload 1 adapters, 5 remains
cost offload cat: 0.03528594970703125
cost offload free mem manager: 0.04410743713378906
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10824203491210938
Function offload_adapters took 0.5941390991210938 ms to run.
cost offload scan: 0.08296966552734375
offload 1 adapters, 4 remains
cost offload cat: 0.030279159545898438
INFO:     127.0.0.1:36458 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:36464 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:36472 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35166 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35178 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35194 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35038 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35044 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35054 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35070 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35078 - "POST /generate_stream HTTP/1.1" 200 OK
cost offload free mem manager: 0.04410743713378906
cost offload torch.empty: 0.024080276489257812
cost offload a_loc update: 0.1049041748046875
Function offload_adapters took 0.6213188171386719 ms to run.
cost offload scan: 0.08916854858398438
offload 1 adapters, 3 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10347366333007812
Function offload_adapters took 0.5695819854736328 ms to run.
current batch size: 4 token used ratio: 0.012041666666666668
current batch size: 4 token used ratio: 0.013708333333333333
cost offload scan: 0.08893013000488281
offload 1 adapters, 2 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.11157989501953125
Function offload_adapters took 0.5865097045898438 ms to run.
current batch size: 3 token used ratio: 0.010833333333333334
cost offload scan: 0.08106231689453125
offload 1 adapters, 1 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10585784912109375
Function offload_adapters took 0.5576610565185547 ms to run.
current batch size: 2 token used ratio: 0.007816666666666666
offload 0 adapters, 1 remains
Function offload_adapters took 0.012874603271484375 ms to run.
offload 1 adapters, 0 remains
Function offload_adapters took 0.09489059448242188 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.011444091796875 ms to run.
cost load scan: 0.007867813110351562
load 1 adapters, 1 in total
Function load_lora_A took 1.2123584747314453 ms to run.
Function load_lora_B took 1.1796951293945312 ms to run.
cost realload: 2.840280532836914
Function load_adapters took 2.8624534606933594 ms to run.
current batch size: 1 token used ratio: 0.001875
cost load scan: 0.010013580322265625
load 1 adapters, 2 in total
Function load_lora_A took 1.2059211730957031 ms to run.
Function load_lora_B took 1.22833251953125 ms to run.
cost realload: 2.8443336486816406
Function load_adapters took 2.866029739379883 ms to run.
cost load scan: 0.010728836059570312
load 1 adapters, 3 in total
Function load_lora_A took 1.1951923370361328 ms to run.
Function load_lora_B took 1.2273788452148438 ms to run.
cost realload: 2.8214454650878906
Function load_adapters took 2.8429031372070312 ms to run.
Avg tokens(prompt+generate) throughput:  401.473 tokens/s
Avg prompt tokens throughput:            202.434 tokens/s
Avg generate tokens throughput:          199.038 tokens/s
current batch size: 3 token used ratio: 0.00705
cost load scan: 0.007867813110351562
load 1 adapters, 4 in total
Function load_lora_A took 1.1708736419677734 ms to run.
Function load_lora_B took 1.2278556823730469 ms to run.
cost realload: 2.7921199798583984
Function load_adapters took 2.814054489135742 ms to run.
current batch size: 4 token used ratio: 0.010616666666666667
current batch size: 4 token used ratio: 0.012283333333333334
current batch size: 4 token used ratio: 0.01395
cost offload scan: 0.08797645568847656
offload 1 adapters, 3 remains
cost offload cat: 0.037670135498046875
cost offload free mem manager: 0.04410743713378906
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.11754035949707031
Function offload_adapters took 0.6091594696044922 ms to run.
cost offload scan: 0.08463859558105469
offload 1 adapters, 2 remains
cost offload cat: 0.03266334533691406
cost offload free mem manager: 0.045299530029296875
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10538101196289062
Function offload_adapters took 0.5767345428466797 ms to run.
current batch size: 2 token used ratio: 0.007916666666666667
cost offload scan: 0.08249282836914062
offload 1 adapters, 1 remains
cost offload cat: 0.03266334533691406
cost offload free mem manager: 0.047206878662109375
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.11706352233886719
Function offload_adapters took 0.5788803100585938 ms to run.
current batch size: 1 token used ratio: 0.004008333333333333
offload 1 adapters, 0 remains
Function offload_adapters took 0.09298324584960938 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.011205673217773438 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 1 in total
Function load_lora_A took 1.2235641479492188 ms to run.
Function load_lora_B took 1.2426376342773438 ms to run.
cost realload: 3.003835678100586
Function load_adapters took 3.0281543731689453 ms to run.
cost load scan: 0.010013580322265625
load 1 adapters, 2 in total
Function load_lora_A took 1.2164115905761719 ms to run.
Function load_lora_B took 1.2183189392089844 ms to run.
cost realload: 2.834320068359375
Function load_adapters took 2.8553009033203125 ms to run.
Avg tokens(prompt+generate) throughput:  161.652 tokens/s
Avg prompt tokens throughput:             75.544 tokens/s
Avg generate tokens throughput:           86.108 tokens/s
current batch size: 2 token used ratio: 0.004575
current batch size: 2 token used ratio: 0.005408333333333334
cost load scan: 0.008106231689453125
load 1 adapters, 3 in total
Function load_lora_A took 1.2404918670654297 ms to run.
Function load_lora_B took 1.2657642364501953 ms to run.
cost realload: 2.938508987426758
Function load_adapters took 2.9611587524414062 ms to run.
current batch size: 3 token used ratio: 0.008025
current batch size: 3 token used ratio: 0.009275
cost offload scan: 0.08893013000488281
offload 1 adapters, 2 remains
cost offload cat: 0.03409385681152344
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10824203491210938
Function offload_adapters took 0.5862712860107422 ms to run.
current batch size: 2 token used ratio: 0.006758333333333333
cost offload scan: 0.08106231689453125
offload 1 adapters, 1 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10466575622558594
Function offload_adapters took 0.5552768707275391 ms to run.
cost load scan: 0.007867813110351562
load 1 adapters, 2 in total
Function load_lora_A took 1.239776611328125 ms to run.
Function load_lora_B took 1.207590103149414 ms to run.
cost realload: 2.851247787475586
Function load_adapters took 2.874135971069336 ms to run.
current batch size: 2 token used ratio: 0.005166666666666667
cost load scan: 0.008344650268554688
load 1 adapters, 3 in total
Function load_lora_A took 1.2128353118896484 ms to run.
Function load_lora_B took 1.2123584747314453 ms to run.
cost realload: 2.817869186401367
Function load_adapters took 2.8388500213623047 ms to run.
cost offload scan: 0.08225440979003906
offload 1 adapters, 2 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10514259338378906
Function offload_adapters took 0.5650520324707031 ms to run.
current batch size: 2 token used ratio: 0.004866666666666667
current batch size: 2 token used ratio: 0.0057
cost load scan: 0.008821487426757812
load 1 adapters, 3 in total
Function load_lora_A took 1.2216567993164062 ms to run.
Function load_lora_B took 1.2242794036865234 ms to run.
cost realload: 2.843618392944336
Function load_adapters took 2.864360809326172 ms to run.
current batch size: 3 token used ratio: 0.008633333333333333
cost load scan: 0.007867813110351562
load 1 adapters, 4 in total
Function load_lora_A took 1.1501312255859375 ms to run.
Function load_lora_B took 1.1653900146484375 ms to run.
cost realload: 2.7163028717041016
Function load_adapters took 2.737760543823242 ms to run.
current batch size: 4 token used ratio: 0.0118
Avg tokens(prompt+generate) throughput:  229.467 tokens/s
Avg prompt tokens throughput:            112.035 tokens/s
Avg generate tokens throughput:          117.432 tokens/s
cost offload scan: 0.08106231689453125
offload 1 adapters, 3 remainsINFO:     127.0.0.1:52804 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52818 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52820 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52822 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52830 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52840 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52846 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52852 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48618 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48626 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48642 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48658 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48674 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48686 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48692 - "POST /generate_stream HTTP/1.1" 200 OK

cost offload cat: 0.034332275390625
cost offload free mem manager: 0.04696846008300781
cost offload torch.empty: 0.023603439331054688
cost offload a_loc update: 0.10943412780761719
Function offload_adapters took 0.61798095703125 ms to run.
current batch size: 3 token used ratio: 0.009283333333333333
cost offload scan: 0.08344650268554688
offload 1 adapters, 2 remains
cost offload cat: 0.03647804260253906
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10991096496582031
Function offload_adapters took 0.5791187286376953 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 3 in total
Function load_lora_A took 1.2402534484863281 ms to run.
Function load_lora_B took 1.201629638671875 ms to run.
cost realload: 2.8443336486816406
Function load_adapters took 2.8662681579589844 ms to run.
current batch size: 3 token used ratio: 0.0084
current batch size: 3 token used ratio: 0.00965
cost load scan: 0.0095367431640625
load 0 adapters, 3 in total
cost realload: 0.3230571746826172
Function load_adapters took 0.35309791564941406 ms to run.
cost offload scan: 0.08416175842285156
offload 1 adapters, 2 remains
cost offload cat: 0.0324249267578125
cost offload free mem manager: 0.04792213439941406
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.11444091796875
Function offload_adapters took 0.5915164947509766 ms to run.
current batch size: 3 token used ratio: 0.008925
cost offload scan: 0.08392333984375
offload 1 adapters, 1 remains
cost offload cat: 0.03528594970703125
cost offload free mem manager: 0.0438690185546875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10848045349121094
Function offload_adapters took 0.5807876586914062 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 2 in total
Function load_lora_A took 1.2238025665283203 ms to run.
Function load_lora_B took 1.2423992156982422 ms to run.
cost realload: 2.878904342651367
Function load_adapters took 2.9015541076660156 ms to run.
cost load scan: 0.01049041748046875
load 1 adapters, 3 in total
Function load_lora_A took 1.1816024780273438 ms to run.
Function load_lora_B took 1.2154579162597656 ms to run.
cost realload: 2.803325653076172
Function load_adapters took 2.8243064880371094 ms to run.
current batch size: 4 token used ratio: 0.0103
offload 0 adapters, 3 remains
Function offload_adapters took 0.017404556274414062 ms to run.
current batch size: 3 token used ratio: 0.008041666666666667
current batch size: 3 token used ratio: 0.009291666666666667
cost offload scan: 0.091552734375
offload 1 adapters, 2 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.04410743713378906
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10466575622558594
Function offload_adapters took 0.5803108215332031 ms to run.
current batch size: 2 token used ratio: 0.006666666666666667
cost load scan: 0.008821487426757812
load 1 adapters, 3 in total
Function load_lora_A took 1.203298568725586 ms to run.
Function load_lora_B took 1.2247562408447266 ms to run.
cost realload: 2.847433090209961
Function load_adapters took 2.86865234375 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 3 in total
cost realload: 0.2872943878173828
Function load_adapters took 0.3132820129394531 ms to run.
current batch size: 4 token used ratio: 0.011816666666666666
offload 0 adapters, 3 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost load scan: 0.012874603271484375
load 1 adapters, 4 in total
Function load_lora_A took 1.2171268463134766 ms to run.
Function load_lora_B took 1.2140274047851562 ms to run.
cost realload: 2.849578857421875
Function load_adapters took 2.871990203857422 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 4 in total
cost realload: 0.29540061950683594
Function load_adapters took 0.3209114074707031 ms to run.
Avg tokens(prompt+generate) throughput:  334.237 tokens/s
Avg prompt tokens throughput:            190.593 tokens/s
Avg generate tokens throughput:          143.644 tokens/s
cost offload scan: 0.3407001495361328
offload 1 adapters, 3 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.0438690185546875
cost offload torch.empty: 0.023603439331054688
cost offload a_loc update: 0.10561943054199219
Function offload_adapters took 0.8296966552734375 ms to run.
current batch size: 4 token used ratio: 0.009491666666666667
current batch size: 4 token used ratio: 0.011158333333333333
cost load scan: 0.009298324584960938
load 1 adapters, 4 in total
Function load_lora_A took 1.191854476928711 ms to run.
Function load_lora_B took 1.2340545654296875 ms to run.
cost realload: 2.834796905517578
Function load_adapters took 2.858400344848633 ms to run.
current batch size: 5 token used ratio: 0.015233333333333333
current batch size: 5 token used ratio: 0.017316666666666668
cost offload scan: 0.08392333984375
offload 1 adapters, 3 remains
cost offload cat: 0.03790855407714844
cost offload free mem manager: 0.0438690185546875
cost offload torch.empty: 0.023603439331054688
cost offload a_loc update: 0.10943412780761719
Function offload_adapters took 0.5984306335449219 ms to run.
cost load scan: 0.011682510375976562
load 1 adapters, 4 in total
Function load_lora_A took 1.2369155883789062 ms to run.
Function load_lora_B took 1.2149810791015625 ms to run.
cost realload: 2.8791427612304688
Function load_adapters took 2.901315689086914 ms to run.
cost offload scan: 0.08249282836914062
offload 1 adapters, 3 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04863739013671875
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10538101196289062
Function offload_adapters took 0.5710124969482422 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 4 in total
Function load_lora_A took 1.2083053588867188 ms to run.
Function load_lora_B took 1.2502670288085938 ms to run.
cost realload: 2.866506576538086
Function load_adapters took 2.887248992919922 ms to run.
offload 0 adapters, 4 remains
Function offload_adapters took 0.01239776611328125 ms to run.
current batch size: 4 token used ratio: 0.011691666666666666
cost offload scan: 0.0820159912109375
offload 1 adapters, 3 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10561943054199219
Function offload_adapters took 0.560760498046875 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 4 in total
Function load_lora_A took 1.2280941009521484 ms to run.
Function load_lora_B took 1.2099742889404297 ms to run.
cost realload: 2.8395652770996094
Function load_adapters took 2.861499786376953 ms to run.
current batch size: 4 token used ratio: 0.011616666666666668
cost load scan: 0.010728836059570312
load 1 adapters, 5 in total
Function load_lora_A took 1.1782646179199219 ms to run.
Function load_lora_B took 1.2104511260986328 ms to run.
cost realload: 2.782106399536133
Function load_adapters took 2.802133560180664 ms to run.
current batch size: 5 token used ratio: 0.015608333333333333
cost offload scan: 0.08273124694824219
offload 1 adapters, 4 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10538101196289062
Function offload_adapters took 0.5717277526855469 ms to run.
current batch size: 4 token used ratio: 0.0132
cost load scan: 0.007867813110351562
load 1 adapters, 5 in total
Function load_lora_A took 1.1818408966064453 ms to run.
Function load_lora_B took 1.2199878692626953 ms to run.
cost realload: 2.8057098388671875
Function load_adapters took 2.828836441040039 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 5 in total
cost realload: 0.2884864807128906
Function load_adapters took 0.3123283386230469 ms to run.
current batch size: 6 token used ratio: 0.019841666666666667
cost offload scan: 0.08726119995117188
offload 1 adapters, 4 remains
cost offload cat: 0.030755996704101562
INFO:     127.0.0.1:55554 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55566 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55578 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55594 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55606 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55616 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38954 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38964 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38966 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:60424 - "POST /generate_stream HTTP/1.1" 200 OK
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.024318695068359375
cost offload a_loc update: 0.11277198791503906
Function offload_adapters took 0.6301403045654297 ms to run.
cost offload scan: 0.08249282836914062
offload 1 adapters, 3 remains
cost offload cat: 0.03218650817871094
cost offload free mem manager: 0.04458427429199219
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.1049041748046875
Function offload_adapters took 0.5757808685302734 ms to run.
current batch size: 4 token used ratio: 0.013666666666666667
Avg tokens(prompt+generate) throughput:  392.076 tokens/s
Avg prompt tokens throughput:            179.489 tokens/s
Avg generate tokens throughput:          212.587 tokens/s
cost offload scan: 0.08130073547363281
offload 1 adapters, 2 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.0438690185546875
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.11014938354492188
Function offload_adapters took 0.5695819854736328 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 3 in total
Function load_lora_A took 1.2078285217285156 ms to run.
Function load_lora_B took 1.2316703796386719 ms to run.
cost realload: 2.835988998413086
Function load_adapters took 2.8574466705322266 ms to run.
offload 0 adapters, 3 remains
Function offload_adapters took 0.01811981201171875 ms to run.
current batch size: 3 token used ratio: 0.0088
cost load scan: 0.0095367431640625
load 1 adapters, 4 in total
Function load_lora_A took 1.1899471282958984 ms to run.
Function load_lora_B took 1.184225082397461 ms to run.
cost realload: 2.7811527252197266
Function load_adapters took 2.804279327392578 ms to run.
current batch size: 4 token used ratio: 0.012416666666666666
cost offload scan: 0.08392333984375
offload 1 adapters, 3 remains
cost offload cat: 0.03790855407714844
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.11968612670898438
Function offload_adapters took 0.5972385406494141 ms to run.
cost offload scan: 0.08249282836914062
offload 1 adapters, 2 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10776519775390625
Function offload_adapters took 0.5674362182617188 ms to run.
current batch size: 2 token used ratio: 0.005741666666666667
current batch size: 2 token used ratio: 0.006575
current batch size: 2 token used ratio: 0.007408333333333334
cost offload scan: 0.08893013000488281
offload 1 adapters, 1 remains
cost offload cat: 0.03552436828613281
cost offload free mem manager: 0.04410743713378906
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10752677917480469
Function offload_adapters took 0.5888938903808594 ms to run.
current batch size: 1 token used ratio: 0.004058333333333333
offload 1 adapters, 0 remains
Function offload_adapters took 0.091552734375 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.013828277587890625 ms to run.
cost load scan: 0.010728836059570312
load 1 adapters, 1 in total
Function load_lora_A took 1.1866092681884766 ms to run.
Function load_lora_B took 1.191854476928711 ms to run.
cost realload: 2.816915512084961
Function load_adapters took 2.840280532836914 ms to run.
cost load scan: 0.009298324584960938
load 1 adapters, 2 in total
Function load_lora_A took 1.2497901916503906 ms to run.
Function load_lora_B took 1.245260238647461 ms to run.
cost realload: 2.8867721557617188
Function load_adapters took 2.9077529907226562 ms to run.
current batch size: 2 token used ratio: 0.004566666666666667
cost load scan: 0.00858306884765625
load 1 adapters, 3 in total
Function load_lora_A took 1.18255615234375 ms to run.
Function load_lora_B took 1.239776611328125 ms to run.
cost realload: 2.8226375579833984
Function load_adapters took 2.843618392944336 ms to run.
cost load scan: 0.011444091796875
load 1 adapters, 4 in total
Function load_lora_A took 1.216888427734375 ms to run.
Function load_lora_B took 1.224517822265625 ms to run.
cost realload: 2.846956253051758
Function load_adapters took 2.8684139251708984 ms to run.
current batch size: 4 token used ratio: 0.008883333333333333
current batch size: 4 token used ratio: 0.01055
Avg tokens(prompt+generate) throughput:  261.720 tokens/s
Avg prompt tokens throughput:            143.292 tokens/s
Avg generate tokens throughput:          118.428 tokens/s
current batch size: 4 token used ratio: 0.012216666666666667
current batch size: 4 token used ratio: 0.013883333333333333
cost offload scan: 0.08845329284667969
offload 1 adapters, 3 remains
cost offload cat: 0.04315376281738281
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10919570922851562
Function offload_adapters took 0.6041526794433594 ms to run.
cost offload scan: 0.08726119995117188
offload 1 adapters, 2 remains
cost offload cat: 0.03147125244140625
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10609626770019531
Function offload_adapters took 0.5724430084228516 ms to run.
cost offload scan: 0.08821487426757812
offload 1 adapters, 1 remains
cost offload cat: 0.03147125244140625
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10395050048828125
Function offload_adapters took 0.5736351013183594 ms to run.
current batch size: 1 token used ratio: 0.003375
offload 1 adapters, 0 remains
Function offload_adapters took 0.09274482727050781 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.010967254638671875 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 1 in total
Function load_lora_A took 1.215219497680664 ms to run.
Function load_lora_B took 1.2116432189941406 ms to run.
cost realload: 2.866506576538086
Function load_adapters took 2.887248992919922 ms to run.
current batch size: 1 token used ratio: 0.002125
current batch size: 1 token used ratio: 0.0025416666666666665
current batch size: 1 token used ratio: 0.002958333333333333
current batch size: 1 token used ratio: 0.003375
offload 1 adapters, 0 remains
Function offload_adapters took 0.08869171142578125 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.010967254638671875 ms to run.
cost load scan: 0.00762939453125
load 1 adapters, 1 in total
Function load_lora_A took 1.2056827545166016 ms to run.
Function load_lora_B took 1.2252330780029297 ms to run.
cost realload: 2.8510093688964844
Function load_adapters took 2.8755664825439453 ms to run.
current batch size: 1 token used ratio: 0.0026583333333333333
cost load scan: 0.008106231689453125
load 1 adapters, 2 in total
Function load_lora_A took 1.2080669403076172 ms to run.
Function load_lora_B took 1.1968612670898438 ms to run.
cost realload: 2.804279327392578
Function load_adapters took 2.827167510986328 ms to run.
current batch size: 2 token used ratio: 0.00525
Avg tokens(prompt+generate) throughput:  163.207 tokens/s
Avg prompt tokens throughput:             71.072 tokens/s
Avg generate tokens throughput:           92.134 tokens/s
current batch size: 2 token used ratio: 0.006083333333333333
cost load scan: 0.008106231689453125
load 1 adapters, 3 in total
Function load_lora_A took 1.2009143829345703 ms to run.
Function load_lora_B took 1.1932849884033203 ms to run.
cost realload: 2.793550491333008
Function load_adapters took 2.8145313262939453 ms to run.
current batch size: 3 token used ratio: 0.009166666666666667
current batch size: 3 token used ratio: 0.010416666666666666
cost offload scan: 0.0820159912109375
offload 1 adapters, 2 remains
cost offload cat: 0.04220008850097656
cost offload free mem manager: 0.04601478576660156
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.1087188720703125
Function offload_adapters took 0.5869865417480469 ms to run.
cost offload scan: 0.0820159912109375
offload 1 adapters, 1 remains
cost offload cat: 0.03147125244140625
INFO:     127.0.0.1:60432 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:60440 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:60446 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:60462 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:60476 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48448 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48450 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48458 - "POST /generate_stream HTTP/1.1" 200 OK
For some LLaMA-based models, initializing the fast tokenizer may take a long time. To eliminate the initialization time, consider using 'hf-internal-testing/llama-tokenizer' instead of the original tokenizer.
llama-7b: 12.06 GB
peak working mem for (bs=20, seqlen=512): 0.70 GB
peak working mem for (bs=100, seqlen=512): 3.52 GB
all adapters (11) estimated size: 0.17 GB
avg adapter estimated size: 16.00 MB
INFO:     127.0.0.1:33396 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33408 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33412 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33420 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33430 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33442 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33456 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54556 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54562 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54568 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54584 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54586 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54588 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54598 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54604 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43734 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43742 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43752 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43768 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43782 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43788 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43790 - "POST /generate_stream HTTP/1.1" 200 OK
cost load scan: 0.010967254638671875
load 2 adapters, 2 in total
Function load_lora_A took 1.399993896484375 ms to run.
Function load_lora_B took 1.2123584747314453 ms to run.
Function load_lora_A took 1.192331314086914 ms to run.
Function load_lora_B took 1.1835098266601562 ms to run.
cost realload: 9.55820083618164
Function load_adapters took 9.586095809936523 ms to run.
Avg tokens(prompt+generate) throughput:   20.149 tokens/s
Avg prompt tokens throughput:             20.149 tokens/s
Avg generate tokens throughput:            0.000 tokens/s
cost load scan: 0.010251998901367188
load 4 adapters, 6 in total
Function load_lora_A took 1.2204647064208984 ms to run.
Function load_lora_B took 1.256704330444336 ms to run.
Function load_lora_A took 1.2061595916748047 ms to run.
Function load_lora_B took 1.1854171752929688 ms to run.
Function load_lora_A took 1.2049674987792969 ms to run.
Function load_lora_B took 1.2400150299072266 ms to run.
Function load_lora_A took 1.2061595916748047 ms to run.
Function load_lora_B took 1.2385845184326172 ms to run.
cost realload: 10.509967803955078
Function load_adapters took 10.535955429077148 ms to run.
cost load scan: 0.009298324584960938
load 1 adapters, 7 in total
Function load_lora_A took 1.2125968933105469 ms to run.
Function load_lora_B took 1.2323856353759766 ms to run.
cost realload: 2.8846263885498047
Function load_adapters took 2.907276153564453 ms to run.
current batch size: 8 token used ratio: 0.017875
cost load scan: 0.008821487426757812
load 1 adapters, 8 in total
Function load_lora_A took 1.178741455078125 ms to run.
Function load_lora_B took 1.241445541381836 ms to run.
cost realload: 2.8460025787353516
Function load_adapters took 2.869129180908203 ms to run.
cost load scan: 0.008344650268554688
load 0 adapters, 8 in total
cost realload: 0.3180503845214844
Function load_adapters took 0.3440380096435547 ms to run.
cost load scan: 0.008344650268554688
load 0 adapters, 8 in total
cost realload: 0.2894401550292969
Function load_adapters took 0.31638145446777344 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 8 in total
cost realload: 0.2903938293457031
Function load_adapters took 0.3154277801513672 ms to run.
current batch size: 13 token used ratio: 0.03195833333333333
cost load scan: 0.009775161743164062
load 1 adapters, 9 in total
Function load_lora_A took 1.2001991271972656 ms to run.
Function load_lora_B took 1.2362003326416016 ms to run.
cost realload: 2.8553009033203125
Function load_adapters took 2.8765201568603516 ms to run.
current batch size: 14 token used ratio: 0.039575
cost load scan: 0.007867813110351562
load 0 adapters, 9 in total
cost realload: 0.30422210693359375
Function load_adapters took 0.32973289489746094 ms to run.
current batch size: 15 token used ratio: 0.04774166666666667
Avg tokens(prompt+generate) throughput:  535.392 tokens/s
Avg prompt tokens throughput:            315.377 tokens/s
Avg generate tokens throughput:          220.014 tokens/s
cost load scan: 0.0095367431640625
load 0 adapters, 9 in total
cost realload: 0.3445148468017578
Function load_adapters took 0.3781318664550781 ms to run.
cost offload scan: 0.30231475830078125
offload 1 adapters, 8 remains
cost offload cat: 0.038623809814453125
cost offload free mem manager: 0.05340576171875
cost offload torch.empty: 0.024318695068359375
cost offload a_loc update: 139.22524452209473
Function offload_adapters took 140.02585411071777 ms to run.
cost load scan: 0.008821487426757812
load 1 adapters, 9 in total
Function load_lora_A took 1.2617111206054688 ms to run.
Function load_lora_B took 1.238107681274414 ms to run.
cost realload: 2.924680709838867
Function load_adapters took 2.947568893432617 ms to run.
current batch size: 16 token used ratio: 0.053925
offload 0 adapters, 9 remains
Function offload_adapters took 0.012874603271484375 ms to run.
offload 0 adapters, 9 remains
Function offload_adapters took 0.013113021850585938 ms to run.
offload 0 adapters, 9 remains
Function offload_adapters took 0.0133514404296875 ms to run.
cost offload scan: 0.1354217529296875
offload 1 adapters, 8 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.04410743713378906
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.11086463928222656
Function offload_adapters took 0.6356239318847656 ms to run.
offload 0 adapters, 8 remains
Function offload_adapters took 0.013113021850585938 ms to run.
cost offload scan: 0.08726119995117188
offload 1 adapters, 7 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.0438690185546875
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10538101196289062
Function offload_adapters took 0.5846023559570312 ms to run.
cost offload scan: 0.08416175842285156
offload 1 adapters, 6 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.04482269287109375
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.1010894775390625
Function offload_adapters took 0.5788803100585938 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.012874603271484375 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.013113021850585938 ms to run.
current batch size: 7 token used ratio: 0.023225
cost offload scan: 0.1266002655029297
offload 1 adapters, 5 remains
cost offload cat: 0.03170967102050781
cost offload free mem manager: 0.04410743713378906
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10395050048828125
Function offload_adapters took 0.6172657012939453 ms to run.
cost offload scan: 0.08249282836914062
offload 1 adapters, 4 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.5648136138916016 ms to run.
cost offload scan: 0.091552734375
offload 1 adapters, 3 remains
cost offload cat: 0.034332275390625
cost offload free mem manager: 0.05698204040527344
cost offload torch.empty: 0.02384185791015625
cost offload a_loc update: 0.11324882507324219
Function offload_adapters took 0.6232261657714844 ms to run.
cost offload scan: 0.08869171142578125
offload 1 adapters, 2 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10466575622558594
Function offload_adapters took 0.5748271942138672 ms to run.
current batch size: 3 token used ratio: 0.009775
cost load scan: 0.010728836059570312
load 1 adapters, 3 in total
Function load_lora_A took 1.1990070343017578 ms to run.
Function load_lora_B took 1.2183189392089844 ms to run.
cost realload: 2.8603076934814453
Function load_adapters took 2.8841495513916016 ms to run.
cost load scan: 0.010251998901367188
load 1 adapters, 4 in total
Function load_lora_A took 1.203775405883789 ms to run.
Function load_lora_B took 1.230478286743164 ms to run.
cost realload: 2.842426300048828
Function load_adapters took 2.869844436645508 ms to run.
current batch size: 5 token used ratio: 0.0154
offload 0 adapters, 4 remains
Function offload_adapters took 0.012874603271484375 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 5 in total
Function load_lora_A took 1.1658668518066406 ms to run.
Function load_lora_B took 1.2090206146240234 ms to run.
cost realload: 2.78472900390625
Function load_adapters took 2.8061866760253906 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 6 in total
Function load_lora_A took 1.2233257293701172 ms to run.
Function load_lora_B took 1.234292984008789 ms to run.
cost realload: 2.8564929962158203
Function load_adapters took 2.880096435546875 ms to run.
current batch size: 6 token used ratio: 0.017725
cost offload scan: 0.08702278137207031
offload 1 adapters, 5 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04410743713378906
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10371208190917969
Function offload_adapters took 0.5705356597900391 ms to run.
cost load scan: INFO:     127.0.0.1:43796 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43806 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43816 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45350 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45360 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45362 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45366 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45376 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45392 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45398 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45412 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45424 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45438 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45444 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45452 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33786 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33788 - "POST /generate_stream HTTP/1.1" 200 OK
0.010013580322265625
load 0 adapters, 5 in total
cost realload: 0.3337860107421875
Function load_adapters took 0.3590583801269531 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.018596649169921875 ms to run.
current batch size: 5 token used ratio: 0.0141
cost load scan: 0.00762939453125
load 0 adapters, 5 in total
cost realload: 0.31065940856933594
Function load_adapters took 0.33664703369140625 ms to run.
cost load scan: 0.011205673217773438
load 1 adapters, 6 in total
Function load_lora_A took 1.190185546875 ms to run.
Function load_lora_B took 1.2536048889160156 ms to run.
cost realload: 2.869844436645508
Function load_adapters took 2.8908252716064453 ms to run.
current batch size: 8 token used ratio: 0.022683333333333333
Avg tokens(prompt+generate) throughput:  516.602 tokens/s
Avg prompt tokens throughput:            252.703 tokens/s
Avg generate tokens throughput:          263.899 tokens/s
current batch size: 8 token used ratio: 0.026016666666666667
offload 0 adapters, 6 remains
Function offload_adapters took 0.012874603271484375 ms to run.
cost offload scan: 0.08869171142578125
offload 1 adapters, 5 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.05030632019042969
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.110626220703125
Function offload_adapters took 0.5962848663330078 ms to run.
current batch size: 6 token used ratio: 0.020841666666666668
cost offload scan: 0.087738037109375
offload 1 adapters, 4 remains
cost offload cat: 0.035762786865234375
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10752677917480469
Function offload_adapters took 0.5965232849121094 ms to run.
offload 0 adapters, 4 remains
Function offload_adapters took 0.0133514404296875 ms to run.
cost load scan: 0.009298324584960938
load 1 adapters, 5 in total
Function load_lora_A took 1.234292984008789 ms to run.
Function load_lora_B took 1.2161731719970703 ms to run.
cost realload: 2.893209457397461
Function load_adapters took 2.9163360595703125 ms to run.
current batch size: 5 token used ratio: 0.0164
cost offload scan: 0.08654594421386719
offload 1 adapters, 4 remains
cost offload cat: 0.03409385681152344
cost offload free mem manager: 0.048160552978515625
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.11086463928222656
Function offload_adapters took 0.6060600280761719 ms to run.
current batch size: 4 token used ratio: 0.013991666666666666
cost load scan: 0.008344650268554688
load 1 adapters, 5 in total
Function load_lora_A took 1.199483871459961 ms to run.
Function load_lora_B took 1.2280941009521484 ms to run.
cost realload: 2.847909927368164
Function load_adapters took 2.8717517852783203 ms to run.
cost offload scan: 0.08368492126464844
offload 1 adapters, 4 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10466575622558594
Function offload_adapters took 0.5650520324707031 ms to run.
cost load scan: 0.011920928955078125
load 1 adapters, 5 in total
Function load_lora_A took 1.2173652648925781 ms to run.
Function load_lora_B took 1.2004375457763672 ms to run.
cost realload: 2.822399139404297
Function load_adapters took 2.843618392944336 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 5 in total
cost realload: 0.2980232238769531
Function load_adapters took 0.3230571746826172 ms to run.
cost offload scan: 0.08726119995117188
offload 1 adapters, 4 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10275840759277344
Function offload_adapters took 0.5733966827392578 ms to run.
cost offload scan: 0.08702278137207031
offload 1 adapters, 3 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10204315185546875
Function offload_adapters took 0.5667209625244141 ms to run.
current batch size: 4 token used ratio: 0.009258333333333334
cost load scan: 0.008106231689453125
load 1 adapters, 4 in total
Function load_lora_A took 1.2028217315673828 ms to run.
Function load_lora_B took 1.2085437774658203 ms to run.
cost realload: 2.8154850006103516
Function load_adapters took 2.8362274169921875 ms to run.
current batch size: 5 token used ratio: 0.013441666666666666
cost load scan: 0.00858306884765625
load 1 adapters, 5 in total
Function load_lora_A took 1.1653900146484375 ms to run.
Function load_lora_B took 1.2500286102294922 ms to run.
cost realload: 2.8052330017089844
Function load_adapters took 2.826690673828125 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 5 in total
cost realload: 0.29468536376953125
Function load_adapters took 0.3190040588378906 ms to run.
current batch size: 7 token used ratio: 0.019733333333333332
cost load scan: 0.010967254638671875
load 1 adapters, 6 in total
Function load_lora_A took 1.190185546875 ms to run.
Function load_lora_B took 1.1715888977050781 ms to run.
cost realload: 2.7823448181152344
Function load_adapters took 2.8047561645507812 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 6 in total
cost realload: 0.2853870391845703
Function load_adapters took 0.30922889709472656 ms to run.
current batch size: 10 token used ratio: 0.02896666666666667
cost offload scan: 0.087738037109375
offload 1 adapters, 5 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.047206878662109375
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.11563301086425781
Function offload_adapters took 0.6003379821777344 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.013113021850585938 ms to run.
cost load scan: 0.009775161743164062
load 1 adapters, 6 in total
Function load_lora_A took 1.2197494506835938 ms to run.
Function load_lora_B took 1.2156963348388672 ms to run.
cost realload: 2.859354019165039
Function load_adapters took 2.882242202758789 ms to run.
cost load scan: 0.011444091796875
load 1 adapters, 7 in total
Function load_lora_A took 1.2040138244628906 ms to run.
Function load_lora_B took 1.22833251953125 ms to run.
cost realload: 2.832651138305664
Function load_adapters took 2.8533935546875 ms to run.
offload 0 adapters, 7 remains
Function offload_adapters took 0.0133514404296875 ms to run.
current batch size: 9 token used ratio: 0.02509166666666667
cost offload scan: 0.08630752563476562
offload 1 adapters, 6 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.1125335693359375
Function offload_adapters took 0.5767345428466797 ms to run.
current batch size: 8 token used ratio: 0.024475
Avg tokens(prompt+generate) throughput:  570.029 tokens/s
Avg prompt tokens throughput:            281.566 tokens/s
Avg generate tokens throughput:          288.463 tokens/s
offload 0 adapters, 6 remains
Function offload_adapters took 0.013113021850585938 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.3101825714111328
Function load_adapters took 0.3352165222167969 ms to run.
cost offload scan: 0.08606910705566406
offload 1 adapters, 5 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10561943054199219
Function offload_adapters took 0.5700588226318359 ms to run.
current batch size: 7 token used ratio: 0.020875
cost offload scan: 0.08916854858398438
offload 1 adapters, 4 remains
cost offload cat: 0.034332275390625
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10919570922851562
Function offload_adapters took 0.6046295166015625 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 5 in total
INFO:     127.0.0.1:33792 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33804 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33810 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33824 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33832 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33846 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33862 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33878 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33884 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:33896 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40576 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40580 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40590 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40596 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40598 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40614 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40620 - "POST /generate_stream HTTP/1.1" 200 OK
Function load_lora_A took 1.2483596801757812 ms to run.
Function load_lora_B took 1.2297630310058594 ms to run.
cost realload: 2.9449462890625
Function load_adapters took 2.966165542602539 ms to run.
current batch size: 7 token used ratio: 0.022225
offload 0 adapters, 5 remains
Function offload_adapters took 0.0133514404296875 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.013113021850585938 ms to run.
cost offload scan: 0.08702278137207031
offload 1 adapters, 4 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.050067901611328125
cost offload torch.empty: 0.023603439331054688
cost offload a_loc update: 0.10657310485839844
Function offload_adapters took 0.5826950073242188 ms to run.
cost offload scan: 0.08440017700195312
offload 1 adapters, 3 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.102996826171875
Function offload_adapters took 0.5702972412109375 ms to run.
current batch size: 3 token used ratio: 0.008941666666666667
cost offload scan: 0.08058547973632812
offload 1 adapters, 2 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.1087188720703125
Function offload_adapters took 0.5664825439453125 ms to run.
cost load scan: 0.010967254638671875
load 2 adapters, 4 in total
Function load_lora_A took 1.1522769927978516 ms to run.
Function load_lora_B took 1.2197494506835938 ms to run.
Function load_lora_A took 1.1703968048095703 ms to run.
Function load_lora_B took 1.2240409851074219 ms to run.
cost realload: 5.245447158813477
Function load_adapters took 5.266427993774414 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 4 in total
cost realload: 0.2918243408203125
Function load_adapters took 0.3161430358886719 ms to run.
current batch size: 5 token used ratio: 0.013266666666666666
cost load scan: 0.009775161743164062
load 0 adapters, 4 in total
cost realload: 0.3044605255126953
Function load_adapters took 0.3306865692138672 ms to run.
current batch size: 6 token used ratio: 0.017616666666666666
current batch size: 6 token used ratio: 0.020116666666666668
offload 0 adapters, 4 remains
Function offload_adapters took 0.016689300537109375 ms to run.
cost offload scan: 0.08559226989746094
offload 1 adapters, 3 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.0438690185546875
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.11134147644042969
Function offload_adapters took 0.5881786346435547 ms to run.
cost load scan: 0.011205673217773438
load 2 adapters, 5 in total
Function load_lora_A took 1.2013912200927734 ms to run.
Function load_lora_B took 1.2292861938476562 ms to run.
Function load_lora_A took 1.1916160583496094 ms to run.
Function load_lora_B took 1.2226104736328125 ms to run.
cost realload: 5.359411239624023
Function load_adapters took 5.382776260375977 ms to run.
current batch size: 6 token used ratio: 0.018158333333333332
cost load scan: 0.008106231689453125
load 1 adapters, 6 in total
Function load_lora_A took 1.1897087097167969 ms to run.
Function load_lora_B took 1.2357234954833984 ms to run.
cost realload: 2.8176307678222656
Function load_adapters took 2.839326858520508 ms to run.
cost offload scan: 0.09059906005859375
offload 1 adapters, 5 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.102996826171875
Function offload_adapters took 0.5762577056884766 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.012636184692382812 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 6 in total
Function load_lora_A took 1.2104511260986328 ms to run.
Function load_lora_B took 1.2099742889404297 ms to run.
cost realload: 2.821207046508789
Function load_adapters took 2.8429031372070312 ms to run.
current batch size: 6 token used ratio: 0.0171
cost offload scan: 0.08344650268554688
offload 1 adapters, 5 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.11014938354492188
Function offload_adapters took 0.5726814270019531 ms to run.
cost load scan: 0.011682510375976562
load 1 adapters, 6 in total
Function load_lora_A took 1.2080669403076172 ms to run.
Function load_lora_B took 1.2123584747314453 ms to run.
cost realload: 2.827167510986328
Function load_adapters took 2.8481483459472656 ms to run.
current batch size: 6 token used ratio: 0.017608333333333333
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.29540061950683594
Function load_adapters took 0.3218650817871094 ms to run.
Avg tokens(prompt+generate) throughput:  560.062 tokens/s
Avg prompt tokens throughput:            300.312 tokens/s
Avg generate tokens throughput:          259.750 tokens/s
cost load scan: 0.008106231689453125
load 1 adapters, 7 in total
Function load_lora_A took 1.1844635009765625 ms to run.
Function load_lora_B took 1.2631416320800781 ms to run.
cost realload: 2.8412342071533203
Function load_adapters took 2.8634071350097656 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 7 in total
cost realload: 0.2987384796142578
Function load_adapters took 0.32329559326171875 ms to run.
cost offload scan: 0.0896453857421875
offload 1 adapters, 6 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.029802322387695312
cost offload a_loc update: 0.10514259338378906
Function offload_adapters took 0.5860328674316406 ms to run.
current batch size: 8 token used ratio: 0.021866666666666666
cost load scan: 0.00858306884765625
load 1 adapters, 7 in total
Function load_lora_A took 1.2209415435791016 ms to run.
Function load_lora_B took 1.2614727020263672 ms to run.
cost realload: 2.8781890869140625
Function load_adapters took 2.8994083404541016 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 7 in total
cost realload: 0.2856254577636719
Function load_adapters took 0.31065940856933594 ms to run.
cost load scan: 0.009059906005859375
load 1 adapters, 8 in total
Function load_lora_A took 1.2214183807373047 ms to run.
Function load_lora_B took 1.2178421020507812 ms to run.
cost realload: 2.8624534606933594
Function load_adapters took 2.8841495513916016 ms to run.
cost load scan: 0.0073909759521484375
load 0 adapters, 8 in total
cost realload: 0.29540061950683594
Function load_adapters took 0.32019615173339844 ms to run.
current batch size: 13 token used ratio: 0.03648333333333333
offload 0 adapters, 8 remains
Function offload_adapters took 0.013828277587890625 ms to run.
cost offload scan: 0.08535385131835938
offload 1 adapters, 7 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.11014938354492188
Function offload_adapters took 0.5857944488525391 ms to run.
cost offload scan: 0.08511543273925781
offload 1 adapters, 6 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04410743713378906
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10347366333007812
Function offload_adapters took 0.5702972412109375 ms to run.
current batch size: 10 token used ratio: 0.029583333333333333
cost offload scan: 0.08869171142578125
offload 1 adapters, 5 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.12612342834472656
Function offload_adapters took 0.5965232849121094 ms to run.
current batch size: 9 token used ratio: 0.029425
offload 0 adapters, 5 remains
Function offload_adapters took 0.015974044799804688 ms to run.
current batch size: 8 token used ratio: 0.028941666666666668
offload 0 adapters, 5 remains
INFO:     127.0.0.1:40626 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40638 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40650 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40652 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40664 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40678 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:44626 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:44642 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:44648 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:44662 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:44676 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:44688 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:44690 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:44692 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59842 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59844 - "POST /generate_stream HTTP/1.1" 200 OK
Function offload_adapters took 0.014781951904296875 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.013113021850585938 ms to run.
cost load scan: 0.007867813110351562
load 1 adapters, 6 in total
Function load_lora_A took 1.222848892211914 ms to run.
Function load_lora_B took 1.2335777282714844 ms to run.
cost realload: 2.9036998748779297
Function load_adapters took 2.9261112213134766 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 6 in total
cost realload: 0.3018379211425781
Function load_adapters took 0.3266334533691406 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.012874603271484375 ms to run.
cost offload scan: 0.0820159912109375
offload 1 adapters, 5 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.11324882507324219
Function offload_adapters took 0.5702972412109375 ms to run.
current batch size: 7 token used ratio: 0.022791666666666665
offload 0 adapters, 5 remains
Function offload_adapters took 0.012874603271484375 ms to run.
cost offload scan: 0.08511543273925781
offload 1 adapters, 4 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10466575622558594
Function offload_adapters took 0.5691051483154297 ms to run.
cost offload scan: 0.08344650268554688
offload 1 adapters, 3 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.5795955657958984 ms to run.
cost offload scan: 0.08988380432128906
offload 1 adapters, 2 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10442733764648438
Function offload_adapters took 0.5695819854736328 ms to run.
cost load scan: 0.01239776611328125
load 1 adapters, 3 in total
Function load_lora_A took 1.2104511260986328 ms to run.
Function load_lora_B took 1.219034194946289 ms to run.
cost realload: 2.8524398803710938
Function load_adapters took 2.8738975524902344 ms to run.
current batch size: 4 token used ratio: 0.010833333333333334
current batch size: 4 token used ratio: 0.0125
cost load scan: 0.00762939453125
load 0 adapters, 3 in total
cost realload: 0.30112266540527344
Function load_adapters took 0.3249645233154297 ms to run.
cost load scan: 0.010251998901367188
load 1 adapters, 4 in total
Function load_lora_A took 1.1870861053466797 ms to run.
Function load_lora_B took 1.2006759643554688 ms to run.
cost realload: 2.789735794067383
Function load_adapters took 2.814054489135742 ms to run.
current batch size: 6 token used ratio: 0.0179
cost load scan: 0.007867813110351562
load 1 adapters, 5 in total
Function load_lora_A took 1.2404918670654297 ms to run.
Function load_lora_B took 1.2226104736328125 ms to run.
cost realload: 2.886533737182617
Function load_adapters took 2.9082298278808594 ms to run.
Avg tokens(prompt+generate) throughput:  690.901 tokens/s
Avg prompt tokens throughput:            348.998 tokens/s
Avg generate tokens throughput:          341.902 tokens/s
current batch size: 7 token used ratio: 0.022741666666666667
offload 0 adapters, 5 remains
Function offload_adapters took 0.012874603271484375 ms to run.
cost load scan: 0.0073909759521484375
load 0 adapters, 5 in total
cost realload: 0.28967857360839844
Function load_adapters took 0.31447410583496094 ms to run.
cost offload scan: 0.08749961853027344
offload 1 adapters, 4 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10418891906738281
Function offload_adapters took 0.5710124969482422 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 4 in total
cost realload: 0.2875328063964844
Function load_adapters took 0.31256675720214844 ms to run.
cost offload scan: 0.087738037109375
offload 1 adapters, 3 remains
cost offload cat: 0.03361701965332031
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10442733764648438
Function offload_adapters took 0.5812644958496094 ms to run.
current batch size: 6 token used ratio: 0.016375
current batch size: 6 token used ratio: 0.018875
offload 0 adapters, 3 remains
Function offload_adapters took 0.013589859008789062 ms to run.
current batch size: 5 token used ratio: 0.01655
offload 0 adapters, 3 remains
Function offload_adapters took 0.0133514404296875 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 4 in total
Function load_lora_A took 1.186370849609375 ms to run.
Function load_lora_B took 1.2290477752685547 ms to run.
cost realload: 2.8374195098876953
Function load_adapters took 2.864837646484375 ms to run.
offload 0 adapters, 4 remains
Function offload_adapters took 0.013589859008789062 ms to run.
current batch size: 4 token used ratio: 0.013408333333333333
cost offload scan: 0.08654594421386719
offload 1 adapters, 3 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.11301040649414062
Function offload_adapters took 0.5812644958496094 ms to run.
current batch size: 3 token used ratio: 0.010625
cost offload scan: 0.08916854858398438
offload 1 adapters, 2 remains
cost offload cat: 0.03147125244140625
cost offload free mem manager: 0.050067901611328125
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.11277198791503906
Function offload_adapters took 0.5986690521240234 ms to run.
cost load scan: 0.009059906005859375
load 1 adapters, 3 in total
Function load_lora_A took 1.210927963256836 ms to run.
Function load_lora_B took 1.2233257293701172 ms to run.
cost realload: 2.8536319732666016
Function load_adapters took 2.874612808227539 ms to run.
cost load scan: 0.010728836059570312
load 2 adapters, 5 in total
Function load_lora_A took 1.1844635009765625 ms to run.
Function load_lora_B took 1.2125968933105469 ms to run.
Function load_lora_A took 1.1920928955078125 ms to run.
Function load_lora_B took 1.2655258178710938 ms to run.
cost realload: 5.32984733581543
Function load_adapters took 5.350589752197266 ms to run.
cost offload scan: 0.08344650268554688
offload 1 adapters, 4 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10967254638671875
Function offload_adapters took 0.5776882171630859 ms to run.
current batch size: 4 token used ratio: 0.010025
current batch size: 4 token used ratio: 0.011691666666666666
cost offload scan: 0.08320808410644531
offload 1 adapters, 3 remains
cost offload cat: 0.034332275390625
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.11205673217773438
Function offload_adapters took 0.58746337890625 ms to run.
current batch size: 3 token used ratio: 0.008991666666666667
cost load scan: 0.009298324584960938
load 1 adapters, 4 in total
Function load_lora_A took 1.218557357788086 ms to run.
Function load_lora_B took 1.2354850769042969 ms to run.
cost realload: 2.8874874114990234
Function load_adapters took 2.9103755950927734 ms to run.
cost load scan: 0.013828277587890625
load 1 adapters, 5 in total
Function load_lora_A took 1.2466907501220703 ms to run.
Function load_lora_B took 1.233816146850586 ms to run.
cost realload: 2.8808116912841797
Function load_adapters took 2.902507781982422 ms to run.
current batch size: 5 token used ratio: 0.014975
Avg tokens(prompt+generate) throughput:  409.692 tokens/s
Avg prompt tokens throughput:            197.954 tokens/s
Avg generate tokens throughput:          211.737 tokens/s
cost load scan: 0.00762939453125
load 0 adapters, 5 in total
cost realload: 0.2956390380859375
INFO:     127.0.0.1:59848 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59850 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59866 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59880 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43338 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43350 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43358 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43368 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43370 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43376 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43392 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43406 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43422 - "POST /generate_stream HTTP/1.1" 200 OK
Function load_adapters took 0.3199577331542969 ms to run.
current batch size: 6 token used ratio: 0.019158333333333333
offload 0 adapters, 5 remains
Function offload_adapters took 0.012874603271484375 ms to run.
cost offload scan: 0.08821487426757812
offload 1 adapters, 4 remains
cost offload cat: 0.03409385681152344
cost offload free mem manager: 0.04506111145019531
cost offload torch.empty: 0.03504753112792969
cost offload a_loc update: 0.10752677917480469
Function offload_adapters took 0.6253719329833984 ms to run.
cost offload scan: 0.08797645568847656
offload 1 adapters, 3 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.03170967102050781
cost offload a_loc update: 0.10347366333007812
Function offload_adapters took 0.579833984375 ms to run.
cost load scan: 0.007867813110351562
load 1 adapters, 4 in total
Function load_lora_A took 1.192331314086914 ms to run.
Function load_lora_B took 1.2166500091552734 ms to run.
cost realload: 2.8181076049804688
Function load_adapters took 2.8395652770996094 ms to run.
current batch size: 4 token used ratio: 0.011141666666666666
cost load scan: 0.008344650268554688
load 1 adapters, 5 in total
Function load_lora_A took 1.2526512145996094 ms to run.
Function load_lora_B took 1.2476444244384766 ms to run.
cost realload: 2.9027462005615234
Function load_adapters took 2.9244422912597656 ms to run.
current batch size: 5 token used ratio: 0.014975
cost offload scan: 0.08320808410644531
offload 1 adapters, 4 remains
cost offload cat: 0.037670135498046875
cost offload free mem manager: 0.04506111145019531
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10418891906738281
Function offload_adapters took 0.576019287109375 ms to run.
current batch size: 4 token used ratio: 0.012816666666666667
cost offload scan: 0.08273124694824219
offload 1 adapters, 3 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.04506111145019531
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10347366333007812
Function offload_adapters took 0.5795955657958984 ms to run.
current batch size: 3 token used ratio: 0.010241666666666666
cost offload scan: 0.08559226989746094
offload 1 adapters, 2 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.0438690185546875
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.5695819854736328 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 3 in total
Function load_lora_A took 1.2328624725341797 ms to run.
Function load_lora_B took 1.2443065643310547 ms to run.
cost realload: 2.8808116912841797
Function load_adapters took 2.9020309448242188 ms to run.
current batch size: 3 token used ratio: 0.009925
cost offload scan: 0.08130073547363281
offload 1 adapters, 2 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.047206878662109375
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.5724430084228516 ms to run.
current batch size: 2 token used ratio: 0.006933333333333333
cost offload scan: 0.08058547973632812
offload 1 adapters, 1 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10061264038085938
Function offload_adapters took 0.55694580078125 ms to run.
current batch size: 1 token used ratio: 0.003491666666666667
cost load scan: 0.007867813110351562
load 0 adapters, 1 in total
cost realload: 0.3044605255126953
Function load_adapters took 0.32901763916015625 ms to run.
current batch size: 2 token used ratio: 0.005991666666666667
Avg tokens(prompt+generate) throughput:  268.993 tokens/s
Avg prompt tokens throughput:            119.774 tokens/s
Avg generate tokens throughput:          149.219 tokens/s
cost load scan: 0.009298324584960938
load 0 adapters, 1 in total
cost realload: 0.3006458282470703
Function load_adapters took 0.3247261047363281 ms to run.
current batch size: 3 token used ratio: 0.008591666666666666
offload 0 adapters, 1 remains
Function offload_adapters took 0.0152587890625 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 2 in total
Function load_lora_A took 1.2252330780029297 ms to run.
Function load_lora_B took 1.2247562408447266 ms to run.
cost realload: 2.89154052734375
Function load_adapters took 2.9137134552001953 ms to run.
current batch size: 3 token used ratio: 0.0072833333333333335
current batch size: 3 token used ratio: 0.008533333333333334
cost load scan: 0.009775161743164062
load 1 adapters, 3 in total
Function load_lora_A took 1.2161731719970703 ms to run.
Function load_lora_B took 1.2569427490234375 ms to run.
cost realload: 2.891063690185547
Function load_adapters took 2.912759780883789 ms to run.
current batch size: 4 token used ratio: 0.012416666666666666
offload 0 adapters, 3 remains
Function offload_adapters took 0.01621246337890625 ms to run.
cost load scan: 0.010013580322265625
load 1 adapters, 4 in total
Function load_lora_A took 1.1980533599853516 ms to run.
Function load_lora_B took 1.234292984008789 ms to run.
cost realload: 2.8514862060546875
Function load_adapters took 2.874135971069336 ms to run.
current batch size: 4 token used ratio: 0.012216666666666667
cost offload scan: 0.08630752563476562
offload 1 adapters, 3 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.11944770812988281
Function offload_adapters took 0.6058216094970703 ms to run.
cost load scan: 0.011920928955078125
load 1 adapters, 4 in total
Function load_lora_A took 1.2154579162597656 ms to run.
Function load_lora_B took 1.2328624725341797 ms to run.
cost realload: 2.849578857421875
Function load_adapters took 2.870798110961914 ms to run.
cost load scan: 0.01049041748046875
load 1 adapters, 5 in total
Function load_lora_A took 1.203775405883789 ms to run.
Function load_lora_B took 1.230001449584961 ms to run.
cost realload: 2.832651138305664
Function load_adapters took 2.853870391845703 ms to run.
current batch size: 5 token used ratio: 0.014291666666666666
cost offload scan: 0.08392333984375
offload 1 adapters, 4 remains
cost offload cat: 0.03147125244140625
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.03266334533691406
cost offload a_loc update: 0.102996826171875
Function offload_adapters took 0.5793571472167969 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 4 in total
cost realload: 0.29540061950683594
Function load_adapters took 0.3199577331542969 ms to run.
current batch size: 5 token used ratio: 0.014141666666666667
current batch size: 5 token used ratio: 0.016225
offload 0 adapters, 4 remains
Function offload_adapters took 0.013113021850585938 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.2323856353759766 ms to run.
Function load_lora_B took 1.2137889862060547 ms to run.
cost realload: 2.846240997314453
Function load_adapters took 2.8672218322753906 ms to run.
current batch size: 5 token used ratio: 0.015466666666666667
cost offload scan: 0.09107589721679688
offload 1 adapters, 4 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.02193450927734375
cost offload a_loc update: 0.10538101196289062
Function offload_adapters took 0.5834102630615234 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 4 in total
cost realload: 0.30541419982910156
Function load_adapters took 0.3304481506347656 ms to run.
current batch size: 5 token used ratio: 0.015166666666666667
Avg tokens(prompt+generate) throughput:  395.533 tokens/s
Avg prompt tokens throughput:            213.140 tokens/s
Avg generate tokens throughput:          182.392 tokens/s
cost offload scan: 0.08797645568847656
offload 1 adapters, 3 remains
cost offload cat: 0.034809112548828125
cost offload free mem manager: INFO:     127.0.0.1:38598 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38604 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38606 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38616 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38632 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38640 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38644 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38658 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38668 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38670 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38678 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38684 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38690 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38696 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38700 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45302 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45308 - "POST /generate_stream HTTP/1.1" 200 OK
0.04363059997558594
cost offload torch.empty: 0.024318695068359375
cost offload a_loc update: 0.10824203491210938
Function offload_adapters took 0.6425380706787109 ms to run.
cost offload scan: 0.08106231689453125
offload 1 adapters, 2 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.030040740966796875
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.5767345428466797 ms to run.
current batch size: 3 token used ratio: 0.008833333333333334
cost load scan: 0.007867813110351562
load 0 adapters, 2 in total
cost realload: 0.3082752227783203
Function load_adapters took 0.33283233642578125 ms to run.
offload 0 adapters, 2 remains
Function offload_adapters took 0.013113021850585938 ms to run.
current batch size: 3 token used ratio: 0.00875
cost load scan: 0.00858306884765625
load 1 adapters, 3 in total
Function load_lora_A took 1.2378692626953125 ms to run.
Function load_lora_B took 1.2390613555908203 ms to run.
cost realload: 2.8786659240722656
Function load_adapters took 2.9015541076660156 ms to run.
cost load scan: 0.007867813110351562
load 1 adapters, 4 in total
Function load_lora_A took 1.1692047119140625 ms to run.
Function load_lora_B took 1.214742660522461 ms to run.
cost realload: 2.778291702270508
Function load_adapters took 2.799510955810547 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.2061595916748047 ms to run.
Function load_lora_B took 1.2061595916748047 ms to run.
cost realload: 2.8107166290283203
Function load_adapters took 2.8319358825683594 ms to run.
cost load scan: 0.012159347534179688
load 1 adapters, 6 in total
Function load_lora_A took 1.2135505676269531 ms to run.
Function load_lora_B took 1.2359619140625 ms to run.
cost realload: 2.860546112060547
Function load_adapters took 2.8839111328125 ms to run.
current batch size: 7 token used ratio: 0.018341666666666666
cost offload scan: 0.08225440979003906
offload 1 adapters, 5 remains
cost offload cat: 0.039577484130859375
cost offload free mem manager: 0.057220458984375
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10800361633300781
Function offload_adapters took 0.6060600280761719 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 6 in total
Function load_lora_A took 1.2247562408447266 ms to run.
Function load_lora_B took 1.2238025665283203 ms to run.
cost realload: 2.857208251953125
Function load_adapters took 2.8777122497558594 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.2925395965576172
Function load_adapters took 0.3268718719482422 ms to run.
current batch size: 8 token used ratio: 0.021766666666666667
offload 0 adapters, 6 remains
Function offload_adapters took 0.013589859008789062 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 6 in total
cost realload: 0.28705596923828125
Function load_adapters took 0.3123283386230469 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 7 in total
Function load_lora_A took 1.1906623840332031 ms to run.
Function load_lora_B took 1.2238025665283203 ms to run.
cost realload: 2.8247833251953125
Function load_adapters took 2.8460025787353516 ms to run.
current batch size: 9 token used ratio: 0.025391666666666667
cost offload scan: 0.08821487426757812
offload 1 adapters, 6 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04410743713378906
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.1068115234375
Function offload_adapters took 0.5724430084228516 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 6 in total
cost realload: 0.28443336486816406
Function load_adapters took 0.30922889709472656 ms to run.
current batch size: 9 token used ratio: 0.026633333333333332
cost load scan: 0.00762939453125
load 0 adapters, 6 in total
cost realload: 0.2911090850830078
Function load_adapters took 0.3154277801513672 ms to run.
cost offload scan: 0.08392333984375
offload 1 adapters, 5 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10657310485839844
Function offload_adapters took 0.5795955657958984 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.012636184692382812 ms to run.
current batch size: 8 token used ratio: 0.024975
cost load scan: 0.00762939453125
load 0 adapters, 5 in total
cost realload: 0.2956390380859375
Function load_adapters took 0.3216266632080078 ms to run.
cost offload scan: 0.08296966552734375
offload 1 adapters, 4 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.02193450927734375
cost offload a_loc update: 0.10395050048828125
Function offload_adapters took 0.5576610565185547 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 4 in total
cost realload: 0.28324127197265625
Function load_adapters took 0.30803680419921875 ms to run.
offload 0 adapters, 4 remains
Function offload_adapters took 0.012636184692382812 ms to run.
cost offload scan: 0.09441375732421875
offload 1 adapters, 3 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10371208190917969
Function offload_adapters took 0.5762577056884766 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 4 in total
Function load_lora_A took 1.2271404266357422 ms to run.
Function load_lora_B took 1.1980533599853516 ms to run.
cost realload: 2.8073787689208984
Function load_adapters took 2.8269290924072266 ms to run.
current batch size: 8 token used ratio: 0.023133333333333332
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.1701583862304688 ms to run.
Function load_lora_B took 1.2145042419433594 ms to run.
cost realload: 2.7823448181152344
Function load_adapters took 2.8035640716552734 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.012636184692382812 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.012636184692382812 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.0133514404296875 ms to run.
current batch size: 6 token used ratio: 0.016341666666666668
Avg tokens(prompt+generate) throughput:  665.498 tokens/s
Avg prompt tokens throughput:            354.073 tokens/s
Avg generate tokens throughput:          311.425 tokens/s
cost load scan: 0.008821487426757812
load 0 adapters, 5 in total
cost realload: 0.2827644348144531
Function load_adapters took 0.30803680419921875 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 6 in total
Function load_lora_A took 1.2247562408447266 ms to run.
Function load_lora_B took 1.2164115905761719 ms to run.
cost realload: 2.839803695678711
Function load_adapters took 2.8617382049560547 ms to run.
current batch size: 8 token used ratio: 0.023
cost offload scan: 0.08630752563476562
offload 1 adapters, 5 remains
cost offload cat: 0.03504753112792969
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.12159347534179688
Function offload_adapters took 0.6072521209716797 ms to run.
current batch size: 7 token used ratio: 0.022366666666666667
offload 0 adapters, 5 remains
Function offload_adapters took 0.015974044799804688 ms to run.
current batch size: 6 token used ratio: 0.021
cost offload scan: 0.08630752563476562
offload 1 adapters, 4 remains
cost offload cat: 0.03314018249511719
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.02193450927734375
cost offload a_loc update: 0.11396408081054688
Function offload_adapters took 0.591278076171875 ms to run.
cost offload scan: 0.08916854858398438
offload 1 adapters, 3 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10466575622558594
INFO:     127.0.0.1:45316 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45330 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45336 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45350 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45360 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45364 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:34062 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:34072 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:34084 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:34086 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:34094 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:34106 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:34116 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:34118 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:34130 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:34134 - "POST /generate_stream HTTP/1.1" 200 OK
Function offload_adapters took 0.5693435668945312 ms to run.
offload 0 adapters, 3 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost load scan: 0.016689300537109375
load 1 adapters, 4 in total
Function load_lora_A took 1.157522201538086 ms to run.
Function load_lora_B took 1.2505054473876953 ms to run.
cost realload: 2.835988998413086
Function load_adapters took 2.858400344848633 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.2004375457763672 ms to run.
Function load_lora_B took 1.2090206146240234 ms to run.
cost realload: 2.805471420288086
Function load_adapters took 2.8274059295654297 ms to run.
current batch size: 5 token used ratio: 0.014616666666666667
cost load scan: 0.009775161743164062
load 1 adapters, 6 in total
Function load_lora_A took 1.2159347534179688 ms to run.
Function load_lora_B took 1.2252330780029297 ms to run.
cost realload: 2.835988998413086
Function load_adapters took 2.857208251953125 ms to run.
cost offload scan: 0.08344650268554688
offload 1 adapters, 5 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10442733764648438
Function offload_adapters took 0.576019287109375 ms to run.
current batch size: 5 token used ratio: 0.015225
cost offload scan: 0.08392333984375
offload 1 adapters, 4 remains
cost offload cat: 0.034809112548828125
cost offload free mem manager: 0.045299530029296875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.5791187286376953 ms to run.
cost offload scan: 0.0820159912109375
offload 1 adapters, 3 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10514259338378906
Function offload_adapters took 0.5679130554199219 ms to run.
current batch size: 3 token used ratio: 0.008933333333333333
current batch size: 3 token used ratio: 0.010183333333333334
cost load scan: 0.009059906005859375
load 1 adapters, 4 in total
Function load_lora_A took 1.1744499206542969 ms to run.
Function load_lora_B took 1.2404918670654297 ms to run.
cost realload: 2.834320068359375
Function load_adapters took 2.8569698333740234 ms to run.
current batch size: 4 token used ratio: 0.013983333333333334
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.195669174194336 ms to run.
Function load_lora_B took 1.222372055053711 ms to run.
cost realload: 2.8123855590820312
Function load_adapters took 2.833127975463867 ms to run.
cost offload scan: 0.08130073547363281
offload 1 adapters, 4 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.0438690185546875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10609626770019531
Function offload_adapters took 0.5652904510498047 ms to run.
cost offload scan: 0.08463859558105469
offload 1 adapters, 3 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10442733764648438
Function offload_adapters took 0.5688667297363281 ms to run.
cost load scan: 0.011444091796875
load 1 adapters, 4 in total
Function load_lora_A took 1.1930465698242188 ms to run.
Function load_lora_B took 1.234292984008789 ms to run.
cost realload: 2.811908721923828
Function load_adapters took 2.830982208251953 ms to run.
cost offload scan: 0.08273124694824219
offload 1 adapters, 3 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.0438690185546875
cost offload torch.empty: 0.028848648071289062
cost offload a_loc update: 0.10442733764648438
Function offload_adapters took 0.5743503570556641 ms to run.
current batch size: 3 token used ratio: 0.007533333333333334
cost load scan: 0.008106231689453125
load 0 adapters, 3 in total
cost realload: 0.2949237823486328
Function load_adapters took 0.3197193145751953 ms to run.
Avg tokens(prompt+generate) throughput:  447.782 tokens/s
Avg prompt tokens throughput:            224.841 tokens/s
Avg generate tokens throughput:          222.941 tokens/s
current batch size: 4 token used ratio: 0.011416666666666667
cost load scan: 0.008344650268554688
load 1 adapters, 4 in total
Function load_lora_A took 1.2111663818359375 ms to run.
Function load_lora_B took 1.2178421020507812 ms to run.
cost realload: 2.8357505798339844
Function load_adapters took 2.8579235076904297 ms to run.
current batch size: 5 token used ratio: 0.015825
cost load scan: 0.008344650268554688
load 0 adapters, 4 in total
cost realload: 0.3135204315185547
Function load_adapters took 0.33974647521972656 ms to run.
cost load scan: 0.007867813110351562
load 1 adapters, 5 in total
Function load_lora_A took 1.19781494140625 ms to run.
Function load_lora_B took 1.207113265991211 ms to run.
cost realload: 2.8090476989746094
Function load_adapters took 2.8307437896728516 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 6 in total
Function load_lora_A took 1.2083053588867188 ms to run.
Function load_lora_B took 1.2326240539550781 ms to run.
cost realload: 2.8460025787353516
Function load_adapters took 2.8672218322753906 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.0133514404296875 ms to run.
current batch size: 7 token used ratio: 0.020141666666666665
cost offload scan: 0.0896453857421875
offload 1 adapters, 5 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10776519775390625
Function offload_adapters took 0.5869865417480469 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 6 in total
Function load_lora_A took 1.1949539184570312 ms to run.
Function load_lora_B took 1.2240409851074219 ms to run.
cost realload: 2.8162002563476562
Function load_adapters took 2.8371810913085938 ms to run.
current batch size: 7 token used ratio: 0.021416666666666667
cost offload scan: 0.08416175842285156
offload 1 adapters, 5 remains
cost offload cat: 0.03170967102050781
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10514259338378906
Function offload_adapters took 0.5691051483154297 ms to run.
current batch size: 6 token used ratio: 0.020116666666666668
cost offload scan: 0.08296966552734375
offload 1 adapters, 4 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10371208190917969
Function offload_adapters took 0.5652904510498047 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 5 in total
Function load_lora_A took 1.226663589477539 ms to run.
Function load_lora_B took 1.2335777282714844 ms to run.
cost realload: 2.8603076934814453
Function load_adapters took 2.8815269470214844 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.012636184692382812 ms to run.
current batch size: 5 token used ratio: 0.015816666666666666
cost load scan: 0.0073909759521484375
load 0 adapters, 5 in total
cost realload: 0.28896331787109375
Function load_adapters took 0.31256675720214844 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 5 in total
cost realload: 0.2963542938232422
Function load_adapters took 0.32138824462890625 ms to run.
current batch size: 7 token used ratio: 0.02263333333333333
cost offload scan: 0.08225440979003906
offload 1 adapters, 4 remains
cost offload cat: 0.03218650817871094
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10418891906738281
Function offload_adapters took 0.5624294281005859 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.1911392211914062 ms to run.
Function load_lora_B took 1.2009143829345703 ms to run.
cost realload: 2.788543701171875
INFO:     127.0.0.1:34142 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:34156 - "POST /generate_stream HTTP/1.1" 200 OK
For some LLaMA-based models, initializing the fast tokenizer may take a long time. To eliminate the initialization time, consider using 'hf-internal-testing/llama-tokenizer' instead of the original tokenizer.
llama-7b: 12.06 GB
peak working mem for (bs=20, seqlen=512): 0.70 GB
peak working mem for (bs=100, seqlen=512): 3.52 GB
all adapters (11) estimated size: 0.17 GB
avg adapter estimated size: 16.00 MB
INFO:     127.0.0.1:45698 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45714 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45724 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45738 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45752 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45764 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45778 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45792 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45802 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45806 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45818 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45830 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45840 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45852 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45860 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45862 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42872 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42880 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42892 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42906 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42916 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42924 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42926 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42936 - "POST /generate_stream HTTP/1.1" 200 OK
cost load scan: 0.010013580322265625
load 1 adapters, 1 in total
Function load_lora_A took 1.313924789428711 ms to run.
Function load_lora_B took 1.226663589477539 ms to run.
cost realload: 6.340265274047852
Function load_adapters took 6.36601448059082 ms to run.
cost load scan: 0.009298324584960938
load 2 adapters, 3 in total
Function load_lora_A took 1.2035369873046875 ms to run.
Function load_lora_B took 1.2331008911132812 ms to run.
Function load_lora_A took 1.2621879577636719 ms to run.
Function load_lora_B took 1.2476444244384766 ms to run.
cost realload: 5.507230758666992
Function load_adapters took 5.530595779418945 ms to run.
cost load scan: 0.008821487426757812
load 1 adapters, 4 in total
Function load_lora_A took 1.177072525024414 ms to run.
Function load_lora_B took 1.2433528900146484 ms to run.
cost realload: 2.8409957885742188
Function load_adapters took 2.8638839721679688 ms to run.
current batch size: 4 token used ratio: 0.009125
cost load scan: 0.009059906005859375
load 1 adapters, 5 in total
Function load_lora_A took 1.190185546875 ms to run.
Function load_lora_B took 1.2035369873046875 ms to run.
cost realload: 2.788066864013672
Function load_adapters took 2.809762954711914 ms to run.
current batch size: 5 token used ratio: 0.012991666666666667
cost load scan: 0.008344650268554688
load 0 adapters, 5 in total
cost realload: 0.3001689910888672
Function load_adapters took 0.3273487091064453 ms to run.
Avg tokens(prompt+generate) throughput:  201.756 tokens/s
Avg prompt tokens throughput:            149.693 tokens/s
Avg generate tokens throughput:           52.063 tokens/s
current batch size: 6 token used ratio: 0.017425
cost load scan: 0.008344650268554688
load 1 adapters, 6 in total
Function load_lora_A took 1.2156963348388672 ms to run.
Function load_lora_B took 1.238107681274414 ms to run.
cost realload: 2.852916717529297
Function load_adapters took 2.8769969940185547 ms to run.
current batch size: 7 token used ratio: 0.021975
cost load scan: 0.008821487426757812
load 1 adapters, 7 in total
Function load_lora_A took 1.1987686157226562 ms to run.
Function load_lora_B took 1.2314319610595703 ms to run.
cost realload: 2.8235912322998047
Function load_adapters took 2.84576416015625 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 8 in total
Function load_lora_A took 1.1920928955078125 ms to run.
Function load_lora_B took 1.1861324310302734 ms to run.
cost realload: 2.7675628662109375
Function load_adapters took 2.7887821197509766 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 8 in total
cost realload: 0.27942657470703125
Function load_adapters took 0.3046989440917969 ms to run.
cost offload scan: 0.13709068298339844
offload 1 adapters, 7 remains
cost offload cat: 0.034332275390625
cost offload free mem manager: 0.04887580871582031
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 11.819839477539062
Function offload_adapters took 12.389898300170898 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 7 in total
cost realload: 0.29397010803222656
Function load_adapters took 0.3192424774169922 ms to run.
current batch size: 10 token used ratio: 0.029466666666666665
cost load scan: 0.009059906005859375
load 1 adapters, 8 in total
Function load_lora_A took 1.1932849884033203 ms to run.
Function load_lora_B took 1.226186752319336 ms to run.
cost realload: 2.819538116455078
Function load_adapters took 2.8417110443115234 ms to run.
offload 0 adapters, 8 remains
Function offload_adapters took 0.012636184692382812 ms to run.
cost load scan: 0.008344650268554688
load 0 adapters, 8 in total
cost realload: 0.2703666687011719
Function load_adapters took 0.29468536376953125 ms to run.
cost offload scan: 0.2880096435546875
offload 1 adapters, 7 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10251998901367188
Function offload_adapters took 0.7748603820800781 ms to run.
offload 0 adapters, 7 remains
Function offload_adapters took 0.012874603271484375 ms to run.
current batch size: 9 token used ratio: 0.025366666666666666
cost offload scan: 0.08702278137207031
offload 1 adapters, 6 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.024080276489257812
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.5824565887451172 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 7 in total
Function load_lora_A took 1.1975765228271484 ms to run.
Function load_lora_B took 1.1944770812988281 ms to run.
cost realload: 2.796173095703125
Function load_adapters took 2.817392349243164 ms to run.
current batch size: 9 token used ratio: 0.02655
cost load scan: 0.007867813110351562
load 0 adapters, 7 in total
cost realload: 0.29921531677246094
Function load_adapters took 0.3247261047363281 ms to run.
offload 0 adapters, 7 remains
Function offload_adapters took 0.012636184692382812 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 8 in total
Function load_lora_A took 1.1968612670898438 ms to run.
Function load_lora_B took 1.2347698211669922 ms to run.
cost realload: 2.8276443481445312
Function load_adapters took 2.8476715087890625 ms to run.
offload 0 adapters, 8 remains
Function offload_adapters took 0.012636184692382812 ms to run.
current batch size: 10 token used ratio: 0.029225
cost load scan: 0.008344650268554688
load 1 adapters, 9 in total
Function load_lora_A took 1.2192726135253906 ms to run.
Function load_lora_B took 1.2047290802001953 ms to run.
cost realload: 2.8214454650878906
Function load_adapters took 2.841949462890625 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 10 in total
Function load_lora_A took 1.2063980102539062 ms to run.
Function load_lora_B took 1.2526512145996094 ms to run.
cost realload: 2.8700828552246094
Function load_adapters took 2.89154052734375 ms to run.
offload 0 adapters, 10 remains
Function offload_adapters took 0.012159347534179688 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 10 in total
cost realload: 0.2796649932861328
Function load_adapters took 0.3039836883544922 ms to run.
current batch size: 13 token used ratio: 0.037925
cost offload scan: 0.141143798828125
offload 1 adapters, 9 remains
cost offload cat: 0.03170967102050781
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.11444091796875
Function offload_adapters took 0.6384849548339844 ms to run.
cost load scan: 0.008344650268554688
load 0 adapters, 9 in total
cost realload: 0.2880096435546875
Function load_adapters took 0.31256675720214844 ms to run.
offload 0 adapters, 9 remains
Function offload_adapters took 0.012636184692382812 ms to run.
cost offload scan: 0.08273124694824219
offload 1 adapters, 8 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10395050048828125
Function offload_adapters took 0.5609989166259766 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 8 in total
cost realload: 0.27823448181152344
Function load_adapters took 0.3027915954589844 ms to run.
current batch size: 12 token used ratio: 0.03415833333333333
cost offload scan: 0.08225440979003906
offload 1 adapters, 7 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10228157043457031
Function offload_adapters took 0.5574226379394531 ms to run.
cost offload scan: 0.08463859558105469
offload 1 adapters, 6 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04410743713378906
cost offload torch.empty: 0.02193450927734375
cost offload a_loc update: 0.1087188720703125
Function offload_adapters took 0.5810260772705078 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.2834796905517578
Function load_adapters took 0.3082752227783203 ms to run.
INFO:     127.0.0.1:42952 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42966 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42968 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42970 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42980 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42986 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42996 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40794 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40810 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40820 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40832 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40838 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40848 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40860 - "POST /generate_stream HTTP/1.1" 200 OK
current batch size: 11 token used ratio: 0.03270833333333333
offload 0 adapters, 6 remains
Function offload_adapters took 0.013828277587890625 ms to run.
cost load scan: 0.008821487426757812
load 0 adapters, 6 in total
cost realload: 0.2830028533935547
Function load_adapters took 0.3070831298828125 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 7 in total
Function load_lora_A took 1.173257827758789 ms to run.
Function load_lora_B took 1.2502670288085938 ms to run.
cost realload: 2.8188228607177734
Function load_adapters took 2.8400421142578125 ms to run.
offload 0 adapters, 7 remains
Function offload_adapters took 0.012159347534179688 ms to run.
Avg tokens(prompt+generate) throughput:  931.620 tokens/s
Avg prompt tokens throughput:            490.121 tokens/s
Avg generate tokens throughput:          441.499 tokens/s
current batch size: 12 token used ratio: 0.03555
offload 0 adapters, 7 remains
Function offload_adapters took 0.014781951904296875 ms to run.
offload 0 adapters, 7 remains
Function offload_adapters took 0.011920928955078125 ms to run.
cost offload scan: 0.08916854858398438
offload 1 adapters, 6 remains
cost offload cat: 0.03170967102050781
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.11086463928222656
Function offload_adapters took 0.5817413330078125 ms to run.
current batch size: 9 token used ratio: 0.028283333333333334
offload 0 adapters, 6 remains
Function offload_adapters took 0.013589859008789062 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.011920928955078125 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.011920928955078125 ms to run.
cost offload scan: 0.08559226989746094
offload 1 adapters, 5 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10561943054199219
Function offload_adapters took 0.5800724029541016 ms to run.
current batch size: 5 token used ratio: 0.01675
cost offload scan: 0.08344650268554688
offload 1 adapters, 4 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10371208190917969
Function offload_adapters took 0.5614757537841797 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 5 in total
Function load_lora_A took 1.2080669403076172 ms to run.
Function load_lora_B took 1.201629638671875 ms to run.
cost realload: 2.8259754180908203
Function load_adapters took 2.8502941131591797 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 5 in total
cost realload: 0.2918243408203125
Function load_adapters took 0.3161430358886719 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 6 in total
Function load_lora_A took 1.2056827545166016 ms to run.
Function load_lora_B took 1.1980533599853516 ms to run.
cost realload: 2.7980804443359375
Function load_adapters took 2.8209686279296875 ms to run.
current batch size: 7 token used ratio: 0.0212
cost offload scan: 0.08177757263183594
offload 1 adapters, 5 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10251998901367188
Function offload_adapters took 0.560760498046875 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 6 in total
Function load_lora_A took 1.1982917785644531 ms to run.
Function load_lora_B took 1.2371540069580078 ms to run.
cost realload: 2.8319358825683594
Function load_adapters took 2.8531551361083984 ms to run.
cost offload scan: 0.08225440979003906
offload 1 adapters, 5 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10013580322265625
Function offload_adapters took 0.55694580078125 ms to run.
current batch size: 6 token used ratio: 0.018083333333333333
cost offload scan: 0.08440017700195312
offload 1 adapters, 4 remains
cost offload cat: 0.03337860107421875
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10156631469726562
Function offload_adapters took 0.5671977996826172 ms to run.
cost offload scan: 0.08130073547363281
offload 1 adapters, 3 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.5538463592529297 ms to run.
current batch size: 4 token used ratio: 0.012308333333333333
cost load scan: 0.00858306884765625
load 1 adapters, 4 in total
Function load_lora_A took 1.2156963348388672 ms to run.
Function load_lora_B took 1.2404918670654297 ms to run.
cost realload: 2.8612613677978516
Function load_adapters took 2.8846263885498047 ms to run.
current batch size: 5 token used ratio: 0.0165
offload 0 adapters, 4 remains
Function offload_adapters took 0.013589859008789062 ms to run.
current batch size: 4 token used ratio: 0.014275
cost offload scan: 0.08988380432128906
offload 1 adapters, 3 remains
cost offload cat: 0.03504753112792969
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.11157989501953125
Function offload_adapters took 0.5941390991210938 ms to run.
cost offload scan: 0.07939338684082031
offload 1 adapters, 2 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10442733764648438
Function offload_adapters took 0.5564689636230469 ms to run.
cost offload scan: 0.08869171142578125
offload 1 adapters, 1 remains
cost offload cat: 0.03314018249511719
cost offload free mem manager: 0.04696846008300781
cost offload torch.empty: 0.024318695068359375
cost offload a_loc update: 0.10991096496582031
Function offload_adapters took 0.5846023559570312 ms to run.
current batch size: 1 token used ratio: 0.0033916666666666665
cost load scan: 0.008344650268554688
load 1 adapters, 2 in total
Function load_lora_A took 1.2004375457763672 ms to run.
Function load_lora_B took 1.2166500091552734 ms to run.
cost realload: 2.8295516967773438
Function load_adapters took 2.8505325317382812 ms to run.
current batch size: 2 token used ratio: 0.006516666666666666
cost load scan: 0.01049041748046875
load 1 adapters, 3 in total
Function load_lora_A took 1.2030601501464844 ms to run.
Function load_lora_B took 1.2309551239013672 ms to run.
cost realload: 2.845287322998047
Function load_adapters took 2.8672218322753906 ms to run.
Avg tokens(prompt+generate) throughput:  424.874 tokens/s
Avg prompt tokens throughput:            182.589 tokens/s
Avg generate tokens throughput:          242.285 tokens/s
cost load scan: 0.007867813110351562
load 0 adapters, 3 in total
cost realload: 0.28777122497558594
Function load_adapters took 0.31185150146484375 ms to run.
cost load scan: 0.010728836059570312
load 1 adapters, 4 in total
Function load_lora_A took 1.1789798736572266 ms to run.
Function load_lora_B took 1.2159347534179688 ms to run.
cost realload: 2.788543701171875
Function load_adapters took 2.8090476989746094 ms to run.
current batch size: 5 token used ratio: 0.01405
cost offload scan: 0.08535385131835938
offload 1 adapters, 3 remains
cost offload cat: 0.03266334533691406
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10371208190917969
Function offload_adapters took 0.5681514739990234 ms to run.
cost load scan: 0.011920928955078125
load 1 adapters, 4 in total
Function load_lora_A took 1.2083053588867188 ms to run.
Function load_lora_B took 1.2271404266357422 ms to run.
cost realload: 2.8371810913085938
Function load_adapters took 2.858400344848633 ms to run.
cost load scan: 0.009059906005859375
load 0 adapters, 4 in total
cost realload: 0.2872943878173828
INFO:     127.0.0.1:40868 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40876 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40892 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40900 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40912 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40928 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40936 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48876 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48890 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48898 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48904 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48910 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48918 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48922 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48924 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48936 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48944 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48948 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:48950 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51488 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51494 - "POST /generate_stream HTTP/1.1" 200 OK
Function load_adapters took 0.31256675720214844 ms to run.
current batch size: 6 token used ratio: 0.016058333333333334
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.1801719665527344 ms to run.
Function load_lora_B took 1.2621879577636719 ms to run.
cost realload: 2.8319358825683594
Function load_adapters took 2.8524398803710938 ms to run.
current batch size: 7 token used ratio: 0.020766666666666666
offload 0 adapters, 5 remains
Function offload_adapters took 0.013113021850585938 ms to run.
cost load scan: 0.012159347534179688
load 1 adapters, 6 in total
Function load_lora_A took 1.2202262878417969 ms to run.
Function load_lora_B took 1.219034194946289 ms to run.
cost realload: 2.8400421142578125
Function load_adapters took 2.860546112060547 ms to run.
current batch size: 7 token used ratio: 0.021725
cost load scan: 0.008344650268554688
load 1 adapters, 7 in total
Function load_lora_A took 1.1789798736572266 ms to run.
Function load_lora_B took 1.2276172637939453 ms to run.
cost realload: 2.8002262115478516
Function load_adapters took 2.8204917907714844 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 7 in total
cost realload: 0.29468536376953125
Function load_adapters took 0.31828880310058594 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 7 in total
cost realload: 0.2830028533935547
Function load_adapters took 0.30684471130371094 ms to run.
cost load scan: 0.008821487426757812
load 1 adapters, 8 in total
Function load_lora_A took 1.1959075927734375 ms to run.
Function load_lora_B took 1.226663589477539 ms to run.
cost realload: 2.815723419189453
Function load_adapters took 2.8367042541503906 ms to run.
current batch size: 14 token used ratio: 0.039625
offload 0 adapters, 8 remains
Function offload_adapters took 0.012159347534179688 ms to run.
cost offload scan: 0.08487701416015625
offload 1 adapters, 7 remains
cost offload cat: 0.03147125244140625
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10347366333007812
Function offload_adapters took 0.5705356597900391 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 8 in total
Function load_lora_A took 1.2159347534179688 ms to run.
Function load_lora_B took 1.260995864868164 ms to run.
cost realload: 2.8727054595947266
Function load_adapters took 2.893686294555664 ms to run.
offload 0 adapters, 8 remains
Function offload_adapters took 0.01239776611328125 ms to run.
current batch size: 12 token used ratio: 0.034866666666666664
cost load scan: 0.00858306884765625
load 0 adapters, 8 in total
cost realload: 0.30732154846191406
Function load_adapters took 0.3337860107421875 ms to run.
offload 0 adapters, 8 remains
Function offload_adapters took 0.0133514404296875 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 8 in total
cost realload: 0.2808570861816406
Function load_adapters took 0.30517578125 ms to run.
current batch size: 12 token used ratio: 0.03526666666666667
offload 0 adapters, 8 remains
Function offload_adapters took 0.012874603271484375 ms to run.
current batch size: 11 token used ratio: 0.03569166666666666
offload 0 adapters, 8 remains
Function offload_adapters took 0.012159347534179688 ms to run.
offload 0 adapters, 8 remains
Function offload_adapters took 0.014543533325195312 ms to run.
cost offload scan: 0.12373924255371094
offload 2 adapters, 6 remains
cost offload cat: 0.02765655517578125
cost offload free mem manager: 0.04553794860839844
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.11301040649414062
Function offload_adapters took 0.6225109100341797 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 6 in total
cost realload: 0.2827644348144531
Function load_adapters took 0.31113624572753906 ms to run.
current batch size: 8 token used ratio: 0.0255
cost load scan: 0.00858306884765625
load 1 adapters, 7 in total
Function load_lora_A took 1.2023448944091797 ms to run.
Function load_lora_B took 1.2373924255371094 ms to run.
cost realload: 2.8319358825683594
Function load_adapters took 2.8536319732666016 ms to run.
cost offload scan: 0.09083747863769531
offload 1 adapters, 6 remains
cost offload cat: 0.034332275390625
cost offload free mem manager: 0.0457763671875
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.11014938354492188
Function offload_adapters took 0.5948543548583984 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 6 in total
cost realload: 0.2911090850830078
Function load_adapters took 0.3159046173095703 ms to run.
Avg tokens(prompt+generate) throughput:  853.475 tokens/s
Avg prompt tokens throughput:            458.972 tokens/s
Avg generate tokens throughput:          394.504 tokens/s
cost offload scan: 0.08487701416015625
offload 1 adapters, 5 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.5612373352050781 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.011920928955078125 ms to run.
cost offload scan: 0.08630752563476562
offload 1 adapters, 4 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10466575622558594
Function offload_adapters took 0.5667209625244141 ms to run.
current batch size: 6 token used ratio: 0.017066666666666667
offload 0 adapters, 4 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost load scan: 0.010251998901367188
load 1 adapters, 5 in total
Function load_lora_A took 1.1916160583496094 ms to run.
Function load_lora_B took 1.2018680572509766 ms to run.
cost realload: 2.8030872344970703
Function load_adapters took 2.8259754180908203 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 5 in total
cost realload: 0.2796649932861328
Function load_adapters took 0.3039836883544922 ms to run.
current batch size: 7 token used ratio: 0.019283333333333333
offload 0 adapters, 5 remains
Function offload_adapters took 0.011682510375976562 ms to run.
cost offload scan: 0.080108642578125
offload 1 adapters, 4 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10418891906738281
Function offload_adapters took 0.5674362182617188 ms to run.
current batch size: 5 token used ratio: 0.0142
cost load scan: 0.00858306884765625
load 1 adapters, 5 in total
Function load_lora_A took 1.2102127075195312 ms to run.
Function load_lora_B took 1.2023448944091797 ms to run.
cost realload: 2.8336048126220703
Function load_adapters took 2.855062484741211 ms to run.
current batch size: 7 token used ratio: 0.020783333333333334
offload 0 adapters, 5 remains
Function offload_adapters took 0.012636184692382812 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.012874603271484375 ms to run.
current batch size: 5 token used ratio: 0.0162
cost offload scan: 0.08726119995117188
offload 1 adapters, 4 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.029802322387695312
cost offload a_loc update: 0.10347366333007812
Function offload_adapters took 0.5791187286376953 ms to run.
current batch size: 4 token used ratio: 0.013666666666666667
cost offload scan: 0.08344650268554688
offload 1 adapters, 3 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.0476837158203125
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.102996826171875
Function offload_adapters took 0.5648136138916016 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 4 in total
Function load_lora_A took 1.2209415435791016 ms to run.
Function load_lora_B took 1.2443065643310547 ms to run.
cost realload: 2.863645553588867
Function load_adapters took 2.8841495513916016 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 4 in total
INFO:     127.0.0.1:51504 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51508 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51516 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51528 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51544 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51558 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51570 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35448 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35452 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35466 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35474 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35484 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35500 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35512 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35518 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35526 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35532 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35540 - "POST /generate_stream HTTP/1.1" 200 OK
cost realload: 0.2880096435546875
Function load_adapters took 0.35119056701660156 ms to run.
cost offload scan: 0.0820159912109375
offload 1 adapters, 3 remains
cost offload cat: 0.03647804260253906
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.1068115234375
Function offload_adapters took 0.5729198455810547 ms to run.
current batch size: 4 token used ratio: 0.011858333333333334
cost load scan: 0.00858306884765625
load 1 adapters, 4 in total
Function load_lora_A took 1.2097358703613281 ms to run.
Function load_lora_B took 1.2068748474121094 ms to run.
cost realload: 2.8281211853027344
Function load_adapters took 2.849578857421875 ms to run.
current batch size: 5 token used ratio: 0.015608333333333333
cost load scan: 0.008106231689453125
load 0 adapters, 4 in total
cost realload: 0.2818107604980469
Function load_adapters took 0.3056526184082031 ms to run.
offload 0 adapters, 4 remains
Function offload_adapters took 0.012874603271484375 ms to run.
cost offload scan: 0.08344650268554688
offload 1 adapters, 3 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10418891906738281
Function offload_adapters took 0.5648136138916016 ms to run.
current batch size: 4 token used ratio: 0.011416666666666667
current batch size: 4 token used ratio: 0.013083333333333334
Avg tokens(prompt+generate) throughput:  435.685 tokens/s
Avg prompt tokens throughput:            199.672 tokens/s
Avg generate tokens throughput:          236.013 tokens/s
current batch size: 4 token used ratio: 0.01475
cost offload scan: 0.0782012939453125
offload 1 adapters, 2 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10037422180175781
Function offload_adapters took 0.5502700805664062 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 3 in total
Function load_lora_A took 1.2001991271972656 ms to run.
Function load_lora_B took 1.1992454528808594 ms to run.
cost realload: 2.7914047241210938
Function load_adapters took 2.8121471405029297 ms to run.
cost offload scan: 0.07843971252441406
offload 1 adapters, 2 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04863739013671875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10085105895996094
Function offload_adapters took 0.5590915679931641 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 3 in total
Function load_lora_A took 1.2290477752685547 ms to run.
Function load_lora_B took 1.2345314025878906 ms to run.
cost realload: 2.8557777404785156
Function load_adapters took 2.87628173828125 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 3 in total
cost realload: 0.2751350402832031
Function load_adapters took 0.2987384796142578 ms to run.
offload 0 adapters, 3 remains
Function offload_adapters took 0.012636184692382812 ms to run.
current batch size: 4 token used ratio: 0.010308333333333333
current batch size: 4 token used ratio: 0.011975
offload 0 adapters, 3 remains
Function offload_adapters took 0.0133514404296875 ms to run.
current batch size: 3 token used ratio: 0.009175
cost load scan: 0.01049041748046875
load 0 adapters, 3 in total
cost realload: 0.2906322479248047
Function load_adapters took 0.3161430358886719 ms to run.
cost load scan: 0.01049041748046875
load 1 adapters, 4 in total
Function load_lora_A took 1.238107681274414 ms to run.
Function load_lora_B took 1.1973381042480469 ms to run.
cost realload: 2.8388500213623047
Function load_adapters took 2.859354019165039 ms to run.
cost load scan: 0.01239776611328125
load 1 adapters, 5 in total
Function load_lora_A took 1.18255615234375 ms to run.
Function load_lora_B took 1.2497901916503906 ms to run.
cost realload: 2.820253372192383
Function load_adapters took 2.841472625732422 ms to run.
current batch size: 6 token used ratio: 0.016558333333333335
offload 0 adapters, 5 remains
Function offload_adapters took 0.016450881958007812 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 5 in total
cost realload: 0.2913475036621094
Function load_adapters took 0.316619873046875 ms to run.
current batch size: 6 token used ratio: 0.016975
cost load scan: 0.00858306884765625
load 1 adapters, 6 in total
Function load_lora_A took 1.2252330780029297 ms to run.
Function load_lora_B took 1.201629638671875 ms to run.
cost realload: 2.8409957885742188
Function load_adapters took 2.862215042114258 ms to run.
cost offload scan: 0.08225440979003906
offload 1 adapters, 5 remains
cost offload cat: 0.03170967102050781
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.12230873107910156
Function offload_adapters took 0.5834102630615234 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.012874603271484375 ms to run.
cost load scan: 0.011920928955078125
load 1 adapters, 6 in total
Function load_lora_A took 1.1725425720214844 ms to run.
Function load_lora_B took 1.1935234069824219 ms to run.
cost realload: 2.7751922607421875
Function load_adapters took 2.795696258544922 ms to run.
current batch size: 6 token used ratio: 0.015666666666666666
cost load scan: 0.011205673217773438
load 1 adapters, 7 in total
Function load_lora_A took 1.2230873107910156 ms to run.
Function load_lora_B took 1.2054443359375 ms to run.
cost realload: 2.8238296508789062
Function load_adapters took 2.844572067260742 ms to run.
current batch size: 7 token used ratio: 0.020675
cost offload scan: 0.08726119995117188
offload 1 adapters, 6 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10967254638671875
Function offload_adapters took 0.5714893341064453 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.28586387634277344
Function load_adapters took 0.3101825714111328 ms to run.
cost load scan: 0.008344650268554688
load 0 adapters, 6 in total
cost realload: 0.28014183044433594
Function load_adapters took 0.3039836883544922 ms to run.
current batch size: 9 token used ratio: 0.025916666666666668
offload 0 adapters, 6 remains
Function offload_adapters took 0.012636184692382812 ms to run.
Avg tokens(prompt+generate) throughput:  547.788 tokens/s
Avg prompt tokens throughput:            311.368 tokens/s
Avg generate tokens throughput:          236.420 tokens/s
cost offload scan: 0.08702278137207031
offload 1 adapters, 5 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.041484832763671875
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10347366333007812
Function offload_adapters took 0.5667209625244141 ms to run.
current batch size: 7 token used ratio: 0.021608333333333334
offload 0 adapters, 5 remains
Function offload_adapters took 0.012636184692382812 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.012159347534179688 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 5 in total
cost realload: 0.2903938293457031
Function load_adapters took 0.3142356872558594 ms to run.
current batch size: 6 token used ratio: 0.018275
cost offload scan: 0.07963180541992188
offload 1 adapters, 4 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04863739013671875
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10085105895996094
Function offload_adapters took 0.5612373352050781 ms to run.
offload 0 adapters, 4 remains
Function offload_adapters took 0.012159347534179688 ms to run.
current batch size: 4 token used ratio: 0.0122
cost load scan: 0.007867813110351562
load 0 adapters, 4 in total
cost realload: 0.27942657470703125
Function load_adapters took 0.30422210693359375 ms to run.
cost load scan: 0.008344650268554688
load 0 adapters, 4 in total
cost realload: 0.2913475036621094
Function load_adapters took 0.3159046173095703 ms to run.
INFO:     127.0.0.1:35554 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35562 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35568 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38698 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38710 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38722 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38738 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38750 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38762 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38776 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38786 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38802 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38818 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38826 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:38828 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:57040 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:57050 - "POST /generate_stream HTTP/1.1" 200 OK
cost offload scan: 0.08082389831542969
offload 1 adapters, 3 remains
cost offload cat: 0.03147125244140625
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.5965232849121094 ms to run.
current batch size: 5 token used ratio: 0.01495
cost offload scan: 0.07963180541992188
offload 1 adapters, 2 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10085105895996094
Function offload_adapters took 0.5538463592529297 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 2 in total
cost realload: 0.2760887145996094
Function load_adapters took 0.3006458282470703 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 3 in total
Function load_lora_A took 1.2221336364746094 ms to run.
Function load_lora_B took 1.2445449829101562 ms to run.
cost realload: 2.8619766235351562
Function load_adapters took 2.8824806213378906 ms to run.
cost load scan: 0.008821487426757812
load 1 adapters, 4 in total
Function load_lora_A took 1.2004375457763672 ms to run.
Function load_lora_B took 1.238107681274414 ms to run.
cost realload: 2.8243064880371094
Function load_adapters took 2.8460025787353516 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 5 in total
Function load_lora_A took 1.2137889862060547 ms to run.
Function load_lora_B took 1.2712478637695312 ms to run.
cost realload: 2.870798110961914
Function load_adapters took 2.8913021087646484 ms to run.
current batch size: 8 token used ratio: 0.021125
offload 0 adapters, 5 remains
Function offload_adapters took 0.011682510375976562 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 6 in total
Function load_lora_A took 1.1937618255615234 ms to run.
Function load_lora_B took 1.1954307556152344 ms to run.
cost realload: 2.783536911010742
Function load_adapters took 2.803325653076172 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.278472900390625
Function load_adapters took 0.3027915954589844 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.27370452880859375
Function load_adapters took 0.2970695495605469 ms to run.
current batch size: 10 token used ratio: 0.025958333333333333
offload 0 adapters, 6 remains
Function offload_adapters took 0.01430511474609375 ms to run.
current batch size: 9 token used ratio: 0.026333333333333334
offload 0 adapters, 6 remains
Function offload_adapters took 0.013589859008789062 ms to run.
current batch size: 8 token used ratio: 0.026191666666666665
cost load scan: 0.008106231689453125
load 0 adapters, 6 in total
cost realload: 0.2968311309814453
Function load_adapters took 0.3216266632080078 ms to run.
cost offload scan: 0.08130073547363281
offload 1 adapters, 5 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10657310485839844
Function offload_adapters took 0.5583763122558594 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.012159347534179688 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.01239776611328125 ms to run.
current batch size: 6 token used ratio: 0.019625
cost offload scan: 0.12373924255371094
offload 2 adapters, 3 remains
cost offload cat: 0.02574920654296875
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10251998901367188
Function offload_adapters took 0.60272216796875 ms to run.
Avg tokens(prompt+generate) throughput:  575.340 tokens/s
Avg prompt tokens throughput:            256.584 tokens/s
Avg generate tokens throughput:          318.756 tokens/s
current batch size: 4 token used ratio: 0.013875
cost offload scan: 0.0858306884765625
offload 1 adapters, 2 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10204315185546875
Function offload_adapters took 0.5595684051513672 ms to run.
offload 0 adapters, 2 remains
Function offload_adapters took 0.012159347534179688 ms to run.
cost load scan: 0.008821487426757812
load 0 adapters, 2 in total
cost realload: 0.28967857360839844
Function load_adapters took 0.31375885009765625 ms to run.
current batch size: 3 token used ratio: 0.009291666666666667
cost offload scan: 0.07963180541992188
offload 1 adapters, 1 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.11348724365234375
Function offload_adapters took 0.5655288696289062 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 2 in total
Function load_lora_A took 1.216888427734375 ms to run.
Function load_lora_B took 1.1942386627197266 ms to run.
cost realload: 2.828359603881836
Function load_adapters took 2.849102020263672 ms to run.
current batch size: 3 token used ratio: 0.008325
cost load scan: 0.00858306884765625
load 1 adapters, 3 in total
Function load_lora_A took 1.1756420135498047 ms to run.
Function load_lora_B took 1.194000244140625 ms to run.
cost realload: 2.754688262939453
Function load_adapters took 2.7756690979003906 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 4 in total
Function load_lora_A took 1.251220703125 ms to run.
Function load_lora_B took 1.2183189392089844 ms to run.
cost realload: 2.859830856323242
Function load_adapters took 2.8803348541259766 ms to run.
offload 0 adapters, 4 remains
Function offload_adapters took 0.0171661376953125 ms to run.
current batch size: 4 token used ratio: 0.010691666666666667
cost load scan: 0.011205673217773438
load 1 adapters, 5 in total
Function load_lora_A took 1.2242794036865234 ms to run.
Function load_lora_B took 1.1942386627197266 ms to run.
cost realload: 2.8214454650878906
Function load_adapters took 2.8417110443115234 ms to run.
current batch size: 5 token used ratio: 0.014991666666666667
cost load scan: 0.011682510375976562
load 1 adapters, 6 in total
Function load_lora_A took 1.2018680572509766 ms to run.
Function load_lora_B took 1.260995864868164 ms to run.
cost realload: 2.8543472290039062
Function load_adapters took 2.8755664825439453 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 6 in total
cost realload: 0.2739429473876953
Function load_adapters took 0.29730796813964844 ms to run.
current batch size: 7 token used ratio: 0.022033333333333332
cost offload scan: 0.08392333984375
offload 1 adapters, 5 remains
cost offload cat: 0.034809112548828125
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10538101196289062
Function offload_adapters took 0.5772113800048828 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 5 in total
cost realload: 0.2906322479248047
Function load_adapters took 0.316619873046875 ms to run.
current batch size: 7 token used ratio: 0.022825
offload 0 adapters, 5 remains
Function offload_adapters took 0.0133514404296875 ms to run.
cost load scan: 0.008821487426757812
load 1 adapters, 6 in total
Function load_lora_A took 1.2097358703613281 ms to run.
Function load_lora_B took 1.1930465698242188 ms to run.
cost realload: 2.821683883666992
Function load_adapters took 2.8438568115234375 ms to run.
current batch size: 7 token used ratio: 0.023708333333333335
cost offload scan: 0.08702278137207031
offload 1 adapters, 5 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.02193450927734375
cost offload a_loc update: 0.10514259338378906
Function offload_adapters took 0.5710124969482422 ms to run.
cost offload scan: 0.08320808410644531
offload 1 adapters, 4 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022649765014648438
INFO:     127.0.0.1:57064 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:57074 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:57088 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:57096 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:57102 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:57116 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:57128 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:57144 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:57158 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43158 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43162 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43178 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43188 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43198 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43206 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:43208 - "POST /generate_stream HTTP/1.1" 200 OK
cost offload a_loc update: 0.10442733764648438
Function offload_adapters took 0.5941390991210938 ms to run.
cost offload scan: 0.08034706115722656
offload 1 adapters, 3 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10347366333007812
Function offload_adapters took 0.5605220794677734 ms to run.
current batch size: 4 token used ratio: 0.013183333333333333
cost offload scan: 0.07891654968261719
offload 1 adapters, 2 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.5519390106201172 ms to run.
offload 0 adapters, 2 remains
Function offload_adapters took 0.011920928955078125 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 2 in total
cost realload: 0.29206275939941406
Function load_adapters took 0.3161430358886719 ms to run.
current batch size: 3 token used ratio: 0.008475
Avg tokens(prompt+generate) throughput:  470.148 tokens/s
Avg prompt tokens throughput:            255.372 tokens/s
Avg generate tokens throughput:          214.776 tokens/s
cost load scan: 0.00858306884765625
load 1 adapters, 3 in total
Function load_lora_A took 1.2159347534179688 ms to run.
Function load_lora_B took 1.2331008911132812 ms to run.
cost realload: 2.8569698333740234
Function load_adapters took 2.8777122497558594 ms to run.
current batch size: 4 token used ratio: 0.011816666666666666
cost load scan: 0.008344650268554688
load 0 adapters, 3 in total
cost realload: 0.2846717834472656
Function load_adapters took 0.3085136413574219 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 3 in total
cost realload: 0.27871131896972656
Function load_adapters took 0.3025531768798828 ms to run.
offload 0 adapters, 3 remains
Function offload_adapters took 0.01239776611328125 ms to run.
current batch size: 5 token used ratio: 0.014233333333333334
offload 0 adapters, 3 remains
Function offload_adapters took 0.013589859008789062 ms to run.
current batch size: 4 token used ratio: 0.011925
cost load scan: 0.008821487426757812
load 1 adapters, 4 in total
Function load_lora_A took 1.1529922485351562 ms to run.
Function load_lora_B took 1.211404800415039 ms to run.
cost realload: 2.758502960205078
Function load_adapters took 2.7811527252197266 ms to run.
cost offload scan: 0.08487701416015625
offload 1 adapters, 3 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10013580322265625
Function offload_adapters took 0.5550384521484375 ms to run.
current batch size: 4 token used ratio: 0.012566666666666667
cost load scan: 0.008106231689453125
load 1 adapters, 4 in total
Function load_lora_A took 1.2164115905761719 ms to run.
Function load_lora_B took 1.1887550354003906 ms to run.
cost realload: 2.7923583984375
Function load_adapters took 2.8133392333984375 ms to run.
cost load scan: 0.008821487426757812
load 1 adapters, 5 in total
Function load_lora_A took 1.1899471282958984 ms to run.
Function load_lora_B took 1.2462139129638672 ms to run.
cost realload: 2.828836441040039
Function load_adapters took 2.850055694580078 ms to run.
cost load scan: 0.009059906005859375
load 1 adapters, 6 in total
Function load_lora_A took 1.2178421020507812 ms to run.
Function load_lora_B took 1.2047290802001953 ms to run.
cost realload: 2.8204917907714844
Function load_adapters took 2.840280532836914 ms to run.
current batch size: 8 token used ratio: 0.022775
offload 0 adapters, 6 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.2841949462890625
Function load_adapters took 0.3085136413574219 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.01239776611328125 ms to run.
current batch size: 7 token used ratio: 0.020275
cost offload scan: 0.08678436279296875
offload 1 adapters, 5 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10418891906738281
Function offload_adapters took 0.5748271942138672 ms to run.
current batch size: 6 token used ratio: 0.018725
offload 0 adapters, 5 remains
Function offload_adapters took 0.013828277587890625 ms to run.
current batch size: 5 token used ratio: 0.016966666666666668
cost load scan: 0.011444091796875
load 1 adapters, 6 in total
Function load_lora_A took 1.1792182922363281 ms to run.
Function load_lora_B took 1.2280941009521484 ms to run.
cost realload: 2.8150081634521484
Function load_adapters took 2.8357505798339844 ms to run.
cost offload scan: 0.08463859558105469
offload 1 adapters, 5 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.1049041748046875
Function offload_adapters took 0.5741119384765625 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 6 in total
Function load_lora_A took 1.2049674987792969 ms to run.
Function load_lora_B took 1.2238025665283203 ms to run.
cost realload: 2.8171539306640625
Function load_adapters took 2.8388500213623047 ms to run.
cost offload scan: 0.08153915405273438
offload 1 adapters, 5 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.028133392333984375
cost offload a_loc update: 0.10275840759277344
Function offload_adapters took 0.5631446838378906 ms to run.
current batch size: 5 token used ratio: 0.01565
cost load scan: 0.008821487426757812
load 1 adapters, 6 in total
Function load_lora_A took 1.2042522430419922 ms to run.
Function load_lora_B took 1.2309551239013672 ms to run.
cost realload: 2.8221607208251953
Function load_adapters took 2.8429031372070312 ms to run.
cost offload scan: 0.08106231689453125
offload 1 adapters, 5 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.04124641418457031
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10156631469726562
Function offload_adapters took 0.5533695220947266 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 6 in total
Function load_lora_A took 1.2123584747314453 ms to run.
Function load_lora_B took 1.2187957763671875 ms to run.
cost realload: 2.8209686279296875
Function load_adapters took 2.842426300048828 ms to run.
cost offload scan: 0.08153915405273438
offload 1 adapters, 5 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10371208190917969
Function offload_adapters took 0.5555152893066406 ms to run.
Avg tokens(prompt+generate) throughput:  565.727 tokens/s
Avg prompt tokens throughput:            316.847 tokens/s
Avg generate tokens throughput:          248.880 tokens/s
current batch size: 5 token used ratio: 0.0136
cost offload scan: 0.07843971252441406
offload 1 adapters, 4 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.027418136596679688
cost offload a_loc update: 0.09942054748535156
Function offload_adapters took 0.5567073822021484 ms to run.
current batch size: 4 token used ratio: 0.011108333333333333
cost load scan: 0.00762939453125
load 0 adapters, 4 in total
cost realload: 0.286102294921875
Function load_adapters took 0.3097057342529297 ms to run.
current batch size: 5 token used ratio: 0.015316666666666666
cost load scan: 0.008344650268554688
load 1 adapters, 5 in total
Function load_lora_A took 1.1985301971435547 ms to run.
Function load_lora_B took 1.1751651763916016 ms to run.
cost realload: 2.761363983154297
Function load_adapters took 2.783060073852539 ms to run.
current batch size: 6 token used ratio: 0.01925
offload 0 adapters, 5 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost offload scan:INFO:     127.0.0.1:43224 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39968 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39984 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39992 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40002 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40014 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40026 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40032 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:60678 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:60688 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:60704 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:60714 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:60716 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:60726 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:60738 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:60740 - "POST /generate_stream HTTP/1.1" 200 OK
 0.08106231689453125
offload 1 adapters, 4 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.04172325134277344
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.102996826171875
Function offload_adapters took 0.5848407745361328 ms to run.
cost offload scan: 0.07963180541992188
offload 1 adapters, 3 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10037422180175781
Function offload_adapters took 0.5555152893066406 ms to run.
cost offload scan: 0.07915496826171875
offload 1 adapters, 2 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10204315185546875
Function offload_adapters took 0.5476474761962891 ms to run.
cost load scan: 0.013113021850585938
load 0 adapters, 2 in total
cost realload: 0.29087066650390625
Function load_adapters took 0.31447410583496094 ms to run.
current batch size: 3 token used ratio: 0.007658333333333333
cost load scan: 0.00858306884765625
load 1 adapters, 3 in total
Function load_lora_A took 1.191854476928711 ms to run.
Function load_lora_B took 1.2083053588867188 ms to run.
cost realload: 2.7930736541748047
Function load_adapters took 2.814054489135742 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 4 in total
Function load_lora_A took 1.1944770812988281 ms to run.
Function load_lora_B took 1.203775405883789 ms to run.
cost realload: 2.785921096801758
Function load_adapters took 2.8066635131835938 ms to run.
cost load scan: 0.008821487426757812
load 1 adapters, 5 in total
Function load_lora_A took 1.2195110321044922 ms to run.
Function load_lora_B took 1.2173652648925781 ms to run.
cost realload: 2.835988998413086
Function load_adapters took 2.856731414794922 ms to run.
current batch size: 6 token used ratio: 0.015108333333333333
cost load scan: 0.008106231689453125
load 1 adapters, 6 in total
Function load_lora_A took 1.2066364288330078 ms to run.
Function load_lora_B took 1.215219497680664 ms to run.
cost realload: 2.811908721923828
Function load_adapters took 2.8328895568847656 ms to run.
current batch size: 7 token used ratio: 0.019925
cost load scan: 0.00858306884765625
load 0 adapters, 6 in total
cost realload: 0.30684471130371094
Function load_adapters took 0.3325939178466797 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.019311904907226562 ms to run.
current batch size: 7 token used ratio: 0.020558333333333335
cost offload scan: 0.08463859558105469
offload 1 adapters, 5 remains
cost offload cat: 0.03719329833984375
cost offload free mem manager: 0.0438690185546875
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.1201629638671875
Function offload_adapters took 0.5905628204345703 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 5 in total
cost realload: 0.2892017364501953
Function load_adapters took 0.3139972686767578 ms to run.
current batch size: 7 token used ratio: 0.021725
cost offload scan: 0.08034706115722656
offload 1 adapters, 4 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10395050048828125
Function offload_adapters took 0.5586147308349609 ms to run.
cost offload scan: 0.08034706115722656
offload 1 adapters, 3 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.5631446838378906 ms to run.
cost offload scan: 0.08535385131835938
offload 1 adapters, 2 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10371208190917969
Function offload_adapters took 0.5729198455810547 ms to run.
current batch size: 4 token used ratio: 0.0132
Avg tokens(prompt+generate) throughput:  471.405 tokens/s
Avg prompt tokens throughput:            215.374 tokens/s
Avg generate tokens throughput:          256.031 tokens/s
offload 0 adapters, 2 remains
Function offload_adapters took 0.013589859008789062 ms to run.
cost offload scan: 0.0782012939453125
offload 1 adapters, 1 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10204315185546875
Function offload_adapters took 0.5536079406738281 ms to run.
current batch size: 2 token used ratio: 0.006675
current batch size: 2 token used ratio: 0.007508333333333333
offload 0 adapters, 1 remains
Function offload_adapters took 0.012636184692382812 ms to run.
offload 1 adapters, 0 remains
Function offload_adapters took 0.08845329284667969 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.010967254638671875 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 1 in total
Function load_lora_A took 1.2180805206298828 ms to run.
Function load_lora_B took 1.1982917785644531 ms to run.
cost realload: 2.830982208251953
Function load_adapters took 2.852916717529297 ms to run.
current batch size: 1 token used ratio: 0.00215
current batch size: 1 token used ratio: 0.0025666666666666667
current batch size: 1 token used ratio: 0.0029833333333333335
current batch size: 1 token used ratio: 0.0034
cost load scan: 0.008344650268554688
load 1 adapters, 2 in total
Function load_lora_A took 1.1959075927734375 ms to run.
Function load_lora_B took 1.2240409851074219 ms to run.
cost realload: 2.838611602783203
Function load_adapters took 2.859354019165039 ms to run.
cost offload scan: 0.08392333984375
offload 1 adapters, 1 remains
cost offload cat: 0.03266334533691406
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10418891906738281
Function offload_adapters took 0.5586147308349609 ms to run.
current batch size: 1 token used ratio: 0.001975
cost load scan: 0.011682510375976562
load 1 adapters, 2 in total
Function load_lora_A took 1.1830329895019531 ms to run.
Function load_lora_B took 1.2576580047607422 ms to run.
cost realload: 2.8285980224609375
Function load_adapters took 2.8498172760009766 ms to run.
current batch size: 2 token used ratio: 0.004566666666666667
cost load scan: 0.00762939453125
load 0 adapters, 2 in total
cost realload: 0.2956390380859375
Function load_adapters took 0.3199577331542969 ms to run.
current batch size: 3 token used ratio: 0.0075
Avg tokens(prompt+generate) throughput:  170.993 tokens/s
Avg prompt tokens throughput:             91.543 tokens/s
Avg generate tokens throughput:           79.451 tokens/s
current batch size: 3 token used ratio: 0.00875
cost load scan: 0.007867813110351562
load 0 adapters, 2 in total
cost realload: 0.2841949462890625
Function load_adapters took 0.3082752227783203 ms to run.
offload 0 adapters, 2 remains
Function offload_adapters took 0.012874603271484375 ms to run.
current batch size: 3 token used ratio: 0.008925
cost load scan: 0.011920928955078125
load 1 adapters, 3 in total
Function load_lora_A took 1.1928081512451172 ms to run.
Function load_lora_B took 1.1873245239257812 ms to run.
cost realload: 2.7790069580078125
Function load_adapters took 2.7992725372314453 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 4 in total
Function load_lora_A took 1.1723041534423828 ms to run.
Function load_lora_B took 1.2526512145996094 ms to run.
cost realload: 2.8100013732910156
Function load_adapters took 2.8307437896728516 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 5 in total
Function load_lora_A took 1.186370849609375 ms to run.
Function load_lora_B took 1.2531280517578125 ms to run.
cost realload: 2.8257369995117188
Function load_adapters took 2.8471946716308594 ms to run.
current batch size: 6 token used ratio: 0.016541666666666666
cost load scan: 0.011444091796875
load 1 adapters, 6 in total
INFO:     127.0.0.1:60756 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49626 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49630 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49644 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49660 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49674 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49682 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49698 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49712 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49714 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49724 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49730 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49746 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49756 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49770 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49774 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49778 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49788 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55326 - "POST /generate_stream HTTP/1.1" 200 OK
Function load_lora_A took 1.1851787567138672 ms to run.
Function load_lora_B took 1.2395381927490234 ms to run.
cost realload: 2.8443336486816406
Function load_adapters took 2.8655529022216797 ms to run.
cost offload scan: 0.0858306884765625
offload 1 adapters, 5 remains
cost offload cat: 0.031948089599609375
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10395050048828125
Function offload_adapters took 0.5671977996826172 ms to run.
current batch size: 6 token used ratio: 0.017233333333333333
offload 0 adapters, 5 remains
Function offload_adapters took 0.012636184692382812 ms to run.
cost load scan: 0.008344650268554688
load 0 adapters, 5 in total
cost realload: 0.2827644348144531
Function load_adapters took 0.30732154846191406 ms to run.
current batch size: 6 token used ratio: 0.017441666666666668
cost load scan: 0.008344650268554688
load 0 adapters, 5 in total
cost realload: 0.2799034118652344
Function load_adapters took 0.3039836883544922 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 6 in total
Function load_lora_A took 1.2278556823730469 ms to run.
Function load_lora_B took 1.2726783752441406 ms to run.
cost realload: 2.893209457397461
Function load_adapters took 2.913951873779297 ms to run.
current batch size: 8 token used ratio: 0.024166666666666666
offload 0 adapters, 6 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 7 in total
Function load_lora_A took 1.2333393096923828 ms to run.
Function load_lora_B took 1.207113265991211 ms to run.
cost realload: 2.8259754180908203
Function load_adapters took 2.8467178344726562 ms to run.
cost offload scan: 0.08559226989746094
offload 1 adapters, 6 remains
cost offload cat: 0.03266334533691406
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.11420249938964844
Function offload_adapters took 0.5812644958496094 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.27823448181152344
Function load_adapters took 0.30303001403808594 ms to run.
current batch size: 8 token used ratio: 0.022758333333333332
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.2856254577636719
Function load_adapters took 0.3116130828857422 ms to run.
cost offload scan: 0.08130073547363281
offload 1 adapters, 5 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.1049041748046875
Function offload_adapters took 0.5595684051513672 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 6 in total
Function load_lora_A took 1.1928081512451172 ms to run.
Function load_lora_B took 1.2483596801757812 ms to run.
cost realload: 2.824068069458008
Function load_adapters took 2.8450489044189453 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.012636184692382812 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 7 in total
Function load_lora_A took 1.2187957763671875 ms to run.
Function load_lora_B took 1.2013912200927734 ms to run.
cost realload: 2.8018951416015625
Function load_adapters took 2.8238296508789062 ms to run.
current batch size: 9 token used ratio: 0.024916666666666667
offload 0 adapters, 7 remains
Function offload_adapters took 0.012159347534179688 ms to run.
cost load scan: 0.008821487426757812
load 1 adapters, 8 in total
Function load_lora_A took 1.1806488037109375 ms to run.
Function load_lora_B took 1.22833251953125 ms to run.
cost realload: 2.7992725372314453
Function load_adapters took 2.8197765350341797 ms to run.
current batch size: 9 token used ratio: 0.026616666666666667
cost load scan: 0.008344650268554688
load 0 adapters, 8 in total
cost realload: 0.2846717834472656
Function load_adapters took 0.30922889709472656 ms to run.
offload 0 adapters, 8 remains
Function offload_adapters took 0.012636184692382812 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 8 in total
cost realload: 0.2694129943847656
Function load_adapters took 0.2932548522949219 ms to run.
Avg tokens(prompt+generate) throughput:  690.411 tokens/s
Avg prompt tokens throughput:            390.085 tokens/s
Avg generate tokens throughput:          300.326 tokens/s
current batch size: 10 token used ratio: 0.031058333333333334
cost offload scan: 0.08153915405273438
offload 1 adapters, 7 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.021696090698242188
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.5559921264648438 ms to run.
cost offload scan: 0.08249282836914062
offload 1 adapters, 6 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10895729064941406
Function offload_adapters took 0.5624294281005859 ms to run.
cost load scan: 0.013828277587890625
load 1 adapters, 7 in total
Function load_lora_A took 1.2328624725341797 ms to run.
Function load_lora_B took 1.2059211730957031 ms to run.
cost realload: 2.830028533935547
Function load_adapters took 2.850770950317383 ms to run.
current batch size: 9 token used ratio: 0.029025
cost load scan: 0.007867813110351562
load 0 adapters, 7 in total
cost realload: 0.2796649932861328
Function load_adapters took 0.3037452697753906 ms to run.
cost offload scan: 0.08249282836914062
offload 1 adapters, 6 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.02193450927734375
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.5564689636230469 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost offload scan: 0.080108642578125
offload 1 adapters, 5 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04172325134277344
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.09989738464355469
Function offload_adapters took 0.5519390106201172 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 5 in total
cost realload: 0.27632713317871094
Function load_adapters took 0.3020763397216797 ms to run.
current batch size: 8 token used ratio: 0.02515
offload 0 adapters, 5 remains
Function offload_adapters took 0.011920928955078125 ms to run.
cost offload scan: 0.08130073547363281
offload 1 adapters, 4 remains
cost offload cat: 0.029325485229492188
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.02193450927734375
cost offload a_loc update: 0.10037422180175781
Function offload_adapters took 0.5590915679931641 ms to run.
offload 0 adapters, 4 remains
Function offload_adapters took 0.012874603271484375 ms to run.
current batch size: 5 token used ratio: 0.015816666666666666
cost load scan: 0.007867813110351562
load 0 adapters, 4 in total
cost realload: 0.2808570861816406
Function load_adapters took 0.30517578125 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 5 in total
Function load_lora_A took 1.188039779663086 ms to run.
Function load_lora_B took 1.2149810791015625 ms to run.
cost realload: 2.7878284454345703
Function load_adapters took 2.8090476989746094 ms to run.
cost load scan: 0.010967254638671875
load 1 adapters, 6 in total
Function load_lora_A took 1.2052059173583984 ms to run.
Function load_lora_B took 1.2116432189941406 ms to run.
cost realload: 2.808809280395508
Function load_adapters took 2.830982208251953 ms to run.
current batch size: 9 token used ratio: 0.0268
offload 0 adapters, 6 remains
Function offload_adapters took 0.012636184692382812 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.2899169921875
Function load_adapters took 0.3147125244140625 ms to run.
cost offload scan: 0.08082389831542969
offload 1 adapters, 5 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: INFO:     127.0.0.1:55332 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55338 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55346 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55358 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55374 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55384 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55390 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55394 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55408 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55420 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55432 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55448 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55458 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55466 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55482 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:55496 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42412 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42422 - "POST /generate_stream HTTP/1.1" 200 OK
0.04315376281738281
cost offload torch.empty: 0.024080276489257812
cost offload a_loc update: 0.1049041748046875
Function offload_adapters took 0.598907470703125 ms to run.
current batch size: 8 token used ratio: 0.023725
cost load scan: 0.00858306884765625
load 1 adapters, 6 in total
Function load_lora_A took 1.172780990600586 ms to run.
Function load_lora_B took 1.2369155883789062 ms to run.
cost realload: 2.8047561645507812
Function load_adapters took 2.8259754180908203 ms to run.
cost offload scan: 0.08845329284667969
offload 1 adapters, 5 remains
cost offload cat: 0.0362396240234375
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.11777877807617188
Function offload_adapters took 0.6077289581298828 ms to run.
cost load scan: 0.008821487426757812
load 1 adapters, 6 in total
Function load_lora_A took 1.1763572692871094 ms to run.
Function load_lora_B took 1.2183189392089844 ms to run.
cost realload: 2.803802490234375
Function load_adapters took 2.8252601623535156 ms to run.
current batch size: 9 token used ratio: 0.02739166666666667
cost load scan: 0.00858306884765625
load 1 adapters, 7 in total
Function load_lora_A took 1.1661052703857422 ms to run.
Function load_lora_B took 1.2357234954833984 ms to run.
cost realload: 2.794981002807617
Function load_adapters took 2.8166770935058594 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 7 in total
cost realload: 0.2789497375488281
Function load_adapters took 0.3058910369873047 ms to run.
offload 0 adapters, 7 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 7 in total
cost realload: 0.2765655517578125
Function load_adapters took 0.3006458282470703 ms to run.
offload 0 adapters, 7 remains
Function offload_adapters took 0.013589859008789062 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 7 in total
cost realload: 0.28014183044433594
Function load_adapters took 0.3037452697753906 ms to run.
current batch size: 12 token used ratio: 0.03411666666666666
cost load scan: 0.00858306884765625
load 1 adapters, 8 in total
Function load_lora_A took 1.207590103149414 ms to run.
Function load_lora_B took 1.1878013610839844 ms to run.
cost realload: 2.785921096801758
Function load_adapters took 2.8061866760253906 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 8 in total
cost realload: 0.2803802490234375
Function load_adapters took 0.3046989440917969 ms to run.
offload 0 adapters, 8 remains
Function offload_adapters took 0.012159347534179688 ms to run.
current batch size: 13 token used ratio: 0.03958333333333333
cost offload scan: 0.08440017700195312
offload 1 adapters, 7 remains
cost offload cat: 0.03314018249511719
cost offload free mem manager: 0.0514984130859375
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.11181831359863281
Function offload_adapters took 0.5922317504882812 ms to run.
offload 0 adapters, 7 remains
Function offload_adapters took 0.011920928955078125 ms to run.
current batch size: 10 token used ratio: 0.03211666666666667
cost load scan: 0.007867813110351562
load 0 adapters, 7 in total
cost realload: 0.29778480529785156
Function load_adapters took 0.3218650817871094 ms to run.
Avg tokens(prompt+generate) throughput:  871.790 tokens/s
Avg prompt tokens throughput:            458.511 tokens/s
Avg generate tokens throughput:          413.279 tokens/s
offload 0 adapters, 7 remains
Function offload_adapters took 0.012636184692382812 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 7 in total
cost realload: 0.2818107604980469
Function load_adapters took 0.3058910369873047 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 7 in total
cost realload: 0.2789497375488281
Function load_adapters took 0.30350685119628906 ms to run.
offload 0 adapters, 7 remains
Function offload_adapters took 0.01239776611328125 ms to run.
current batch size: 11 token used ratio: 0.034725
cost offload scan: 0.08249282836914062
offload 1 adapters, 6 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.02193450927734375
cost offload a_loc update: 0.10561943054199219
Function offload_adapters took 0.5695819854736328 ms to run.
cost load scan: 0.009775161743164062
load 1 adapters, 7 in total
Function load_lora_A took 1.2161731719970703 ms to run.
Function load_lora_B took 1.2235641479492188 ms to run.
cost realload: 2.834796905517578
Function load_adapters took 2.8557777404785156 ms to run.
offload 0 adapters, 7 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost load scan: 0.008344650268554688
load 0 adapters, 7 in total
cost realload: 0.2753734588623047
Function load_adapters took 0.2994537353515625 ms to run.
current batch size: 11 token used ratio: 0.034925
cost offload scan: 0.08225440979003906
offload 1 adapters, 6 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10275840759277344
Function offload_adapters took 0.5574226379394531 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.012159347534179688 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 6 in total
cost realload: 0.28228759765625
Function load_adapters took 0.3066062927246094 ms to run.
cost offload scan: 0.08153915405273438
offload 1 adapters, 5 remains
cost offload cat: 0.02956390380859375
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.110626220703125
Function offload_adapters took 0.5660057067871094 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.01239776611328125 ms to run.
current batch size: 7 token used ratio: 0.020433333333333335
cost offload scan: 0.0820159912109375
offload 1 adapters, 4 remains
cost offload cat: 0.03409385681152344
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10418891906738281
Function offload_adapters took 0.5743503570556641 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.1904239654541016 ms to run.
Function load_lora_B took 1.2340545654296875 ms to run.
cost realload: 2.8345584869384766
Function load_adapters took 2.857208251953125 ms to run.
current batch size: 7 token used ratio: 0.02075
cost offload scan: 0.08940696716308594
offload 1 adapters, 4 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.102996826171875
Function offload_adapters took 0.5702972412109375 ms to run.
current batch size: 6 token used ratio: 0.019466666666666667
offload 0 adapters, 4 remains
Function offload_adapters took 0.012874603271484375 ms to run.
cost offload scan: 0.08058547973632812
offload 1 adapters, 3 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.04863739013671875
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.5619525909423828 ms to run.
cost load scan: 0.008821487426757812
load 1 adapters, 4 in total
Function load_lora_A took 1.2176036834716797 ms to run.
Function load_lora_B took 1.2164115905761719 ms to run.
cost realload: 2.8257369995117188
Function load_adapters took 2.846956253051758 ms to run.
cost load scan: 0.008344650268554688
load 0 adapters, 4 in total
cost realload: 0.29587745666503906
Function load_adapters took 0.32210350036621094 ms to run.
current batch size: 6 token used ratio: 0.01785
offload 0 adapters, 4 remains
Function offload_adapters took 0.01239776611328125 ms to run.
current batch size: 5 token used ratio: 0.016
cost offload scan: 0.08535385131835938
offload 1 adapters, 3 remains
cost offload cat: 0.03147125244140625
cost offload free mem manager: INFO:     127.0.0.1:42428 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42434 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42446 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42456 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42458 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42474 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42478 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42488 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42502 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42508 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42516 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42530 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42544 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42548 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42560 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42562 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42576 - "POST /generate_stream HTTP/1.1" 200 OK
For some LLaMA-based models, initializing the fast tokenizer may take a long time. To eliminate the initialization time, consider using 'hf-internal-testing/llama-tokenizer' instead of the original tokenizer.
llama-7b: 12.06 GB
peak working mem for (bs=20, seqlen=512): 0.70 GB
peak working mem for (bs=100, seqlen=512): 3.52 GB
all adapters (11) estimated size: 0.17 GB
avg adapter estimated size: 16.00 MB
INFO:     127.0.0.1:46296 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46298 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46304 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46308 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46316 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58074 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58078 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58086 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58090 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58094 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58104 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58118 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58120 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58122 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35032 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35038 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35052 - "POST /generate_stream HTTP/1.1" 200 OK
cost load scan: 0.012159347534179688
load 1 adapters, 1 in total
Function load_lora_A took 1.3325214385986328 ms to run.
Function load_lora_B took 1.2667179107666016 ms to run.
cost realload: 6.96873664855957
Function load_adapters took 6.99925422668457 ms to run.
Avg tokens(prompt+generate) throughput:   10.302 tokens/s
Avg prompt tokens throughput:             10.302 tokens/s
Avg generate tokens throughput:            0.000 tokens/s
cost load scan: 0.0095367431640625
load 2 adapters, 3 in total
Function load_lora_A took 1.1949539184570312 ms to run.
Function load_lora_B took 1.249551773071289 ms to run.
Function load_lora_A took 1.1889934539794922 ms to run.
Function load_lora_B took 1.230478286743164 ms to run.
cost realload: 5.404949188232422
Function load_adapters took 5.427837371826172 ms to run.
current batch size: 3 token used ratio: 0.00665
cost load scan: 0.008821487426757812
load 1 adapters, 4 in total
Function load_lora_A took 1.1861324310302734 ms to run.
Function load_lora_B took 1.2030601501464844 ms to run.
cost realload: 2.802133560180664
Function load_adapters took 2.824544906616211 ms to run.
current batch size: 4 token used ratio: 0.0101
cost load scan: 0.008821487426757812
load 1 adapters, 5 in total
Function load_lora_A took 1.196146011352539 ms to run.
Function load_lora_B took 1.2063980102539062 ms to run.
cost realload: 2.798318862915039
Function load_adapters took 2.8204917907714844 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 5 in total
cost realload: 0.2911090850830078
Function load_adapters took 0.3151893615722656 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 6 in total
Function load_lora_A took 1.203775405883789 ms to run.
Function load_lora_B took 1.1973381042480469 ms to run.
cost realload: 2.7930736541748047
Function load_adapters took 2.815723419189453 ms to run.
current batch size: 7 token used ratio: 0.018333333333333333
current batch size: 7 token used ratio: 0.02125
cost offload scan: 0.15807151794433594
offload 1 adapters, 5 remains
cost offload cat: 0.04029273986816406
cost offload free mem manager: 0.049114227294921875
cost offload torch.empty: 0.02384185791015625
cost offload a_loc update: 12.477397918701172
Function offload_adapters took 13.111114501953125 ms to run.
current batch size: 6 token used ratio: 0.019941666666666667
cost offload scan: 0.08440017700195312
offload 1 adapters, 4 remains
cost offload cat: 0.03147125244140625
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.5636215209960938 ms to run.
cost offload scan: 0.08702278137207031
offload 1 adapters, 3 remains
cost offload cat: 0.03218650817871094
cost offload free mem manager: 0.05269050598144531
cost offload torch.empty: 0.023603439331054688
cost offload a_loc update: 0.10514259338378906
Function offload_adapters took 0.5865097045898438 ms to run.
cost offload scan: 0.080108642578125
offload 1 adapters, 2 remains
cost offload cat: 0.02956390380859375
cost offload free mem manager: 0.041484832763671875
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.09989738464355469
Function offload_adapters took 0.5490779876708984 ms to run.
current batch size: 3 token used ratio: 0.010416666666666666
cost load scan: 0.00858306884765625
load 1 adapters, 3 in total
Function load_lora_A took 1.2221336364746094 ms to run.
Function load_lora_B took 1.2099742889404297 ms to run.
cost realload: 2.8464794158935547
Function load_adapters took 2.8679370880126953 ms to run.
current batch size: 4 token used ratio: 0.01405
offload 0 adapters, 3 remains
Function offload_adapters took 0.013113021850585938 ms to run.
cost offload scan: 0.080108642578125
offload 1 adapters, 2 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04172325134277344
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10204315185546875
Function offload_adapters took 0.5495548248291016 ms to run.
cost offload scan: 0.07796287536621094
offload 1 adapters, 1 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10752677917480469
Function offload_adapters took 0.5474090576171875 ms to run.
current batch size: 1 token used ratio: 0.002825
cost load scan: 0.007867813110351562
load 1 adapters, 2 in total
Function load_lora_A took 1.2133121490478516 ms to run.
Function load_lora_B took 1.2135505676269531 ms to run.
cost realload: 2.822399139404297
Function load_adapters took 2.8433799743652344 ms to run.
current batch size: 2 token used ratio: 0.0057666666666666665
Avg tokens(prompt+generate) throughput:  380.562 tokens/s
Avg prompt tokens throughput:            198.076 tokens/s
Avg generate tokens throughput:          182.486 tokens/s
current batch size: 2 token used ratio: 0.0066
cost load scan: 0.013113021850585938
load 1 adapters, 3 in total
Function load_lora_A took 1.2145042419433594 ms to run.
Function load_lora_B took 1.1844635009765625 ms to run.
cost realload: 2.813577651977539
Function load_adapters took 2.8383731842041016 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 4 in total
Function load_lora_A took 1.1935234069824219 ms to run.
Function load_lora_B took 1.22833251953125 ms to run.
cost realload: 2.808094024658203
Function load_adapters took 2.830028533935547 ms to run.
cost load scan: 0.009775161743164062
load 1 adapters, 5 in total
Function load_lora_A took 1.2111663818359375 ms to run.
Function load_lora_B took 1.2090206146240234 ms to run.
cost realload: 2.8083324432373047
Function load_adapters took 2.8285980224609375 ms to run.
cost offload scan: 0.08273124694824219
offload 1 adapters, 4 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.04553794860839844
cost offload torch.empty: 0.023603439331054688
cost offload a_loc update: 0.11372566223144531
Function offload_adapters took 0.5900859832763672 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 5 in total
Function load_lora_A took 1.1792182922363281 ms to run.
Function load_lora_B took 1.2271404266357422 ms to run.
cost realload: 2.814769744873047
Function load_adapters took 2.8357505798339844 ms to run.
current batch size: 5 token used ratio: 0.011708333333333333
cost load scan: 0.017642974853515625
load 1 adapters, 6 in total
Function load_lora_A took 1.2204647064208984 ms to run.
Function load_lora_B took 1.2102127075195312 ms to run.
cost realload: 2.8312206268310547
Function load_adapters took 2.8526782989501953 ms to run.
current batch size: 6 token used ratio: 0.016
cost load scan: 0.007867813110351562
load 1 adapters, 7 in total
Function load_lora_A took 1.1968612670898438 ms to run.
Function load_lora_B took 1.2392997741699219 ms to run.
cost realload: 2.8197765350341797
Function load_adapters took 2.8405189514160156 ms to run.
cost offload scan: 0.08034706115722656
offload 1 adapters, 6 remains
cost offload cat: 0.03409385681152344
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.5657672882080078 ms to run.
current batch size: 6 token used ratio: 0.016758333333333333
cost load scan: 0.008106231689453125
load 0 adapters, 6 in total
cost realload: 0.31828880310058594
Function load_adapters took 0.3447532653808594 ms to run.
current batch size: 7 token used ratio: 0.021175
cost load scan: 0.00858306884765625
load 1 adapters, 7 in total
Function load_lora_A took 1.157522201538086 ms to run.
Function load_lora_B took 1.2233257293701172 ms to run.
cost realload: 2.7806758880615234
Function load_adapters took 2.801179885864258 ms to run.
cost offload scan: 0.08535385131835938
offload 1 adapters, 6 remains
cost offload cat: 0.03314018249511719
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.5784034729003906 ms to run.
cost offload scan: INFO:     127.0.0.1:35064 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35072 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35080 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35086 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35102 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:35118 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59776 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59788 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59796 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59812 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59822 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59838 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59852 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59858 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59874 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59890 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59904 - "POST /generate_stream HTTP/1.1" 200 OK
0.08082389831542969
offload 1 adapters, 5 remains
cost offload cat: 0.03218650817871094
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10514259338378906
Function offload_adapters took 0.6341934204101562 ms to run.
current batch size: 6 token used ratio: 0.019408333333333333
cost offload scan: 0.08702278137207031
offload 1 adapters, 4 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04124641418457031
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.5590915679931641 ms to run.
cost offload scan: 0.2799034118652344
offload 1 adapters, 3 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.041484832763671875
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10037422180175781
Function offload_adapters took 0.7474422454833984 ms to run.
cost offload scan: 0.08058547973632812
offload 1 adapters, 2 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10251998901367188
Function offload_adapters took 0.5638599395751953 ms to run.
current batch size: 3 token used ratio: 0.009641666666666666
cost load scan: 0.010728836059570312
load 1 adapters, 3 in total
Function load_lora_A took 1.2166500091552734 ms to run.
Function load_lora_B took 1.2402534484863281 ms to run.
cost realload: 2.857208251953125
Function load_adapters took 2.878427505493164 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 4 in total
Function load_lora_A took 1.2078285217285156 ms to run.
Function load_lora_B took 1.2025833129882812 ms to run.
cost realload: 2.8078556060791016
Function load_adapters took 2.8290748596191406 ms to run.
current batch size: 5 token used ratio: 0.015325
offload 0 adapters, 4 remains
Function offload_adapters took 0.011920928955078125 ms to run.
current batch size: 4 token used ratio: 0.0129
cost offload scan: 0.08320808410644531
offload 1 adapters, 3 remains
cost offload cat: 0.03314018249511719
cost offload free mem manager: 0.05173683166503906
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.11301040649414062
Function offload_adapters took 0.5967617034912109 ms to run.
Avg tokens(prompt+generate) throughput:  460.339 tokens/s
Avg prompt tokens throughput:            242.945 tokens/s
Avg generate tokens throughput:          217.393 tokens/s
cost offload scan: 0.08034706115722656
offload 1 adapters, 2 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10204315185546875
Function offload_adapters took 0.5550384521484375 ms to run.
current batch size: 2 token used ratio: 0.00615
cost load scan: 0.010967254638671875
load 2 adapters, 4 in total
Function load_lora_A took 1.2083053588867188 ms to run.
Function load_lora_B took 1.2309551239013672 ms to run.
Function load_lora_A took 1.199960708618164 ms to run.
Function load_lora_B took 1.2326240539550781 ms to run.
cost realload: 5.375146865844727
Function load_adapters took 5.39708137512207 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.1997222900390625 ms to run.
Function load_lora_B took 1.2159347534179688 ms to run.
cost realload: 2.810955047607422
Function load_adapters took 2.8312206268310547 ms to run.
current batch size: 5 token used ratio: 0.01395
cost load scan: 0.007867813110351562
load 0 adapters, 5 in total
cost realload: 0.2849102020263672
Function load_adapters took 0.30803680419921875 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 6 in total
Function load_lora_A took 1.210927963256836 ms to run.
Function load_lora_B took 1.2004375457763672 ms to run.
cost realload: 2.7985572814941406
Function load_adapters took 2.8197765350341797 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 6 in total
cost realload: 0.27871131896972656
Function load_adapters took 0.3025531768798828 ms to run.
current batch size: 8 token used ratio: 0.022316666666666665
offload 0 adapters, 6 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost offload scan: 0.08225440979003906
offload 1 adapters, 5 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.04100799560546875
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.1049041748046875
Function offload_adapters took 0.5619525909423828 ms to run.
current batch size: 6 token used ratio: 0.017083333333333332
current batch size: 6 token used ratio: 0.019583333333333335
current batch size: 6 token used ratio: 0.022083333333333333
cost load scan: 0.008344650268554688
load 1 adapters, 6 in total
Function load_lora_A took 1.232147216796875 ms to run.
Function load_lora_B took 1.203775405883789 ms to run.
cost realload: 2.8693675994873047
Function load_adapters took 2.8908252716064453 ms to run.
cost offload scan: 0.08797645568847656
offload 1 adapters, 5 remains
cost offload cat: 0.032901763916015625
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10585784912109375
Function offload_adapters took 0.5705356597900391 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 5 in total
cost realload: 0.29778480529785156
Function load_adapters took 0.3218650817871094 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.012636184692382812 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.012159347534179688 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 6 in total
Function load_lora_A took 1.2416839599609375 ms to run.
Function load_lora_B took 1.2359619140625 ms to run.
cost realload: 2.876758575439453
Function load_adapters took 2.896547317504883 ms to run.
current batch size: 6 token used ratio: 0.017333333333333333
cost load scan: 0.00762939453125
load 0 adapters, 6 in total
cost realload: 0.2760887145996094
Function load_adapters took 0.30159950256347656 ms to run.
cost offload scan: 0.0820159912109375
offload 1 adapters, 5 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10371208190917969
Function offload_adapters took 0.5559921264648438 ms to run.
cost offload scan: 0.2532005310058594
offload 1 adapters, 4 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10347366333007812
Function offload_adapters took 0.7300376892089844 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.2373924255371094 ms to run.
Function load_lora_B took 1.2230873107910156 ms to run.
cost realload: 2.830028533935547
Function load_adapters took 2.8505325317382812 ms to run.
current batch size: 6 token used ratio: 0.016041666666666666
cost offload scan: 0.08177757263183594
offload 1 adapters, 4 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.11134147644042969
Function offload_adapters took 0.5640983581542969 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 5 in total
Function load_lora_A took 1.2059211730957031 ms to run.
Function load_lora_B took 1.2578964233398438 ms to run.
cost realload: 2.8502941131591797
Function load_adapters took 2.871274948120117 ms to run.
current batch size: 6 token used ratio: 0.016441666666666667
cost load scan: 0.010013580322265625
load 0 adapters, 5 in total
cost realload: 0.2872943878173828
Function load_adapters took 0.31113624572753906 ms to run.
Avg tokens(prompt+generate) throughput:  554.036 tokens/s
Avg prompt tokens throughput:            317.806 tokens/s
Avg generate tokens throughput:          236.230 tokens/s
cost load scan: INFO:     127.0.0.1:59910 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59916 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:59922 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45754 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45756 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45764 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45778 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45780 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45782 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45794 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45808 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45816 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45818 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52662 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52672 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52678 - "POST /generate_stream HTTP/1.1" 200 OK
0.00762939453125
load 0 adapters, 5 in total
cost realload: 0.3159046173095703
Function load_adapters took 0.3399848937988281 ms to run.
cost load scan: 0.011205673217773438
load 1 adapters, 6 in total
Function load_lora_A took 1.173257827758789 ms to run.
Function load_lora_B took 1.2335777282714844 ms to run.
cost realload: 2.8078556060791016
Function load_adapters took 2.828359603881836 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.29969215393066406
Function load_adapters took 0.3266334533691406 ms to run.
current batch size: 10 token used ratio: 0.027308333333333334
offload 0 adapters, 6 remains
Function offload_adapters took 0.0152587890625 ms to run.
current batch size: 9 token used ratio: 0.028008333333333333
cost load scan: 0.010013580322265625
load 1 adapters, 7 in total
Function load_lora_A took 1.2023448944091797 ms to run.
Function load_lora_B took 1.1935234069824219 ms to run.
cost realload: 2.791166305541992
Function load_adapters took 2.8121471405029297 ms to run.
cost load scan: 0.01049041748046875
load 1 adapters, 8 in total
Function load_lora_A took 1.19781494140625 ms to run.
Function load_lora_B took 1.199483871459961 ms to run.
cost realload: 2.8061866760253906
Function load_adapters took 2.8269290924072266 ms to run.
cost offload scan: 0.0858306884765625
offload 1 adapters, 7 remains
cost offload cat: 0.03337860107421875
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.11467933654785156
Function offload_adapters took 0.583648681640625 ms to run.
offload 0 adapters, 7 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost offload scan: 0.08344650268554688
offload 1 adapters, 6 remains
cost offload cat: 0.031232833862304688
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10466575622558594
Function offload_adapters took 0.5638599395751953 ms to run.
current batch size: 8 token used ratio: 0.02351666666666667
offload 0 adapters, 6 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 6 in total
cost realload: 0.2970695495605469
Function load_adapters took 0.32138824462890625 ms to run.
current batch size: 8 token used ratio: 0.024141666666666665
cost load scan: 0.008106231689453125
load 0 adapters, 6 in total
cost realload: 0.28133392333984375
Function load_adapters took 0.30612945556640625 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.012159347534179688 ms to run.
cost load scan: 0.0133514404296875
load 1 adapters, 7 in total
Function load_lora_A took 1.2183189392089844 ms to run.
Function load_lora_B took 1.2047290802001953 ms to run.
cost realload: 2.8154850006103516
Function load_adapters took 2.8367042541503906 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 7 in total
cost realload: 0.2892017364501953
Function load_adapters took 0.31304359436035156 ms to run.
offload 0 adapters, 7 remains
Function offload_adapters took 0.011920928955078125 ms to run.
current batch size: 10 token used ratio: 0.02865
offload 0 adapters, 7 remains
Function offload_adapters took 0.011920928955078125 ms to run.
offload 0 adapters, 7 remains
Function offload_adapters took 0.011920928955078125 ms to run.
current batch size: 8 token used ratio: 0.024583333333333332
cost offload scan: 0.08797645568847656
offload 1 adapters, 6 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04124641418457031
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10156631469726562
Function offload_adapters took 0.568389892578125 ms to run.
cost offload scan: 0.08034706115722656
offload 1 adapters, 5 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04172325134277344
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.1010894775390625
Function offload_adapters took 0.5581378936767578 ms to run.
cost offload scan: 0.08058547973632812
offload 1 adapters, 4 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10275840759277344
Function offload_adapters took 0.5631446838378906 ms to run.
current batch size: 5 token used ratio: 0.015608333333333333
cost load scan: 0.00762939453125
load 0 adapters, 4 in total
cost realload: 0.2906322479248047
Function load_adapters took 0.31447410583496094 ms to run.
current batch size: 6 token used ratio: 0.020225
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.233816146850586 ms to run.
Function load_lora_B took 1.2400150299072266 ms to run.
cost realload: 2.8769969940185547
Function load_adapters took 2.8972625732421875 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.011920928955078125 ms to run.
cost offload scan: 0.09012222290039062
offload 1 adapters, 4 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.102996826171875
Function offload_adapters took 0.5681514739990234 ms to run.
cost load scan: 0.010967254638671875
load 1 adapters, 5 in total
Function load_lora_A took 1.2202262878417969 ms to run.
Function load_lora_B took 1.2569427490234375 ms to run.
cost realload: 2.866029739379883
Function load_adapters took 2.888917922973633 ms to run.
Avg tokens(prompt+generate) throughput:  644.763 tokens/s
Avg prompt tokens throughput:            316.094 tokens/s
Avg generate tokens throughput:          328.670 tokens/s
offload 0 adapters, 5 remains
Function offload_adapters took 0.011920928955078125 ms to run.
current batch size: 5 token used ratio: 0.015091666666666666
cost offload scan: 0.08368492126464844
offload 1 adapters, 4 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10037422180175781
Function offload_adapters took 0.5629062652587891 ms to run.
cost offload scan: 0.07915496826171875
offload 1 adapters, 3 remains
cost offload cat: 0.029087066650390625
cost offload free mem manager: 0.04100799560546875
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.09942054748535156
Function offload_adapters took 0.5450248718261719 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 4 in total
Function load_lora_A took 1.220703125 ms to run.
Function load_lora_B took 1.2371540069580078 ms to run.
cost realload: 2.850055694580078
Function load_adapters took 2.870321273803711 ms to run.
current batch size: 4 token used ratio: 0.010766666666666667
cost load scan: 0.007867813110351562
load 1 adapters, 5 in total
Function load_lora_A took 1.1935234069824219 ms to run.
Function load_lora_B took 1.2426376342773438 ms to run.
cost realload: 2.824068069458008
Function load_adapters took 2.844572067260742 ms to run.
current batch size: 5 token used ratio: 0.014916666666666667
cost load scan: 0.00858306884765625
load 1 adapters, 6 in total
Function load_lora_A took 1.2009143829345703 ms to run.
Function load_lora_B took 1.2345314025878906 ms to run.
cost realload: 2.8226375579833984
Function load_adapters took 2.8426647186279297 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 6 in total
cost realload: 0.2808570861816406
Function load_adapters took 0.3046989440917969 ms to run.
current batch size: 7 token used ratio: 0.020991666666666665
cost offload scan: 0.08726119995117188
offload 1 adapters, 5 remains
cost offload cat: 0.033855438232421875
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10967254638671875
Function offload_adapters took 0.5879402160644531 ms to run.
cost load scan: 0.008821487426757812
load 1 adapters, 6 in total
Function load_lora_A took 1.1909008026123047 ms to run.
Function load_lora_B took 1.224517822265625 ms to run.
cost realload: INFO:     127.0.0.1:52680 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52690 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52700 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52706 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52710 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52724 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52738 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52744 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52750 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52764 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46596 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46612 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46616 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46624 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46628 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46638 - "POST /generate_stream HTTP/1.1" 200 OK
2.832651138305664
Function load_adapters took 2.889871597290039 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.2906322479248047
Function load_adapters took 0.3154277801513672 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.01239776611328125 ms to run.
current batch size: 7 token used ratio: 0.019583333333333335
cost load scan: 0.00858306884765625
load 1 adapters, 7 in total
Function load_lora_A took 1.2066364288330078 ms to run.
Function load_lora_B took 1.2297630310058594 ms to run.
cost realload: 2.8324127197265625
Function load_adapters took 2.8536319732666016 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 7 in total
cost realload: 0.2741813659667969
Function load_adapters took 0.2987384796142578 ms to run.
cost load scan: 0.01239776611328125
load 1 adapters, 8 in total
Function load_lora_A took 1.239776611328125 ms to run.
Function load_lora_B took 1.222372055053711 ms to run.
cost realload: 2.8700828552246094
Function load_adapters took 2.892732620239258 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 8 in total
cost realload: 0.27751922607421875
Function load_adapters took 0.30112266540527344 ms to run.
cost offload scan: 0.08606910705566406
offload 1 adapters, 7 remains
cost offload cat: 0.03314018249511719
cost offload free mem manager: 0.04744529724121094
cost offload torch.empty: 0.02384185791015625
cost offload a_loc update: 0.11301040649414062
Function offload_adapters took 0.5953311920166016 ms to run.
current batch size: 11 token used ratio: 0.029441666666666668
cost offload scan: 0.08273124694824219
offload 1 adapters, 6 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04172325134277344
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10275840759277344
Function offload_adapters took 0.5600452423095703 ms to run.
current batch size: 10 token used ratio: 0.029858333333333334
cost offload scan: 0.08392333984375
offload 1 adapters, 5 remains
cost offload cat: 0.03409385681152344
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10418891906738281
Function offload_adapters took 0.5822181701660156 ms to run.
current batch size: 9 token used ratio: 0.029491666666666666
offload 0 adapters, 5 remains
Function offload_adapters took 0.012159347534179688 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.01239776611328125 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.011920928955078125 ms to run.
current batch size: 6 token used ratio: 0.0215
cost offload scan: 0.08130073547363281
offload 1 adapters, 4 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.041484832763671875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10275840759277344
Function offload_adapters took 0.5600452423095703 ms to run.
cost offload scan: 0.08106231689453125
offload 1 adapters, 3 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.5640983581542969 ms to run.
current batch size: 4 token used ratio: 0.015533333333333333
cost load scan: 0.008821487426757812
load 2 adapters, 5 in total
Function load_lora_A took 1.2001991271972656 ms to run.
Function load_lora_B took 1.2445449829101562 ms to run.
Function load_lora_A took 1.1866092681884766 ms to run.
Function load_lora_B took 1.2412071228027344 ms to run.
cost realload: 5.358695983886719
Function load_adapters took 5.380153656005859 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.011920928955078125 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 5 in total
cost realload: 0.2942085266113281
Function load_adapters took 0.31876564025878906 ms to run.
Avg tokens(prompt+generate) throughput:  675.581 tokens/s
Avg prompt tokens throughput:            353.186 tokens/s
Avg generate tokens throughput:          322.396 tokens/s
cost offload scan: 0.08106231689453125
offload 1 adapters, 4 remains
cost offload cat: 0.029325485229492188
cost offload free mem manager: 0.04124641418457031
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10085105895996094
Function offload_adapters took 0.5490779876708984 ms to run.
cost offload scan: 0.08082389831542969
offload 1 adapters, 3 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.102996826171875
Function offload_adapters took 0.5557537078857422 ms to run.
cost offload scan: 0.08487701416015625
offload 1 adapters, 2 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04172325134277344
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10228157043457031
Function offload_adapters took 0.5574226379394531 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 3 in total
Function load_lora_A took 1.18255615234375 ms to run.
Function load_lora_B took 1.2285709381103516 ms to run.
cost realload: 2.7923583984375
Function load_adapters took 2.812623977661133 ms to run.
current batch size: 4 token used ratio: 0.010058333333333334
current batch size: 4 token used ratio: 0.011725
cost load scan: 0.007867813110351562
load 0 adapters, 3 in total
cost realload: 0.3039836883544922
Function load_adapters took 0.3285408020019531 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 4 in total
Function load_lora_A took 1.2197494506835938 ms to run.
Function load_lora_B took 1.2459754943847656 ms to run.
cost realload: 2.875804901123047
Function load_adapters took 2.8960704803466797 ms to run.
current batch size: 6 token used ratio: 0.017075
cost load scan: 0.008821487426757812
load 1 adapters, 5 in total
Function load_lora_A took 1.224517822265625 ms to run.
Function load_lora_B took 1.2290477752685547 ms to run.
cost realload: 2.871990203857422
Function load_adapters took 2.8939247131347656 ms to run.
current batch size: 7 token used ratio: 0.021766666666666667
cost load scan: 0.007867813110351562
load 0 adapters, 5 in total
cost realload: 0.2906322479248047
Function load_adapters took 0.31495094299316406 ms to run.
cost load scan: 0.008106231689453125
load 0 adapters, 5 in total
cost realload: 0.2827644348144531
Function load_adapters took 0.3066062927246094 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.012636184692382812 ms to run.
current batch size: 8 token used ratio: 0.024391666666666666
cost offload scan: 0.0858306884765625
offload 1 adapters, 4 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10228157043457031
Function offload_adapters took 0.5655288696289062 ms to run.
cost offload scan: 0.08058547973632812
offload 1 adapters, 3 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.02193450927734375
cost offload a_loc update: 0.10228157043457031
Function offload_adapters took 0.5521774291992188 ms to run.
current batch size: 6 token used ratio: 0.018583333333333334
offload 0 adapters, 3 remains
Function offload_adapters took 0.012159347534179688 ms to run.
current batch size: 5 token used ratio: 0.016266666666666665
offload 0 adapters, 3 remains
Function offload_adapters took 0.012159347534179688 ms to run.
cost load scan: 0.007867813110351562
load 1 adapters, 4 in total
Function load_lora_A took 1.1937618255615234 ms to run.
Function load_lora_B took 1.210927963256836 ms to run.
cost realload: 2.7933120727539062
Function load_adapters took 2.8150081634521484 ms to run.
offload 0 adapters, 4 remains
Function offload_adapters took 0.012636184692382812 ms to run.
current batch size: 4 token used ratio: 0.013108333333333333
current batch size: 4 token used ratio: 0.014775
cost offload scan: 0.08606910705566406
INFO:     127.0.0.1:46652 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46654 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46666 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37710 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37716 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37722 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37726 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37738 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37754 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37760 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37490 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37500 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37508 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37514 - "POST /generate_stream HTTP/1.1" 200 OK
offload 1 adapters, 3 remains
cost offload cat: 0.03314018249511719
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10371208190917969
Function offload_adapters took 0.6051063537597656 ms to run.
cost offload scan: 0.08249282836914062
offload 1 adapters, 2 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10347366333007812
Function offload_adapters took 0.5688667297363281 ms to run.
cost offload scan: 0.08034706115722656
offload 1 adapters, 1 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.545501708984375 ms to run.
cost load scan: 0.008344650268554688
load 2 adapters, 3 in total
Function load_lora_A took 1.178741455078125 ms to run.
Function load_lora_B took 1.1937618255615234 ms to run.
Function load_lora_A took 1.2035369873046875 ms to run.
Function load_lora_B took 1.2440681457519531 ms to run.
cost realload: 5.283355712890625
Function load_adapters took 5.304098129272461 ms to run.
Avg tokens(prompt+generate) throughput:  448.535 tokens/s
Avg prompt tokens throughput:            219.874 tokens/s
Avg generate tokens throughput:          228.661 tokens/s
current batch size: 3 token used ratio: 0.007575
cost load scan: 0.008106231689453125
load 1 adapters, 4 in total
Function load_lora_A took 1.2068748474121094 ms to run.
Function load_lora_B took 1.2476444244384766 ms to run.
cost realload: 2.838611602783203
Function load_adapters took 2.861499786376953 ms to run.
current batch size: 4 token used ratio: 0.010983333333333333
cost offload scan: 0.08630752563476562
offload 1 adapters, 3 remains
cost offload cat: 0.03337860107421875
cost offload free mem manager: 0.0457763671875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.11563301086425781
Function offload_adapters took 0.5888938903808594 ms to run.
current batch size: 3 token used ratio: 0.00835
cost load scan: 0.0095367431640625
load 1 adapters, 4 in total
Function load_lora_A took 1.2080669403076172 ms to run.
Function load_lora_B took 1.2218952178955078 ms to run.
cost realload: 2.8243064880371094
Function load_adapters took 2.8464794158935547 ms to run.
current batch size: 4 token used ratio: 0.012066666666666667
cost load scan: 0.010251998901367188
load 1 adapters, 5 in total
Function load_lora_A took 1.2056827545166016 ms to run.
Function load_lora_B took 1.2335777282714844 ms to run.
cost realload: 2.841949462890625
Function load_adapters took 2.8624534606933594 ms to run.
current batch size: 5 token used ratio: 0.016175
cost load scan: 0.008344650268554688
load 0 adapters, 5 in total
cost realload: 0.3077983856201172
Function load_adapters took 0.33283233642578125 ms to run.
cost offload scan: 0.08177757263183594
offload 1 adapters, 4 remains
cost offload cat: 0.03552436828613281
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10538101196289062
Function offload_adapters took 0.5822181701660156 ms to run.
offload 0 adapters, 4 remains
Function offload_adapters took 0.012874603271484375 ms to run.
cost offload scan: 0.08654594421386719
offload 1 adapters, 3 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10418891906738281
Function offload_adapters took 0.5619525909423828 ms to run.
cost load scan: 0.007867813110351562
load 1 adapters, 4 in total
Function load_lora_A took 1.2099742889404297 ms to run.
Function load_lora_B took 1.2524127960205078 ms to run.
cost realload: 2.849578857421875
Function load_adapters took 2.8696060180664062 ms to run.
current batch size: 4 token used ratio: 0.0105
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.1985301971435547 ms to run.
Function load_lora_B took 1.2140274047851562 ms to run.
cost realload: 2.798795700073242
Function load_adapters took 2.819538116455078 ms to run.
current batch size: 5 token used ratio: 0.014183333333333333
cost offload scan: 0.08177757263183594
offload 1 adapters, 4 remains
cost offload cat: 0.03170967102050781
cost offload free mem manager: 0.04291534423828125
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.5655288696289062 ms to run.
current batch size: 4 token used ratio: 0.012141666666666667
cost offload scan: 0.08058547973632812
offload 1 adapters, 3 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.041484832763671875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.09989738464355469
Function offload_adapters took 0.5497932434082031 ms to run.
current batch size: 3 token used ratio: 0.009691666666666666
cost offload scan: 0.08296966552734375
offload 1 adapters, 2 remains
cost offload cat: 0.02956390380859375
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.02193450927734375
cost offload a_loc update: 0.09989738464355469
Function offload_adapters took 0.5459785461425781 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 3 in total
Function load_lora_A took 1.1661052703857422 ms to run.
Function load_lora_B took 1.2297630310058594 ms to run.
cost realload: 2.7875900268554688
Function load_adapters took 2.8076171875 ms to run.
current batch size: 3 token used ratio: 0.009466666666666667
Avg tokens(prompt+generate) throughput:  361.697 tokens/s
Avg prompt tokens throughput:            174.398 tokens/s
Avg generate tokens throughput:          187.298 tokens/s
cost offload scan: 0.07891654968261719
offload 1 adapters, 2 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04076957702636719
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.5447864532470703 ms to run.
current batch size: 2 token used ratio: 0.006625
cost offload scan: 0.08368492126464844
offload 1 adapters, 1 remains
cost offload cat: 0.03337860107421875
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10776519775390625
Function offload_adapters took 0.5586147308349609 ms to run.
current batch size: 1 token used ratio: 0.0033333333333333335
cost load scan: 0.0073909759521484375
load 0 adapters, 1 in total
cost realload: 0.2925395965576172
Function load_adapters took 0.31566619873046875 ms to run.
current batch size: 2 token used ratio: 0.005633333333333333
current batch size: 2 token used ratio: 0.006466666666666667
cost load scan: 0.008106231689453125
load 0 adapters, 1 in total
cost realload: 0.30493736267089844
Function load_adapters took 0.33164024353027344 ms to run.
offload 0 adapters, 1 remains
Function offload_adapters took 0.0133514404296875 ms to run.
current batch size: 2 token used ratio: 0.0047
cost load scan: 0.008344650268554688
load 1 adapters, 2 in total
Function load_lora_A took 1.1973381042480469 ms to run.
Function load_lora_B took 1.2173652648925781 ms to run.
cost realload: 2.8002262115478516
Function load_adapters took 2.8214454650878906 ms to run.
current batch size: 3 token used ratio: 0.007891666666666667
current batch size: 3 token used ratio: 0.009141666666666666
cost load scan: 0.012874603271484375
load 1 adapters, 3 in total
Function load_lora_A took 1.2116432189941406 ms to run.
Function load_lora_B took 1.2249946594238281 ms to run.
cost realload: 2.8290748596191406
Function load_adapters took 2.849578857421875 ms to run.
offload 0 adapters, 3 remains
Function offload_adapters took 0.013113021850585938 ms to run.
current batch size: 3 token used ratio: 0.009241666666666667
cost load scan: 0.00858306884765625
load 1 adapters, 4 in total
Function load_lora_A took 1.2254714965820312 ms to run.
INFO:     127.0.0.1:37526 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37542 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37544 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58648 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58664 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58670 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58674 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58690 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58698 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58710 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58718 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58728 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58734 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58740 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58754 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58760 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58776 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:58778 - "POST /generate_stream HTTP/1.1" 200 OK
Function load_lora_B took 1.2547969818115234 ms to run.
cost realload: 2.897500991821289
Function load_adapters took 2.9184818267822266 ms to run.
cost offload scan: 0.08463859558105469
offload 1 adapters, 3 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10895729064941406
Function offload_adapters took 0.5705356597900391 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 4 in total
Function load_lora_A took 1.241922378540039 ms to run.
Function load_lora_B took 1.188516616821289 ms to run.
cost realload: 2.823352813720703
Function load_adapters took 2.844095230102539 ms to run.
current batch size: 4 token used ratio: 0.011183333333333333
cost load scan: 0.01049041748046875
load 1 adapters, 5 in total
Function load_lora_A took 1.2111663818359375 ms to run.
Function load_lora_B took 1.2249946594238281 ms to run.
cost realload: 2.828836441040039
Function load_adapters took 2.8505325317382812 ms to run.
current batch size: 5 token used ratio: 0.015108333333333333
cost offload scan: 0.08130073547363281
offload 1 adapters, 4 remains
cost offload cat: 0.03314018249511719
cost offload free mem manager: 0.046253204345703125
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.11229515075683594
Function offload_adapters took 0.5793571472167969 ms to run.
Avg tokens(prompt+generate) throughput:  301.887 tokens/s
Avg prompt tokens throughput:            166.617 tokens/s
Avg generate tokens throughput:          135.270 tokens/s
cost load scan: 0.00762939453125
load 0 adapters, 4 in total
cost realload: 0.28777122497558594
Function load_adapters took 0.3132820129394531 ms to run.
current batch size: 5 token used ratio: 0.014908333333333334
offload 0 adapters, 4 remains
Function offload_adapters took 0.01239776611328125 ms to run.
current batch size: 4 token used ratio: 0.012533333333333334
cost load scan: 0.007867813110351562
load 1 adapters, 5 in total
Function load_lora_A took 1.2309551239013672 ms to run.
Function load_lora_B took 1.2102127075195312 ms to run.
cost realload: 2.8336048126220703
Function load_adapters took 2.856016159057617 ms to run.
cost offload scan: 0.0858306884765625
offload 1 adapters, 4 remains
cost offload cat: 0.03266334533691406
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10538101196289062
Function offload_adapters took 0.576019287109375 ms to run.
current batch size: 4 token used ratio: 0.0121
cost load scan: 0.007867813110351562
load 0 adapters, 4 in total
cost realload: 0.2884864807128906
Function load_adapters took 0.31304359436035156 ms to run.
cost offload scan: 0.08487701416015625
offload 1 adapters, 3 remains
cost offload cat: 0.03409385681152344
cost offload free mem manager: 0.041484832763671875
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10418891906738281
Function offload_adapters took 0.5676746368408203 ms to run.
cost offload scan: 0.07987022399902344
offload 1 adapters, 2 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.04100799560546875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10061264038085938
Function offload_adapters took 0.5464553833007812 ms to run.
current batch size: 3 token used ratio: 0.007983333333333334
cost load scan: 0.00762939453125
load 0 adapters, 2 in total
cost realload: 0.2923011779785156
Function load_adapters took 0.3161430358886719 ms to run.
current batch size: 4 token used ratio: 0.011675
offload 0 adapters, 2 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost load scan: 0.010251998901367188
load 1 adapters, 3 in total
Function load_lora_A took 1.2090206146240234 ms to run.
Function load_lora_B took 1.2364387512207031 ms to run.
cost realload: 2.841949462890625
Function load_adapters took 2.8624534606933594 ms to run.
current batch size: 4 token used ratio: 0.0113
cost load scan: 0.008106231689453125
load 1 adapters, 4 in total
Function load_lora_A took 1.1973381042480469 ms to run.
Function load_lora_B took 1.2438297271728516 ms to run.
cost realload: 2.8274059295654297
Function load_adapters took 2.847909927368164 ms to run.
cost load scan: 0.007867813110351562
load 1 adapters, 5 in total
Function load_lora_A took 1.2085437774658203 ms to run.
Function load_lora_B took 1.201629638671875 ms to run.
cost realload: 2.7947425842285156
Function load_adapters took 2.8154850006103516 ms to run.
cost load scan: 0.012159347534179688
load 1 adapters, 6 in total
Function load_lora_A took 1.2280941009521484 ms to run.
Function load_lora_B took 1.2161731719970703 ms to run.
cost realload: 2.8395652770996094
Function load_adapters took 2.8603076934814453 ms to run.
cost offload scan: 0.08606910705566406
offload 1 adapters, 5 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04172325134277344
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10609626770019531
Function offload_adapters took 0.5707740783691406 ms to run.
current batch size: 6 token used ratio: 0.0154
cost load scan: 0.008344650268554688
load 1 adapters, 6 in total
Function load_lora_A took 1.1930465698242188 ms to run.
Function load_lora_B took 1.2316703796386719 ms to run.
cost realload: 2.820253372192383
Function load_adapters took 2.8412342071533203 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.29540061950683594
Function load_adapters took 0.3199577331542969 ms to run.
offload 0 adapters, 6 remains
Function offload_adapters took 0.01239776611328125 ms to run.
current batch size: 7 token used ratio: 0.01875
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.27751922607421875
Function load_adapters took 0.3008842468261719 ms to run.
cost load scan: 0.007867813110351562
load 1 adapters, 7 in total
Function load_lora_A took 1.1868476867675781 ms to run.
Function load_lora_B took 1.2466907501220703 ms to run.
cost realload: 2.820253372192383
Function load_adapters took 2.8412342071533203 ms to run.
current batch size: 9 token used ratio: 0.026125
cost offload scan: 0.08082389831542969
offload 1 adapters, 6 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10514259338378906
Function offload_adapters took 0.5633831024169922 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.2789497375488281
Function load_adapters took 0.3032684326171875 ms to run.
Avg tokens(prompt+generate) throughput:  559.549 tokens/s
Avg prompt tokens throughput:            303.555 tokens/s
Avg generate tokens throughput:          255.994 tokens/s
cost load scan: 0.00762939453125
load 0 adapters, 6 in total
cost realload: 0.27370452880859375
Function load_adapters took 0.29778480529785156 ms to run.
current batch size: 10 token used ratio: 0.029125
cost offload scan: 0.08225440979003906
offload 1 adapters, 5 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.049114227294921875
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10395050048828125
Function offload_adapters took 0.5691051483154297 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.011920928955078125 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 5 in total
cost realload: 0.2779960632324219
Function load_adapters took 0.301361083984375 ms to run.
current batch size: 9 token used ratio: 0.02755
cost offload scan: 0.08678436279296875
offload 1 adapters, 4 remains
cost offload cat: 0.03361701965332031
cost offload free mem manager: 0.0457763671875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.102996826171875
Function offload_adapters took 0.5793571472167969 ms to run.
offload 0 adapters, 4 remains
Function offload_adapters took 0.011920928955078125 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 4 in total
cost realload: INFO:     127.0.0.1:58790 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52898 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52910 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52914 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52930 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52934 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52946 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52954 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:52958 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46510 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46522 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46534 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46538 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46542 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46546 - "POST /generate_stream HTTP/1.1" 200 OK
0.2918243408203125
Function load_adapters took 0.3490447998046875 ms to run.
cost offload scan: 0.08296966552734375
offload 1 adapters, 3 remains
cost offload cat: 0.029325485229492188
cost offload free mem manager: 0.04100799560546875
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.09775161743164062
Function offload_adapters took 0.5450248718261719 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 4 in total
Function load_lora_A took 1.2238025665283203 ms to run.
Function load_lora_B took 1.2211799621582031 ms to run.
cost realload: 2.835988998413086
Function load_adapters took 2.856731414794922 ms to run.
current batch size: 8 token used ratio: 0.02355
offload 0 adapters, 4 remains
Function offload_adapters took 0.012636184692382812 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 5 in total
Function load_lora_A took 1.2226104736328125 ms to run.
Function load_lora_B took 1.222848892211914 ms to run.
cost realload: 2.833843231201172
Function load_adapters took 2.854585647583008 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.012159347534179688 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.013113021850585938 ms to run.
current batch size: 6 token used ratio: 0.016583333333333332
cost load scan: 0.00858306884765625
load 0 adapters, 5 in total
cost realload: 0.3094673156738281
Function load_adapters took 0.3342628479003906 ms to run.
cost load scan: 0.009059906005859375
load 1 adapters, 6 in total
Function load_lora_A took 1.1980533599853516 ms to run.
Function load_lora_B took 1.2054443359375 ms to run.
cost realload: 2.8040409088134766
Function load_adapters took 2.8247833251953125 ms to run.
current batch size: 8 token used ratio: 0.023275
cost offload scan: 0.08535385131835938
offload 1 adapters, 5 remains
cost offload cat: 0.031948089599609375
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10752677917480469
Function offload_adapters took 0.5755424499511719 ms to run.
current batch size: 7 token used ratio: 0.022591666666666666
offload 0 adapters, 5 remains
Function offload_adapters took 0.011920928955078125 ms to run.
current batch size: 6 token used ratio: 0.021175
cost offload scan: 0.08153915405273438
offload 1 adapters, 4 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04100799560546875
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10347366333007812
Function offload_adapters took 0.5652904510498047 ms to run.
cost offload scan: 0.07843971252441406
offload 1 adapters, 3 remains
cost offload cat: 0.029087066650390625
cost offload free mem manager: 0.04076957702636719
cost offload torch.empty: 0.021696090698242188
cost offload a_loc update: 0.10633468627929688
Function offload_adapters took 0.5514621734619141 ms to run.
offload 0 adapters, 3 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 4 in total
Function load_lora_A took 1.2488365173339844 ms to run.
Function load_lora_B took 1.2481212615966797 ms to run.
cost realload: 2.890348434448242
Function load_adapters took 2.9134750366210938 ms to run.
cost load scan: 0.007867813110351562
load 1 adapters, 5 in total
Function load_lora_A took 1.2197494506835938 ms to run.
Function load_lora_B took 1.2297630310058594 ms to run.
cost realload: 2.8333663940429688
Function load_adapters took 2.8541088104248047 ms to run.
current batch size: 5 token used ratio: 0.01465
cost load scan: 0.011205673217773438
load 1 adapters, 6 in total
Function load_lora_A took 1.2335777282714844 ms to run.
Function load_lora_B took 1.2385845184326172 ms to run.
cost realload: 2.8705596923828125
Function load_adapters took 2.8908252716064453 ms to run.
cost offload scan: 0.08392333984375
offload 1 adapters, 5 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.041484832763671875
cost offload torch.empty: 0.02193450927734375
cost offload a_loc update: 0.09965896606445312
Function offload_adapters took 0.5517005920410156 ms to run.
current batch size: 5 token used ratio: 0.015208333333333334
cost offload scan: 0.07939338684082031
offload 1 adapters, 4 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04172325134277344
cost offload torch.empty: 0.02193450927734375
cost offload a_loc update: 0.10085105895996094
Function offload_adapters took 0.5574226379394531 ms to run.
cost offload scan: 0.08559226989746094
offload 1 adapters, 3 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.041484832763671875
cost offload torch.empty: 0.022172927856445312
cost offload a_loc update: 0.10013580322265625
Function offload_adapters took 0.5543231964111328 ms to run.
current batch size: 3 token used ratio: 0.008883333333333333
Avg tokens(prompt+generate) throughput:  535.291 tokens/s
Avg prompt tokens throughput:            238.684 tokens/s
Avg generate tokens throughput:          296.607 tokens/s
current batch size: 3 token used ratio: 0.010133333333333333
cost load scan: 0.012159347534179688
load 1 adapters, 4 in total
Function load_lora_A took 1.1820793151855469 ms to run.
Function load_lora_B took 1.2345314025878906 ms to run.
cost realload: 2.817392349243164
Function load_adapters took 2.838134765625 ms to run.
current batch size: 4 token used ratio: 0.013891666666666667
cost load scan: 0.008344650268554688
load 1 adapters, 5 in total
Function load_lora_A took 1.1980533599853516 ms to run.
Function load_lora_B took 1.2164115905761719 ms to run.
cost realload: 2.8052330017089844
Function load_adapters took 2.8259754180908203 ms to run.
cost offload scan: 0.08225440979003906
offload 1 adapters, 4 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.04172325134277344
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10657310485839844
Function offload_adapters took 0.5700588226318359 ms to run.
cost offload scan: 0.08106231689453125
offload 1 adapters, 3 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04172325134277344
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10132789611816406
Function offload_adapters took 0.5521774291992188 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 4 in total
Function load_lora_A took 1.2068748474121094 ms to run.
Function load_lora_B took 1.2218952178955078 ms to run.
cost realload: 2.8171539306640625
Function load_adapters took 2.8374195098876953 ms to run.
cost offload scan: 0.07843971252441406
offload 1 adapters, 3 remains
cost offload cat: 0.029325485229492188
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10538101196289062
Function offload_adapters took 0.5505084991455078 ms to run.
current batch size: 3 token used ratio: 0.0074
cost load scan: 0.009775161743164062
load 0 adapters, 3 in total
cost realload: 0.2951622009277344
Function load_adapters took 0.3218650817871094 ms to run.
current batch size: 4 token used ratio: 0.011233333333333333
cost load scan: 0.008821487426757812
load 1 adapters, 4 in total
Function load_lora_A took 1.1780261993408203 ms to run.
Function load_lora_B took 1.2035369873046875 ms to run.
cost realload: 2.810955047607422
Function load_adapters took 2.8328895568847656 ms to run.
current batch size: 5 token used ratio: 0.015591666666666667
cost load scan: 0.008106231689453125
load 0 adapters, 4 in total
cost realload: 0.2865791320800781
Function load_adapters took 0.3108978271484375 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.2030601501464844 ms to run.
Function load_lora_B took 1.2226104736328125 ms to run.
cost realload: 2.8235912322998047
Function load_adapters took 2.8438568115234375 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.015497207641601562 ms to run.
cost load scan: 0.010251998901367188
load 1 adapters, 6 in total
Function load_lora_A took 1.1777877807617188 ms to run.
INFO:     127.0.0.1:46556 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46560 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46564 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46572 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:46576 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:36294 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:36298 - "POST /generate_stream HTTP/1.1" 200 OK
For some LLaMA-based models, initializing the fast tokenizer may take a long time. To eliminate the initialization time, consider using 'hf-internal-testing/llama-tokenizer' instead of the original tokenizer.
llama-7b: 12.06 GB
peak working mem for (bs=20, seqlen=512): 0.70 GB
peak working mem for (bs=100, seqlen=512): 3.52 GB
all adapters (11) estimated size: 0.17 GB
avg adapter estimated size: 16.00 MB
INFO:     127.0.0.1:49820 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49824 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:49830 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40952 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40964 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:40972 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45324 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45328 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45334 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45338 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45354 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:45366 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39000 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39002 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39010 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39026 - "POST /generate_stream HTTP/1.1" 200 OK
cost load scan: 0.01049041748046875
load 1 adapters, 1 in total
Function load_lora_A took 1.3456344604492188 ms to run.
Function load_lora_B took 1.2121200561523438 ms to run.
cost realload: 6.12640380859375
Function load_adapters took 6.1511993408203125 ms to run.
Avg tokens(prompt+generate) throughput:   18.424 tokens/s
Avg prompt tokens throughput:             18.424 tokens/s
Avg generate tokens throughput:            0.000 tokens/s
cost load scan: 0.011444091796875
load 1 adapters, 2 in total
Function load_lora_A took 1.195669174194336 ms to run.
Function load_lora_B took 1.2116432189941406 ms to run.
cost realload: 2.910137176513672
Function load_adapters took 2.933979034423828 ms to run.
cost load scan: 0.010967254638671875
load 1 adapters, 3 in total
Function load_lora_A took 1.1882781982421875 ms to run.
Function load_lora_B took 1.214742660522461 ms to run.
cost realload: 2.816915512084961
Function load_adapters took 2.8390884399414062 ms to run.
current batch size: 3 token used ratio: 0.007141666666666667
current batch size: 3 token used ratio: 0.008391666666666667
cost load scan: 0.01049041748046875
load 1 adapters, 4 in total
Function load_lora_A took 1.2249946594238281 ms to run.
Function load_lora_B took 1.1811256408691406 ms to run.
cost realload: 2.8259754180908203
Function load_adapters took 2.851247787475586 ms to run.
current batch size: 4 token used ratio: 0.011558333333333334
cost load scan: 0.010967254638671875
load 1 adapters, 5 in total
Function load_lora_A took 1.201629638671875 ms to run.
Function load_lora_B took 1.2083053588867188 ms to run.
cost realload: 2.824544906616211
Function load_adapters took 2.846956253051758 ms to run.
current batch size: 5 token used ratio: 0.015216666666666667
current batch size: 5 token used ratio: 0.0173
cost offload scan: 0.3287792205810547
offload 1 adapters, 4 remains
cost offload cat: 0.04458427429199219
cost offload free mem manager: 0.05125999450683594
cost offload torch.empty: 0.023603439331054688
cost offload a_loc update: 158.88118743896484
Function offload_adapters took 159.6815586090088 ms to run.
cost offload scan: 0.08058547973632812
offload 1 adapters, 3 remains
cost offload cat: 0.03814697265625
cost offload free mem manager: 0.045299530029296875
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10347366333007812
Function offload_adapters took 0.5757808685302734 ms to run.
cost offload scan: 0.07939338684082031
offload 1 adapters, 2 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.09822845458984375
Function offload_adapters took 0.553131103515625 ms to run.
current batch size: 2 token used ratio: 0.0060416666666666665
current batch size: 2 token used ratio: 0.006875
cost offload scan: 0.07843971252441406
offload 1 adapters, 1 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10848045349121094
Function offload_adapters took 0.5643367767333984 ms to run.
current batch size: 1 token used ratio: 0.003691666666666667
offload 1 adapters, 0 remains
Function offload_adapters took 0.08678436279296875 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.011444091796875 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 1 in total
Function load_lora_A took 1.209259033203125 ms to run.
Function load_lora_B took 1.1963844299316406 ms to run.
cost realload: 2.8638839721679688
Function load_adapters took 2.8858184814453125 ms to run.
Avg tokens(prompt+generate) throughput:  210.118 tokens/s
Avg prompt tokens throughput:            108.670 tokens/s
Avg generate tokens throughput:          101.448 tokens/s
current batch size: 1 token used ratio: 0.002725
current batch size: 1 token used ratio: 0.0031416666666666667
current batch size: 1 token used ratio: 0.0035583333333333335
current batch size: 1 token used ratio: 0.003975
offload 1 adapters, 0 remains
Function offload_adapters took 0.09489059448242188 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.01239776611328125 ms to run.
cost load scan: 0.008821487426757812
load 1 adapters, 1 in total
Function load_lora_A took 1.2536048889160156 ms to run.
Function load_lora_B took 1.1909008026123047 ms to run.
cost realload: 2.9480457305908203
Function load_adapters took 2.969980239868164 ms to run.
current batch size: 1 token used ratio: 0.002416666666666667
cost load scan: 0.010728836059570312
load 1 adapters, 2 in total
Function load_lora_A took 1.2054443359375 ms to run.
Function load_lora_B took 1.1932849884033203 ms to run.
cost realload: 2.810239791870117
Function load_adapters took 2.832651138305664 ms to run.
current batch size: 2 token used ratio: 0.00525
cost load scan: 0.01049041748046875
load 1 adapters, 3 in total
Function load_lora_A took 1.2357234954833984 ms to run.
Function load_lora_B took 1.1684894561767578 ms to run.
cost realload: 2.7990341186523438
Function load_adapters took 2.8219223022460938 ms to run.
current batch size: 3 token used ratio: 0.008266666666666667
cost load scan: 0.008821487426757812
load 1 adapters, 4 in total
Function load_lora_A took 1.201629638671875 ms to run.
Function load_lora_B took 1.155853271484375 ms to run.
cost realload: 2.7518272399902344
Function load_adapters took 2.7730464935302734 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 4 in total
cost realload: 0.2949237823486328
Function load_adapters took 0.3185272216796875 ms to run.
Avg tokens(prompt+generate) throughput:  179.508 tokens/s
Avg prompt tokens throughput:            119.306 tokens/s
Avg generate tokens throughput:           60.202 tokens/s
cost load scan: 0.011205673217773438
load 1 adapters, 5 in total
Function load_lora_A took 1.1949539184570312 ms to run.
Function load_lora_B took 1.1937618255615234 ms to run.
cost realload: 2.784252166748047
Function load_adapters took 2.804994583129883 ms to run.
current batch size: 6 token used ratio: 0.016125
current batch size: 6 token used ratio: 0.018625
offload 0 adapters, 5 remains
Function offload_adapters took 0.016450881958007812 ms to run.
cost load scan: 0.009059906005859375
load 0 adapters, 5 in total
cost realload: 0.30231475830078125
Function load_adapters took 0.3323554992675781 ms to run.
offload 0 adapters, 5 remains
Function offload_adapters took 0.013589859008789062 ms to run.
current batch size: 5 token used ratio: 0.015216666666666667
cost load scan: 0.013113021850585938
load 1 adapters, 6 in total
Function load_lora_A took 1.2247562408447266 ms to run.
Function load_lora_B took 1.2059211730957031 ms to run.
cost realload: 2.852916717529297
Function load_adapters took 2.8755664825439453 ms to run.
cost offload scan: 0.3066062927246094
offload 1 adapters, 5 remains
cost offload cat: 0.03337860107421875
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10895729064941406
Function offload_adapters took 0.8053779602050781 ms to run.
current batch size: 5 token used ratio: 0.015791666666666666
cost load scan: 0.011205673217773438
load 1 adapters, 6 in total
Function load_lora_A took 1.2059211730957031 ms to run.
Function load_lora_B took 1.1920928955078125 ms to run.
cost realload: 2.7942657470703125
Function load_adapters took 2.81524658203125 ms to run.
cost load scan: 0.007867813110351562
load 0 adapters, 6 in total
cost realload: 0.2841949462890625
Function load_adapters took 0.3085136413574219 ms to run.
cost offload scan: 0.08511543273925781
offload 1 adapters, 5 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10228157043457031
Function offload_adapters took 0.5619525909423828 ms to run.
current batch size: 6 token used ratio: 0.01875833333333333
cost offload scan: 0.08058547973632812
offload 1 adapters, 4 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.041484832763671875
INFO:     127.0.0.1:39038 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39048 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39060 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:50766 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:50780 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:50794 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:56914 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:56930 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:56938 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:56946 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:56952 - "POST /generate_stream HTTP/1.1" 200 OK
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10609626770019531
Function offload_adapters took 0.6055831909179688 ms to run.
cost offload scan: 0.07915496826171875
offload 1 adapters, 3 remains
cost offload cat: 0.02956390380859375
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10085105895996094
Function offload_adapters took 0.54931640625 ms to run.
current batch size: 4 token used ratio: 0.012675
current batch size: 4 token used ratio: 0.014341666666666667
cost offload scan: 0.08726119995117188
offload 1 adapters, 2 remains
cost offload cat: 0.03552436828613281
cost offload free mem manager: 0.0476837158203125
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.1068115234375
Function offload_adapters took 0.5908012390136719 ms to run.
current batch size: 3 token used ratio: 0.011308333333333333
cost offload scan: 0.07963180541992188
offload 1 adapters, 1 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10132789611816406
Function offload_adapters took 0.5543231964111328 ms to run.
offload 0 adapters, 1 remains
Function offload_adapters took 0.013113021850585938 ms to run.
offload 1 adapters, 0 remains
Function offload_adapters took 0.08940696716308594 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.011920928955078125 ms to run.
cost load scan: 0.009775161743164062
load 1 adapters, 1 in total
Function load_lora_A took 1.219034194946289 ms to run.
Function load_lora_B took 1.1625289916992188 ms to run.
cost realload: 2.824544906616211
Function load_adapters took 2.847909927368164 ms to run.
cost load scan: 0.010251998901367188
load 1 adapters, 2 in total
Function load_lora_A took 1.2097358703613281 ms to run.
Function load_lora_B took 1.1904239654541016 ms to run.
cost realload: 2.7909278869628906
Function load_adapters took 2.8111934661865234 ms to run.
current batch size: 2 token used ratio: 0.00385
cost load scan: 0.010728836059570312
load 1 adapters, 3 in total
Function load_lora_A took 1.2195110321044922 ms to run.
Function load_lora_B took 1.2173652648925781 ms to run.
cost realload: 2.816915512084961
Function load_adapters took 2.836942672729492 ms to run.
Avg tokens(prompt+generate) throughput:  401.871 tokens/s
Avg prompt tokens throughput:            202.534 tokens/s
Avg generate tokens throughput:          199.337 tokens/s
current batch size: 3 token used ratio: 0.007466666666666667
cost load scan: 0.00858306884765625
load 1 adapters, 4 in total
Function load_lora_A took 1.1749267578125 ms to run.
Function load_lora_B took 1.207590103149414 ms to run.
cost realload: 2.776622772216797
Function load_adapters took 2.797842025756836 ms to run.
current batch size: 4 token used ratio: 0.011166666666666667
current batch size: 4 token used ratio: 0.012833333333333334
cost offload scan: 0.08463859558105469
offload 1 adapters, 3 remains
cost offload cat: 0.03600120544433594
cost offload free mem manager: 0.041484832763671875
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10514259338378906
Function offload_adapters took 0.5757808685302734 ms to run.
cost offload scan: 0.07772445678710938
offload 1 adapters, 2 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10228157043457031
Function offload_adapters took 0.560760498046875 ms to run.
current batch size: 2 token used ratio: 0.00735
current batch size: 2 token used ratio: 0.008183333333333334
cost offload scan: 0.07772445678710938
offload 1 adapters, 1 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.04315376281738281
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10061264038085938
Function offload_adapters took 0.5497932434082031 ms to run.
current batch size: 1 token used ratio: 0.004141666666666667
offload 1 adapters, 0 remains
Function offload_adapters took 0.09250640869140625 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.011682510375976562 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 1 in total
Function load_lora_A took 1.249074935913086 ms to run.
Function load_lora_B took 1.2102127075195312 ms to run.
cost realload: 2.9668807983398438
Function load_adapters took 2.9888153076171875 ms to run.
current batch size: 1 token used ratio: 0.0017833333333333334
cost load scan: 0.008344650268554688
load 1 adapters, 2 in total
Function load_lora_A took 1.188039779663086 ms to run.
Function load_lora_B took 1.171112060546875 ms to run.
cost realload: 2.7387142181396484
Function load_adapters took 2.759218215942383 ms to run.
Avg tokens(prompt+generate) throughput:  161.618 tokens/s
Avg prompt tokens throughput:             75.621 tokens/s
Avg generate tokens throughput:           85.997 tokens/s
current batch size: 2 token used ratio: 0.004741666666666667
current batch size: 2 token used ratio: 0.005575
cost load scan: 0.010728836059570312
load 1 adapters, 3 in total
Function load_lora_A took 1.194000244140625 ms to run.
Function load_lora_B took 1.2023448944091797 ms to run.
cost realload: 2.8340816497802734
Function load_adapters took 2.8607845306396484 ms to run.
current batch size: 3 token used ratio: 0.008275
current batch size: 3 token used ratio: 0.009525
cost offload scan: 0.08225440979003906
offload 1 adapters, 2 remains
cost offload cat: 0.03838539123535156
cost offload free mem manager: 0.04839897155761719
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.110626220703125
Function offload_adapters took 0.5941390991210938 ms to run.
current batch size: 2 token used ratio: 0.006925
cost offload scan: 0.07653236389160156
offload 1 adapters, 1 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10085105895996094
Function offload_adapters took 0.5548000335693359 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 2 in total
Function load_lora_A took 1.2011528015136719 ms to run.
Function load_lora_B took 1.1620521545410156 ms to run.
cost realload: 2.763032913208008
Function load_adapters took 2.7844905853271484 ms to run.
cost load scan: 0.01239776611328125
load 1 adapters, 3 in total
Function load_lora_A took 1.2087821960449219 ms to run.
Function load_lora_B took 1.194000244140625 ms to run.
cost realload: 2.7992725372314453
Function load_adapters took 2.819061279296875 ms to run.
current batch size: 3 token used ratio: 0.007308333333333333
cost offload scan: 0.07748603820800781
offload 1 adapters, 2 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04172325134277344
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10538101196289062
Function offload_adapters took 0.553131103515625 ms to run.
current batch size: 2 token used ratio: 0.005025
current batch size: 2 token used ratio: 0.0058583333333333334
cost load scan: 0.01049041748046875
load 1 adapters, 3 in total
Function load_lora_A took 1.1925697326660156 ms to run.
Function load_lora_B took 1.155853271484375 ms to run.
cost realload: 2.7506351470947266
Function load_adapters took 2.772092819213867 ms to run.
current batch size: 3 token used ratio: 0.00885
cost load scan: 0.007867813110351562
load 1 adapters, 4 in total
Function load_lora_A took 1.199960708618164 ms to run.
Function load_lora_B took 1.196146011352539 ms to run.
cost realload: 2.779722213745117
Function load_adapters took 2.8002262115478516 ms to run.
current batch size: 4 token used ratio: 0.012075
Avg tokens(prompt+generate) throughput:  230.314 tokens/s
Avg prompt tokens throughput:            112.010 tokens/s
Avg generate tokens throughput:          118.305 tokens/s
cost offload scan: 0.07867813110351562
offload 1 adapters, 3 remains
cost offload cat: 0.030755996704101562
cost offload free mem manager: 0.042438507080078125
INFO:     127.0.0.1:54614 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54630 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54634 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54644 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54658 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54662 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54674 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:54686 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39446 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39462 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39464 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39472 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39474 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39490 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:39494 - "POST /generate_stream HTTP/1.1" 200 OK
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10323524475097656
Function offload_adapters took 0.6008148193359375 ms to run.
cost offload scan: 0.07772445678710938
offload 1 adapters, 2 remains
cost offload cat: 0.03314018249511719
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.024080276489257812
cost offload a_loc update: 0.1049041748046875
Function offload_adapters took 0.5729198455810547 ms to run.
current batch size: 2 token used ratio: 0.005416666666666667
cost load scan: 0.00858306884765625
load 1 adapters, 3 in total
Function load_lora_A took 1.216888427734375 ms to run.
Function load_lora_B took 1.2099742889404297 ms to run.
cost realload: 2.8200149536132812
Function load_adapters took 2.841949462890625 ms to run.
current batch size: 3 token used ratio: 0.008566666666666667
current batch size: 3 token used ratio: 0.009816666666666666
cost load scan: 0.009298324584960938
load 0 adapters, 3 in total
cost realload: 0.3142356872558594
Function load_adapters took 0.3390312194824219 ms to run.
cost offload scan: 0.07772445678710938
offload 1 adapters, 2 remains
cost offload cat: 0.03337860107421875
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10824203491210938
Function offload_adapters took 0.5710124969482422 ms to run.
current batch size: 3 token used ratio: 0.009058333333333333
cost offload scan: 0.080108642578125
offload 1 adapters, 1 remains
cost offload cat: 0.031948089599609375
cost offload free mem manager: 0.043392181396484375
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10204315185546875
Function offload_adapters took 0.5521774291992188 ms to run.
cost load scan: 0.0095367431640625
load 1 adapters, 2 in total
Function load_lora_A took 1.2030601501464844 ms to run.
Function load_lora_B took 1.1882781982421875 ms to run.
cost realload: 2.797842025756836
Function load_adapters took 2.8219223022460938 ms to run.
cost load scan: 0.012874603271484375
load 1 adapters, 3 in total
Function load_lora_A took 1.1789798736572266 ms to run.
Function load_lora_B took 1.1982917785644531 ms to run.
cost realload: 2.774953842163086
Function load_adapters took 2.7959346771240234 ms to run.
current batch size: 4 token used ratio: 0.010441666666666667
offload 0 adapters, 3 remains
Function offload_adapters took 0.013828277587890625 ms to run.
current batch size: 3 token used ratio: 0.008133333333333333
current batch size: 3 token used ratio: 0.009383333333333334
cost offload scan: 0.0820159912109375
offload 1 adapters, 2 remains
cost offload cat: 0.039577484130859375
cost offload free mem manager: 0.04506111145019531
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10824203491210938
Function offload_adapters took 0.5846023559570312 ms to run.
current batch size: 2 token used ratio: 0.006733333333333333
cost load scan: 0.008344650268554688
load 1 adapters, 3 in total
Function load_lora_A took 1.2135505676269531 ms to run.
Function load_lora_B took 1.2085437774658203 ms to run.
cost realload: 2.8226375579833984
Function load_adapters took 2.844572067260742 ms to run.
cost load scan: 0.008344650268554688
load 0 adapters, 3 in total
cost realload: 0.2913475036621094
Function load_adapters took 0.3154277801513672 ms to run.
current batch size: 4 token used ratio: 0.011925
offload 0 adapters, 3 remains
Function offload_adapters took 0.012636184692382812 ms to run.
cost load scan: 0.011444091796875
load 1 adapters, 4 in total
Function load_lora_A took 1.2180805206298828 ms to run.
Function load_lora_B took 1.184701919555664 ms to run.
cost realload: 2.785205841064453
Function load_adapters took 2.8057098388671875 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 4 in total
cost realload: 0.2760887145996094
Function load_adapters took 0.3001689910888672 ms to run.
Avg tokens(prompt+generate) throughput:  333.684 tokens/s
Avg prompt tokens throughput:            190.620 tokens/s
Avg generate tokens throughput:          143.065 tokens/s
cost offload scan: 0.3204345703125
offload 1 adapters, 3 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.8149147033691406 ms to run.
current batch size: 4 token used ratio: 0.009566666666666666
current batch size: 4 token used ratio: 0.011233333333333333
cost load scan: 0.011205673217773438
load 1 adapters, 4 in total
Function load_lora_A took 1.1935234069824219 ms to run.
Function load_lora_B took 1.1570453643798828 ms to run.
cost realload: 2.74658203125
Function load_adapters took 2.7675628662109375 ms to run.
current batch size: 5 token used ratio: 0.015325
current batch size: 5 token used ratio: 0.017408333333333335
cost offload scan: 0.08535385131835938
offload 1 adapters, 3 remains
cost offload cat: 0.03647804260253906
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.1087188720703125
Function offload_adapters took 0.5846023559570312 ms to run.
cost load scan: 0.0133514404296875
load 1 adapters, 4 in total
Function load_lora_A took 1.2257099151611328 ms to run.
Function load_lora_B took 1.2252330780029297 ms to run.
cost realload: 2.8731822967529297
Function load_adapters took 2.8955936431884766 ms to run.
cost offload scan: 0.07891654968261719
offload 1 adapters, 3 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.022411346435546875
cost offload a_loc update: 0.10013580322265625
Function offload_adapters took 0.5519390106201172 ms to run.
cost load scan: 0.008106231689453125
load 1 adapters, 4 in total
Function load_lora_A took 1.2319087982177734 ms to run.
Function load_lora_B took 1.199960708618164 ms to run.
cost realload: 2.8235912322998047
Function load_adapters took 2.8450489044189453 ms to run.
offload 0 adapters, 4 remains
Function offload_adapters took 0.013113021850585938 ms to run.
cost offload scan: 0.07677078247070312
offload 1 adapters, 3 remains
cost offload cat: 0.029802322387695312
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.5412101745605469 ms to run.
current batch size: 3 token used ratio: 0.007883333333333332
cost load scan: 0.008344650268554688
load 1 adapters, 4 in total
Function load_lora_A took 1.2226104736328125 ms to run.
Function load_lora_B took 1.1992454528808594 ms to run.
cost realload: 2.807140350341797
Function load_adapters took 2.8285980224609375 ms to run.
current batch size: 4 token used ratio: 0.011683333333333334
cost load scan: 0.011444091796875
load 1 adapters, 5 in total
Function load_lora_A took 1.165628433227539 ms to run.
Function load_lora_B took 1.1930465698242188 ms to run.
cost realload: 2.757549285888672
Function load_adapters took 2.7790069580078125 ms to run.
current batch size: 5 token used ratio: 0.015683333333333334
cost offload scan: 0.07915496826171875
offload 1 adapters, 4 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.5581378936767578 ms to run.
current batch size: 4 token used ratio: 0.013258333333333334
cost load scan: 0.008106231689453125
load 1 adapters, 5 in total
Function load_lora_A took 1.180410385131836 ms to run.
Function load_lora_B took 1.1904239654541016 ms to run.
cost realload: 2.7527809143066406
Function load_adapters took 2.773761749267578 ms to run.
cost load scan: 0.00762939453125
load 0 adapters, 5 in total
cost realload: 0.2837181091308594
Function load_adapters took 0.30803680419921875 ms to run.
current batch size: 6 token used ratio: 0.019916666666666666
cost offload scan: 0.080108642578125
offload 1 adapters, 4 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.041961669921875INFO:     127.0.0.1:37952 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37956 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37968 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37976 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37978 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:37992 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:56346 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:56358 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:56360 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42784 - "POST /generate_stream HTTP/1.1" 200 OK

cost offload torch.empty: 0.02384185791015625
cost offload a_loc update: 0.10180473327636719
Function offload_adapters took 0.5929470062255859 ms to run.
cost offload scan: 0.07724761962890625
offload 1 adapters, 3 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.041961669921875
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.10228157043457031
Function offload_adapters took 0.55694580078125 ms to run.
current batch size: 4 token used ratio: 0.013708333333333333
Avg tokens(prompt+generate) throughput:  392.156 tokens/s
Avg prompt tokens throughput:            179.434 tokens/s
Avg generate tokens throughput:          212.722 tokens/s
cost offload scan: 0.07915496826171875
offload 1 adapters, 2 remains
cost offload cat: 0.030040740966796875
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.10061264038085938
Function offload_adapters took 0.5490779876708984 ms to run.
cost load scan: 0.00858306884765625
load 1 adapters, 3 in total
Function load_lora_A took 1.1582374572753906 ms to run.
Function load_lora_B took 1.1780261993408203 ms to run.
cost realload: 2.7284622192382812
Function load_adapters took 2.749919891357422 ms to run.
offload 0 adapters, 3 remains
Function offload_adapters took 0.01239776611328125 ms to run.
current batch size: 3 token used ratio: 0.008816666666666667
cost load scan: 0.008821487426757812
load 1 adapters, 4 in total
Function load_lora_A took 1.2373924255371094 ms to run.
Function load_lora_B took 1.135110855102539 ms to run.
cost realload: 2.7604103088378906
Function load_adapters took 2.7832984924316406 ms to run.
current batch size: 4 token used ratio: 0.012433333333333333
cost offload scan: 0.08130073547363281
offload 1 adapters, 3 remains
cost offload cat: 0.03457069396972656
cost offload free mem manager: 0.04267692565917969
cost offload torch.empty: 0.023126602172851562
cost offload a_loc update: 0.11014938354492188
Function offload_adapters took 0.5745887756347656 ms to run.
cost offload scan: 0.08487701416015625
offload 1 adapters, 2 remains
cost offload cat: 0.03147125244140625
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.022649765014648438
cost offload a_loc update: 0.10466575622558594
Function offload_adapters took 0.5624294281005859 ms to run.
current batch size: 2 token used ratio: 0.005741666666666667
current batch size: 2 token used ratio: 0.006575
current batch size: 2 token used ratio: 0.007408333333333334
cost offload scan: 0.08368492126464844
offload 1 adapters, 1 remains
cost offload cat: 0.03647804260253906
cost offload free mem manager: 0.049591064453125
cost offload torch.empty: 0.023603439331054688
cost offload a_loc update: 0.11801719665527344
Function offload_adapters took 0.6046295166015625 ms to run.
current batch size: 1 token used ratio: 0.004058333333333333
offload 1 adapters, 0 remains
Function offload_adapters took 0.08797645568847656 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.011920928955078125 ms to run.
cost load scan: 0.010251998901367188
load 1 adapters, 1 in total
Function load_lora_A took 1.184225082397461 ms to run.
Function load_lora_B took 1.1715888977050781 ms to run.
cost realload: 2.824544906616211
Function load_adapters took 2.8455257415771484 ms to run.
current batch size: 1 token used ratio: 0.0022
cost load scan: 0.01049041748046875
load 1 adapters, 2 in total
Function load_lora_A took 1.199483871459961 ms to run.
Function load_lora_B took 1.2102127075195312 ms to run.
cost realload: 2.792835235595703
Function load_adapters took 2.8154850006103516 ms to run.
cost load scan: 0.008344650268554688
load 1 adapters, 3 in total
Function load_lora_A took 1.1570453643798828 ms to run.
Function load_lora_B took 1.1870861053466797 ms to run.
cost realload: 2.7370452880859375
Function load_adapters took 2.7577877044677734 ms to run.
current batch size: 3 token used ratio: 0.007125
cost load scan: 0.010728836059570312
load 1 adapters, 4 in total
Function load_lora_A took 1.2006759643554688 ms to run.
Function load_lora_B took 1.1951923370361328 ms to run.
cost realload: 2.782583236694336
Function load_adapters took 2.8057098388671875 ms to run.
current batch size: 4 token used ratio: 0.01045
Avg tokens(prompt+generate) throughput:  261.596 tokens/s
Avg prompt tokens throughput:            143.279 tokens/s
Avg generate tokens throughput:          118.317 tokens/s
current batch size: 4 token used ratio: 0.012116666666666666
current batch size: 4 token used ratio: 0.013783333333333333
cost offload scan: 0.08082389831542969
offload 1 adapters, 3 remains
cost offload cat: 0.04172325134277344
cost offload free mem manager: 0.044345855712890625
cost offload torch.empty: 0.023603439331054688
cost offload a_loc update: 0.10418891906738281
Function offload_adapters took 0.5884170532226562 ms to run.
current batch size: 3 token used ratio: 0.011191666666666667
cost offload scan: 0.08296966552734375
offload 1 adapters, 2 remains
cost offload cat: 0.030517578125
cost offload free mem manager: 0.04220008850097656
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.09965896606445312
Function offload_adapters took 0.5567073822021484 ms to run.
cost offload scan: 0.08869171142578125
offload 1 adapters, 1 remains
cost offload cat: 0.030279159545898438
cost offload free mem manager: 0.042438507080078125
cost offload torch.empty: 0.02288818359375
cost offload a_loc update: 0.09942054748535156
Function offload_adapters took 0.5543231964111328 ms to run.
offload 1 adapters, 0 remains
Function offload_adapters took 0.08726119995117188 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.011444091796875 ms to run.
cost load scan: 0.00762939453125
load 1 adapters, 1 in total
Function load_lora_A took 1.18255615234375 ms to run.
Function load_lora_B took 1.1675357818603516 ms to run.
cost realload: 2.7828216552734375
Function load_adapters took 2.803325653076172 ms to run.
current batch size: 1 token used ratio: 0.0020583333333333335
current batch size: 1 token used ratio: 0.002475
current batch size: 1 token used ratio: 0.0028916666666666665
current batch size: 1 token used ratio: 0.0033083333333333333
offload 1 adapters, 0 remains
Function offload_adapters took 0.08511543273925781 ms to run.
offload 0 adapters, 0 remains
Function offload_adapters took 0.012159347534179688 ms to run.
cost load scan: 0.010728836059570312
load 1 adapters, 1 in total
Function load_lora_A took 1.1513233184814453 ms to run.
Function load_lora_B took 1.1639595031738281 ms to run.
cost realload: 2.7344226837158203
Function load_adapters took 2.7551651000976562 ms to run.
current batch size: 1 token used ratio: 0.002525
cost load scan: 0.008344650268554688
load 1 adapters, 2 in total
Function load_lora_A took 1.214742660522461 ms to run.
Function load_lora_B took 1.1699199676513672 ms to run.
cost realload: 2.777576446533203
Function load_adapters took 2.7980804443359375 ms to run.
current batch size: 2 token used ratio: 0.0049833333333333335
Avg tokens(prompt+generate) throughput:  163.167 tokens/s
Avg prompt tokens throughput:             71.142 tokens/s
Avg generate tokens throughput:           92.025 tokens/s
current batch size: 2 token used ratio: 0.005816666666666667
cost load scan: 0.008344650268554688
load 1 adapters, 3 in total
Function load_lora_A took 1.1980533599853516 ms to run.
Function load_lora_B took 1.1849403381347656 ms to run.
cost realload: 2.7697086334228516
Function load_adapters took 2.790689468383789 ms to run.
current batch size: 3 token used ratio: 0.00875
current batch size: 3 token used ratio: 0.01
cost offload scan: 0.0820159912109375
offload 1 adapters, 2 remains
cost offload cat: 0.03552436828613281
cost offload free mem manager: 0.04363059997558594
cost offload torch.empty: 0.023365020751953125
cost offload a_loc update: 0.1068115234375
Function offload_adapters took 0.5772113800048828 ms to run.
cost offload scan: 0.07939338684082031
offload 1 adapters, 1 remains
cost offload cat: 0.030994415283203125
cost offload free mem manager: 0.04291534423828125
INFO:     127.0.0.1:42786 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42798 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42812 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42818 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:42832 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51134 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51148 - "POST /generate_stream HTTP/1.1" 200 OK
INFO:     127.0.0.1:51154 - "POST /generate_stream HTTP/1.1" 200 OK
